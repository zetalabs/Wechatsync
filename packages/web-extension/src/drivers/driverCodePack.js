window.driver = "var modules;\n/******/ (() => { // webpackBootstrap\n/******/ \tvar __webpack_modules__ = ({\n\n/***/ 610:\n/***/ (() => {\n\n\r\nclass Mp163 {\r\n  constructor() {\r\n    this.version = '0.0.1'\r\n        // modify origin headers\r\n    modifyRequestHeaders('mp.sohu.com/mpbp', {\r\n        Origin: 'https://mp.sohu.com',\r\n      Referer: 'https://mp.sohu.com/'\r\n    }, [\r\n        '*://mp.sohu.com/mpbp/*',\r\n    ])\r\n  }\r\n\r\n  async getMetaData() {\r\n    const { data } = await axios.get('https://mp.163.com/wemedia/navinfo.do?_=' + Date.now())\r\n    console.log(data)\r\n    if(data.code != 1) {\r\n        throw new Error('not found')\r\n    }\r\n    const accountInfo = data.data\r\n    _souhuCacheMeta = accountInfo\r\n    return {\r\n      uid: accountInfo.wemediaId,\r\n      title: accountInfo.tname,\r\n      avatar: accountInfo.icon,\r\n      type: '163',\r\n      displayName: '网易号',\r\n      supportTypes: ['html'],\r\n      home: 'https://mp.163.com/index.html#/article/manage',\r\n      icon: 'https://mp.163.com/favicon.ico',\r\n    }\r\n  }\r\n\r\n  async addPost(post, _instance) {\r\n    return {\r\n      status: 'success',\r\n      post_id: 0,\r\n    }\r\n  }\r\n\r\n  async editPost(post_id, post) {\r\n\r\n    // todo\r\n    return {\r\n      status: 'success',\r\n      post_id: post_id,\r\n      draftLink: 'https://mp.sohu.com/mpfe/v3/main/news/addarticle?spm=smmp.articlelist.0.0&contentStatus=2&id=' + post_id,\r\n    }\r\n  }\r\n\r\n  async uploadFile(file) {\r\n    var uploadUrl = 'https://upload.ws.126.net/picupload?_=1615878815133&wemediaId='\r\n    var file = new File([file.bits], 'temp', {\r\n      type: file.type\r\n    });\r\n    var formdata = new FormData()\r\n    formdata.append('file', file)\r\n    formdata.append('from', 'neteasecode_mp')\r\n    var res = await axios({\r\n      url: uploadUrl,\r\n      method: 'post',\r\n      data: formdata,\r\n      headers: { 'Content-Type': 'multipart/form-data' },\r\n    })\r\n\r\n    return [\r\n      {\r\n        url: res.data.data.url,\r\n      },\r\n    ]\r\n  }\r\n\r\n  async preEditPost(post) {\r\n    var div = $('<div>')\r\n    $('body').append(div)\r\n\r\n    try {\r\n      div.html(post.content)\r\n      var doc = div\r\n      // var pres = doc.find(\"pre\");\r\n      tools.processDocCode(div)\r\n      tools.makeImgVisible(div)\r\n\r\n      var tempDoc = $('<div>').append(doc.clone())\r\n      post.content =\r\n        tempDoc.children('div').length == 1\r\n          ? tempDoc.children('div').html()\r\n          : tempDoc.html()\r\n\r\n      console.log('after.predEdit', post.content)\r\n    } catch (e) {\r\n      console.log('preEdit.error', e)\r\n    }\r\n  }\r\n}\r\n\n\n/***/ }),\n\n/***/ 640:\n/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {\n\n\"use strict\";\n__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   \"default\": () => (/* binding */ _51CtoAdapter)\n/* harmony export */ });\nvar _cacheMeta = null\r\n\r\nclass _51CtoAdapter {\r\n  constructor(config) {\r\n    // this.skipReadImage = true\r\n    this.config = config\r\n    this.name = '51cto'\r\n  }\r\n\r\n  async getMetaData() {\r\n    var res = await $.get('https://blog.51cto.com/blogger/publish')\r\n    var parser = new DOMParser()\r\n    var htmlDoc = parser.parseFromString(res, 'text/html')\r\n    var img = htmlDoc.querySelector('li.more.user > a > img')\r\n    var link = img.parentNode.href\r\n    var pie = link.split('/')\r\n    // pie.pop()\r\n    var uid = pie.pop()\r\n    console.log(link)\r\n    var scrs = [].slice\r\n      .call(htmlDoc.querySelectorAll('script'))\r\n      .filter(_ => _.innerText.indexOf('sign') > -1)\r\n\r\n    var uploadSign = null;\r\n    if (scrs.length) {\r\n      try {\r\n        var dataStr = scrs[0].innerText\r\n        var rawStr = dataStr.substring(\r\n          dataStr.indexOf('sign'),\r\n          dataStr.indexOf('uploadUrl', dataStr.indexOf('sign'))\r\n        )\r\n        var signStr = rawStr\r\n          .replace('var', '')\r\n          .trim()\r\n          .replace(\"sign = '\", '')\r\n          .replace(\"';\", '')\r\n          .trim()\r\n          uploadSign = signStr\r\n      } catch (e) {\r\n        console.log('51cto', e)\r\n      }\r\n    }\r\n      _cacheMeta = {\r\n        rawStr: rawStr,\r\n        uploadSign: uploadSign,\r\n        csrf: htmlDoc\r\n          .querySelector('meta[name=csrf-token]')\r\n          .getAttribute('content'),\r\n      }\r\n    console.log('51cto', _cacheMeta)\r\n    return {\r\n      uid: uid,\r\n      title: uid,\r\n      avatar: img.src,\r\n      type: '51cto',\r\n      displayName: '51CTO',\r\n      supportTypes: ['markdown', 'html'],\r\n      home: 'https://blog.51cto.com/blogger/publish',\r\n      icon: 'https://blog.51cto.com/favicon.ico',\r\n    }\r\n  }\r\n\r\n  async addPost(post) {\r\n    return {\r\n      status: 'success',\r\n      post_id: 0,\r\n    }\r\n  }\r\n\r\n  async editPost(post_id, post) {\r\n    var postStruct = {}\r\n\r\n    if (post.markdown) {\r\n      postStruct = {\r\n        title: post.post_title,\r\n        copy_code: 1,\r\n        is_old: 0,\r\n        content: post.markdown,\r\n        _csrf: _cacheMeta.csrf,\r\n      }\r\n    } else {\r\n      postStruct = {\r\n        blog_type: null,\r\n        title: post.post_title,\r\n        copy_code: 1,\r\n        content: post.post_content,\r\n        pid: '',\r\n        cate_id: '',\r\n        custom_id: '',\r\n        tag: '',\r\n        abstract:'',\r\n        is_hide: 0,\r\n        did: '',\r\n        blog_id: '',\r\n        is_old: 1,\r\n        _csrf: _cacheMeta.csrf,\r\n        // editorValue: null,\r\n      }\r\n    }\r\n\r\n    var res = await $.ajax({\r\n      url: 'https://blog.51cto.com/blogger/draft',\r\n      type: 'POST',\r\n      dataType: 'JSON',\r\n      data: postStruct,\r\n    })\r\n\r\n    if (!res.data) {\r\n      throw new Error(res.message)\r\n    }\r\n\r\n    return {\r\n      status: 'success',\r\n      post_id: res.data.did,\r\n      draftLink: 'https://blog.51cto.com/blogger/draft/' + res.data.did,\r\n    }\r\n  }\r\n\r\n  async uploadFile(file) {\r\n    var src = file.src\r\n    // var csrf = this.config.state.csrf\r\n    var uploadUrl = 'https://upload.51cto.com/index.php?c=upload&m=upimg&orig=b'\r\n    var file = new File([file.bits], 'temp', {\r\n      type: file.type,\r\n    })\r\n    var formdata = new FormData()\r\n\r\n    formdata.append('sign', _cacheMeta.uploadSign)\r\n    // formdata.append('file', file)\r\n    formdata.append('file', file, new Date().getTime() + '.jpg')\r\n    formdata.append('type', file.type)\r\n    formdata.append('id', 'WU_FILE_1')\r\n    formdata.append('fileid', `uploadm-` + Math.floor(Math.random() * 1000000))\r\n    // formdata.append('name', new Date().getTime() + '.jpg')\r\n    formdata.append('lastModifiedDate', new Date().toString())\r\n    formdata.append('size', file.size)\r\n    var res = await axios({\r\n      url: uploadUrl,\r\n      method: 'post',\r\n      data: formdata,\r\n      headers: { 'Content-Type': 'multipart/form-data' },\r\n    })\r\n\r\n    if (res.data.status === false) {\r\n      throw new Error('图片上传失败 ' + src)\r\n    }\r\n    // http only\r\n    console.log('uploadFile', res)\r\n    var id = Math.floor(Math.random() * 100000)\r\n    return [\r\n      {\r\n        id: id,\r\n        object_key: id,\r\n        url: `https://s4.51cto.com/` + res.data.data,\r\n        // size: res.data.data.size,\r\n        // images: [res.data],\r\n      },\r\n    ]\r\n  }\r\n\r\n  async preEditPost(post) {\r\n    var div = $('<div>')\r\n    $('body').append(div)\r\n\r\n    try {\r\n      div.html(post.content)\r\n      var doc = div\r\n      // var pres = doc.find(\"pre\");\r\n      tools.processDocCode(div)\r\n      tools.makeImgVisible(div)\r\n\r\n      var tempDoc = $('<div>').append(doc.clone())\r\n      post.content =\r\n        tempDoc.children('div').length == 1\r\n          ? tempDoc.children('div').html()\r\n          : tempDoc.html()\r\n\r\n      console.log('after.predEdit', post.content)\r\n    } catch (e) {\r\n      console.log('preEdit.error', e)\r\n    }\r\n  }\r\n\r\n  // editImg(img, source) {\r\n  //   img.attr('size', source.size)\r\n  // }\r\n  //   <img class=\"\" src=\"http://p2.pstatp.com/large/pgc-image/bc0a9fc8e595453083d85deb947c3d6e\" data-ic=\"false\" data-ic-uri=\"\" data-height=\"1333\" data-width=\"1000\" image_type=\"1\" web_uri=\"pgc-image/bc0a9fc8e595453083d85deb947c3d6e\" img_width=\"1000\" img_height=\"1333\"></img>\r\n}\r\n\n\n/***/ }),\n\n/***/ 230:\n/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {\n\n\"use strict\";\n__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   \"default\": () => (/* binding */ BaseAdapter)\n/* harmony export */ });\nclass BaseAdapter {\r\n\r\n  async getMetaData () {\r\n    // 组装元数据：调用平台 api 获取用户信息和平台信息，并返回组装数据\r\n\r\n  }\r\n\r\n  async preEditPost(post) {\r\n    // 内容预处理：预处理平台无法兼容的文本内容\r\n  }\r\n\r\n  async addPost(post) {\r\n    // 创建文章：调用平台 api 创建草稿\r\n  }\r\n\r\n  async uploadFile(file) {\r\n    // 上传图片：调用平台 api 上传图片\r\n  }\r\n\r\n  async editPost (postId, post) {\r\n    // 更新文章：调用平台 api 更新文章（同步助手内部通过该接口替换文章内图片地址）\r\n  }\r\n}\r\n\n\n/***/ }),\n\n/***/ 848:\n/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {\n\n\"use strict\";\n__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   \"default\": () => (/* binding */ CSDNAdapter)\n/* harmony export */ });\n\r\n\r\n// const TurndownService = turndown\r\n\r\nfunction createUuid() {\r\n  return 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g, function (c) {\r\n    var r = Math.random() * 16 | 0;\r\n    var v = c === 'x' ? r : r & 0x3 | 0x8;\r\n    return v.toString(16);\r\n  });\r\n};\r\n\r\nfunction signCSDN(apiPath, contentType = 'application/json') {\r\n\tvar once = createUuid()\r\n  var signStr = `POST\r\n*/*\r\n\r\napplication/json\r\n\r\nx-ca-key:203803574\r\nx-ca-nonce:${once}\r\n${apiPath}`\r\n\tvar hash = CryptoJS.HmacSHA256(signStr, \"9znpamsyl2c7cdrr9sas0le9vbc3r6ba\");\r\n\tvar hashInBase64 = CryptoJS.enc.Base64.stringify(hash);\r\n  return {\r\n    accept: '*/*',\r\n    'content-type': contentType,\r\n    'x-ca-key': 203803574,\r\n    'x-ca-nonce': once,\r\n    'x-ca-signature': hashInBase64,\r\n    'x-ca-signature-headers':'x-ca-key,x-ca-nonce'\r\n  }\r\n}\r\n\r\n/**************************************\r\n * signCSDN0() reference function\r\n *\r\n *             t.headers[\"X-Ca-Signature\"] = A({\r\n                method: o,\r\n                url: i,\r\n                accept: e,\r\n                params: c,\r\n                date: n,\r\n                contentType: a,\r\n                headers: t.headers,\r\n                appSecret: \"i5rbx2z2ivnxzidzpfc0z021imsp2nec\"\r\n            }),\r\n  **************************************\r\nA = function(t) {\r\n  var e = t.method\r\n    , n = t.url\r\n    , r = t.appSecret\r\n    , a = t.accept\r\n    , o = t.date\r\n    , i = t.contentType\r\n    , c = t.params\r\n    , u = t.headers\r\n    , l = \"\";\r\n  c || -1 === n.indexOf(\"?\") ? c || (c = {}) : (c = function(t) {\r\n      var e = {}\r\n        , n = t.match(/[?&]([^=&#]+)=([^&#]*)/g);\r\n      if (n)\r\n          for (var r in n) {\r\n              var a = n[r].split(\"=\")\r\n                , o = a[0].substr(1)\r\n                , i = a[1];\r\n              e[o] ? e[o] = [].concat(e[o], i) : e[o] = i\r\n          }\r\n      return e\r\n  }(n),\r\n  n = n.split(\"?\")[0]);\r\n  l += e + \"\\n\",\r\n  l += a + \"\\n\",\r\n  l += \"\\n\",\r\n  l += i + \"\\n\",\r\n  l += o + \"\\n\";\r\n  var s = v(u)\r\n    , p = f()(h()(s)).sort()\r\n    , m = !0\r\n    , g = !1\r\n    , R = void 0;\r\n  try {\r\n      for (var A, P = d()(p); !(m = (A = P.next()).done); m = !0) {\r\n          var L = A.value;\r\n          l += L + \":\" + s[L] + \"\\n\"\r\n      }\r\n  } catch (t) {\r\n      g = !0,\r\n      R = t\r\n  } finally {\r\n      try {\r\n          !m && P.return && P.return()\r\n      } finally {\r\n          if (g)\r\n              throw R\r\n      }\r\n  }\r\n  return l += function(t, e) {\r\n      var n = f()(h()(e)).sort()\r\n        , r = null\r\n        , a = !0\r\n        , o = !1\r\n        , i = void 0;\r\n      try {\r\n          for (var c, u = d()(n); !(a = (c = u.next()).done); a = !0) {\r\n              var l = c.value\r\n                , s = void 0;\r\n              s = void 0 !== e[l] && \"\" !== e[l] ? l + \"=\" + e[l] : l + e[l],\r\n              r = r ? r + \"&\" + s : s\r\n          }\r\n      } catch (t) {\r\n          o = !0,\r\n          i = t\r\n      } finally {\r\n          try {\r\n              !a && u.return && u.return()\r\n          } finally {\r\n              if (o)\r\n                  throw i\r\n          }\r\n      }\r\n      return r ? t + \"?\" + r : t\r\n  }(n.replace(/^(?=^.{3,255}$)(http(s)?:\\/\\/)?(www\\.)?[a-zA-Z0-9][-a-zA-Z0-9]{0,62}(\\.csdn\\.net)/, \"\"), c),\r\n  _.a.HmacSHA256(l, r).toString(_.a.enc.Base64)\r\n}\r\n*/\r\n\r\nfunction signCSDN0(apiPath, cookies = 'UserName=dvd37784302; UserToken=09fe1ed5d2e443cba7aaebd8513a5529') {\r\n\tvar once = createUuid()\r\n  var signStr = `GET\r\napplication/json, text/plain, */*\r\n\r\n\r\n\r\nx-ca-key:203796071\r\nx-ca-nonce:${once}\r\n${apiPath}`\r\n\tvar hash = CryptoJS.HmacSHA256(signStr, \"i5rbx2z2ivnxzidzpfc0z021imsp2nec\");\r\n\tvar hashInBase64 = CryptoJS.enc.Base64.stringify(hash);\r\n  return {\r\n    accept: 'application/json, text/plain, */*',\r\n    'x-ca-key': 203796071,\r\n    'x-ca-nonce': once,\r\n    'x-ca-signature': hashInBase64,\r\n    'x-ca-signature-headers':'x-ca-key,x-ca-nonce'\r\n  }\r\n}\r\n\r\nfunction validateFileExt(ext) {\r\n  switch (ext.toLowerCase()) {\r\n    case 'jpg':\r\n    case 'png':\r\n    case 'jpeg':\r\n    case 'gif':\r\n      return true\r\n    default:\r\n      return false\r\n  }\r\n}\r\n\r\nclass CSDNAdapter {\r\n  constructor() {\r\n    this.version = '0.0.1'\r\n    this.name = 'csdn'\r\n/*\r\n    modifyRequestHeaders('bizapi.csdn.net/', {\r\n    \tOrigin: 'https://editor.csdn.net',\r\n      Referer: 'https://editor.csdn.net/'\r\n    }, [\r\n    \t'*://bizapi.csdn.net/*',\r\n    ])\r\n*/\r\n  }\r\n\r\n  async getMetaData() {\r\n/*\r\n    var res = await $.get('https://me.csdn.net/api/user/show')\r\n*/\r\n    var headers = signCSDN0('/community-personal/v1/get-personal-info')\r\n    var res = await axios.get(\r\n      'https://bizapi.csdn.net/community-personal/v1/get-personal-info',\r\n      {\r\n        headers: headers,\r\n        withCredentials: true\r\n      }\r\n    )\r\n    return {\r\n      uid: res.data.data.basic.id,\r\n      title: res.data.data.basic.nickname,\r\n      avatar: res.data.data.general.avatar,\r\n      type: 'csdn',\r\n      displayName: 'CSDN',\r\n      supportTypes: ['markdown', 'html'],\r\n      home: 'https://mp.csdn.net/',\r\n      icon: 'https://g.csdnimg.cn/static/logo/favicon32.ico',\r\n    }\r\n  }\r\n\r\n  async requestUpload(filename) {\r\n    const api = 'https://imgservice.csdn.net/direct/v1.0/image/upload?watermark=&type=blog&rtype=markdown'\r\n    const fileExt = file.name.split('.').pop()\r\n    if (!validateFileExt(fileExt)) {\r\n      return null\r\n    }\r\n\r\n    var res = await axios({\r\n      url: api,\r\n      method: 'get',\r\n      headers: {\r\n        'x-image-app': 'direct_blog',\r\n        'x-image-suffix': fileExt,\r\n        'x-image-dir': 'direct'\r\n      },\r\n    })\r\n    if (res.status !== 200 || res.data.code !== 200) {\r\n      console.log(res)\r\n      return null\r\n    }\r\n    return res.data.data\r\n  }\r\n\r\n  async uploadFile(file) {\r\n    const uploadData = await requestUpload(file.name)\r\n    if (!uploadData) {\r\n      return [{url: file.src}]\r\n    }\r\n\r\n    const uploadUrl = uploadData.host\r\n    const form = new FormData()\r\n    form.append('key', uploadData.filePath)\r\n    form.append('policy', uploadData.policy)\r\n    form.append('OSSAccessKeyId', uploadData.accessId)\r\n    form.append('success_action_status', '200')\r\n    form.append('signature', uploadData.signature)\r\n    form.append('callback', uploadData.callbackUrl)\r\n\r\n    const f = new File([file.bits], 'temp', {\r\n      type: file.type\r\n    });\r\n    form.append('file', f)\r\n\r\n    var res = await axios({\r\n      url: uploadUrl,\r\n      method: 'post',\r\n      data: form\r\n    })\r\n    if (res.status !== 200 || res.data.code !== 200) {\r\n      console.log(res)\r\n      return [{url: file.src}]\r\n    }\r\n    return [{url: res.data.data.imageUrl}]\r\n  }\r\n\r\n  async addPost(post) {\r\n    return {\r\n      status: 'success',\r\n      post_id: 0,\r\n    }\r\n  }\r\n  async editPost(post_id, post) {\r\n\t\t// 支持HTML\r\n    if(!post.markdown) {\r\n      var turndownService = new turndown()\r\n    \tturndownService.use(tools.turndownExt)\r\n    \tvar markdown = turndownService.turndown(post.post_content)\r\n    \tconsole.log(markdown);\r\n    \tpost.markdown = markdown\r\n    }\r\n\r\n\t\tvar postStruct = {\r\n    \t    content: post.post_content,\r\n          markdowncontent: post.markdown,\r\n          not_auto_saved: \"1\",\r\n          readType: \"public\",\r\n          source: \"pc_mdeditor\",\r\n          status: 2,\r\n          title: post.post_title,\r\n    }\r\n\t\tvar headers = signCSDN('/blog-console-api/v3/mdeditor/saveArticle')\r\n    var res = await axios.post(\r\n      'https://bizapi.csdn.net/blog-console-api/v3/mdeditor/saveArticle',\r\n      postStruct,\r\n      {\r\n        headers: headers\r\n    })\r\n  \tpost_id = res.data.data.id\r\n    console.log(res)\r\n    return {\r\n      status: 'success',\r\n      post_id: post_id,\r\n      draftLink: 'https://editor.csdn.net/md?articleId=' + post_id,\r\n    }\r\n  }\r\n\r\n  async preEditPost(post) {\r\n    var div = $('<div>')\r\n    $('body').append(div)\r\n    try {\r\n      div.html(post.content)\r\n      var doc = div\r\n      tools.processDocCode(div)\r\n      tools.makeImgVisible(div)\r\n      var tempDoc = $('<div>').append(doc.clone())\r\n      post.content =\r\n        tempDoc.children('div').length == 1\r\n          ? tempDoc.children('div').html()\r\n          : tempDoc.html()\r\n\r\n      console.log('after.predEdit', post.content)\r\n    } catch (e) {\r\n      console.log('preEdit.error', e)\r\n    }\r\n  }\r\n}\r\n\n\n/***/ }),\n\n/***/ 333:\n/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {\n\n\"use strict\";\n__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   \"default\": () => (/* binding */ CnblogAdapter)\n/* harmony export */ });\n\r\nfunction getCookie(name, cookieStr) {\r\n  let arr,\r\n    reg = new RegExp('(^| )' + name + '=([^;]*)(;|$)')\r\n  if ((arr = cookieStr.match(reg))) {\r\n    return unescape(arr[2])\r\n  } else {\r\n    return ''\r\n  }\r\n}\r\n\r\nfunction parseTokenAndToHeaders(details, cookieKey, headerKey) {\r\n  var cookieHeader = details.requestHeaders.filter(h => {\r\n    return h.name.toLowerCase() == 'cookie'\r\n  })\r\n  if (cookieHeader.length) {\r\n    var cookieStr = cookieHeader[0].value\r\n    var _xsrf = getCookie(cookieKey, cookieStr)\r\n    if (_xsrf) {\r\n      details.requestHeaders.push({\r\n        name: headerKey,\r\n        value: _xsrf,\r\n      })\r\n    }\r\n  }\r\n}\r\n\r\n\r\nclass CnblogAdapter {\r\n  constructor() {\r\n    this.name = 'cnblog'\r\n    //\r\n    this.skipReadImage = true\r\n    modifyRequestHeaders('i.cnblogs.com/', {\r\n    \tOrigin: 'https://i.cnblogs.com',\r\n      Referer: 'https://i.cnblogs.com/'\r\n    }, [\r\n    \t'*://i.cnblogs.com/*',\r\n    ], function(details) {\r\n\t\t\t// parse token from cookie inject to headers\r\n      if (details.url.indexOf('i.cnblogs.com/api') > -1) {\r\n        parseTokenAndToHeaders(details, 'XSRF-TOKEN', 'x-xsrf-token')\r\n      }\r\n    })\r\n  }\r\n\r\n  async getMetaData() {\r\n    var res = await $.get('https://home.cnblogs.com/user/CurrentUserInfo')\r\n    var parser = new DOMParser()\r\n    var htmlDoc = parser.parseFromString(res, 'text/html')\r\n    var img = htmlDoc.getElementsByClassName('pfs')[0]\r\n    var link = img.parentNode.href\r\n    var pie = link.split('/')\r\n    pie.pop()\r\n    var uid = pie.pop()\r\n    console.log(link)\r\n    return {\r\n      uid: uid,\r\n      title: uid,\r\n      avatar: img.src,\r\n      type: 'cnblog',\r\n      displayName: 'CnBlog',\r\n      supportTypes: ['markdown', 'html'],\r\n      home: 'https://i.cnblogs.com/EditArticles.aspx?IsDraft=1',\r\n      icon: 'https://i.cnblogs.com/favicon.ico',\r\n    }\r\n  }\r\n\r\n  async uploadFile(file) {\r\n    //\r\n    return [\r\n      {\r\n        url: file.src,\r\n      }\r\n    ]\r\n  }\r\n\r\n  async addPost(post) {\r\n    if(!post.markdown) {\r\n      var turndownService = new turndown()\r\n      turndownService.use(tools.turndownExt)\r\n    \tvar markdown = turndownService.turndown(post.post_content)\r\n    \tconsole.log(markdown);\r\n    \tpost.markdown = markdown\r\n    }\r\n    var postId = null\r\n    try {\r\n      var res = await axios.post('https://i.cnblogs.com/api/posts', {\r\n          \"id\": null,\r\n          \"postType\": 2,\r\n          \"accessPermission\": 0,\r\n          \"title\": post.post_title,\r\n          \"url\": null,\r\n          \"postBody\": post.markdown,\r\n          \"categoryIds\": null,\r\n          \"inSiteCandidate\": false,\r\n          \"inSiteHome\": false,\r\n          \"siteCategoryId\": null,\r\n          \"blogTeamIds\": null,\r\n          \"isPublished\": false,\r\n          \"displayOnHomePage\": false,\r\n          \"isAllowComments\": true,\r\n          \"includeInMainSyndication\": true,\r\n          \"isPinned\": false,\r\n          \"isOnlyForRegisterUser\": false,\r\n          \"isUpdateDateAdded\": false,\r\n          \"entryName\": null,\r\n          \"description\": null,\r\n          \"tags\": null,\r\n          \"password\": null,\r\n          \"datePublished\": new Date().toISOString(),\r\n          \"isMarkdown\": true,\r\n          \"isDraft\": true,\r\n          \"autoDesc\": null,\r\n          \"changePostType\": false,\r\n          \"blogId\": 0,\r\n          \"author\": null,\r\n          \"removeScript\": false,\r\n          \"clientInfo\": null,\r\n          \"changeCreatedTime\": false,\r\n          \"canChangeCreatedTime\": false\r\n        })\r\n      console.log('CNBLOG addPost', res)\r\n      postId = res.data.id\r\n    } catch (e) {\r\n    }\r\n\r\n    return {\r\n      status: 'success',\r\n      post_id: postId,\r\n    }\r\n  }\r\n\r\n  async editPost(post_id, post) {\r\n    return {\r\n      status: 'success',\r\n      post_id: post_id,\r\n      draftLink:\r\n        'https://i.cnblogs.com/articles/edit;postId=' + post_id,\r\n    }\r\n  }\r\n\r\n  async preEditPost(post) {\r\n    var div = $('<div>')\r\n    $('body').append(div)\r\n\r\n    try {\r\n      div.html(post.content)\r\n      var doc = div\r\n      // var pres = doc.find(\"pre\");\r\n      tools.processDocCode(div)\r\n      tools.makeImgVisible(div)\r\n\r\n      var tempDoc = $('<div>').append(doc.clone())\r\n      post.content =\r\n        tempDoc.children('div').length == 1\r\n          ? tempDoc.children('div').html()\r\n          : tempDoc.html()\r\n\r\n      console.log('after.predEdit', post.content)\r\n    } catch (e) {\r\n      console.log('preEdit.error', e)\r\n    }\r\n  }\r\n}\r\n\r\n\n\n/***/ }),\n\n/***/ 862:\n/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {\n\n\"use strict\";\n__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   \"default\": () => (/* binding */ DiscuzAdapter)\n/* harmony export */ });\n// https://www.51hanghai.com/portal.php?mod=portalcp&ac=article\r\nvar _cacheMeta = null;\r\n\r\nclass DiscuzAdapter {\r\n  constructor(config) {\r\n    this.config = config || {}\r\n    var url = this.config.url\r\n    this.pubUrl = `${url}/portal.php?mod=portalcp&ac=article`\r\n    // this.upUrl = `${url}/misc.php?mod=swfupload&action=swfupload&operation=portal`\r\n    this.upUrl = `${url}/misc.php?mod=swfupload&action=swfupload&operation=upload`\r\n    this.name = 'discuz'\r\n\r\n    // this.skipReadImage = true\r\n  }\r\n\r\n  async getMetaData() {\r\n    var url = this.config.url;\r\n    console.log('discuz', this.config)\r\n    var postUrl = `${url}/portal.php?mod=portalcp&ac=article`\r\n    var favIcon = `${url}/favicon.ico`\r\n    var res = await $.get(postUrl)\r\n    var parser = new DOMParser()\r\n    var htmlDoc = parser.parseFromString(res, 'text/html')\r\n    var nickname = htmlDoc.querySelector('.vwmy').innerText\r\n    var img = htmlDoc.querySelector('.avt img').src\r\n\r\n    _cacheMeta = {\r\n      uid: img.split('uid=')[1].split('&size')[0],\r\n      title: nickname,\r\n      avatar: img,\r\n      type: 'discuz',\r\n      displayName: 'Discuz',\r\n      supportTypes: ['html'],\r\n      config: this.config,\r\n      home: postUrl,\r\n      icon: favIcon,\r\n    }\r\n\r\n    var uploadSrciptBlocks = [].slice.apply(htmlDoc.querySelectorAll('script')).filter(_ => _.innerText.indexOf('SWFUpload') > -1);\r\n    if(uploadSrciptBlocks.length) {\r\n      var scripText = uploadSrciptBlocks[0].innerText\r\n      var startTag = 'post_params:'\r\n      var strIndex =  scripText.indexOf(startTag)\r\n      var dataStr = scripText.substring(strIndex + startTag.length, scripText.indexOf('},', strIndex) + 1);\r\n      var post_params = new Function(\r\n        'var config = ' +\r\n        dataStr +\r\n          '; return config;'\r\n      )();\r\n      _cacheMeta.uploadToken = post_params.hash\r\n      _cacheMeta.raw = post_params\r\n    }\r\n    // var parser = new DOMParser()\r\n    // var htmlDoc = parser.parseFromString(res, 'text/html')\r\n    // var img = htmlDoc.querySelector('li.more.user > a > img')\r\n    return _cacheMeta\r\n  }\r\n\r\n  async addPost(post) {\r\n    return {\r\n      status: 'success',\r\n      post_id: 0,\r\n    }\r\n  }\r\n\r\n  async editPost(post_id, post) {\r\n    var postStruct = {}\r\n\r\n    if (post.markdown) {\r\n      postStruct = {\r\n        title: post.post_title,\r\n        catid: 24,\r\n        content: post.markdown,\r\n        romotepic: 1,\r\n      }\r\n    } else {\r\n      postStruct = {\r\n        title: post.post_title,\r\n        catid: 24,\r\n        romotepic: 1,\r\n        content: post.post_content,\r\n      }\r\n    }\r\n\r\n    // title: test\r\n    // highlight_style[0]:\r\n    // highlight_style[1]:\r\n    // highlight_style[2]:\r\n    // highlight_style[3]:\r\n    // htmlname:\r\n    // oldhtmlname:\r\n    // pagetitle:\r\n    // catid: 24\r\n    // from:\r\n    postStruct.fromurl = null\r\n    postStruct.dateline = null\r\n    postStruct.from_idtyp = `tid`\r\n    postStruct.from_id = 0\r\n    postStruct.id = 0\r\n    postStruct.idtype = `tid`;\r\n    postStruct.url = null;\r\n    postStruct.author = null;\r\n    // conver: a:3:{s:3:\"pic\";s:0:\"\";s:5:\"thumb\";i:0;s:6:\"remote\";i:0;}\r\n    // file: (binary)\r\n    // file: (binary)\r\n    // content: test\r\n    // romotepic: 1\r\n    // summary:\r\n    // aid:\r\n    // cid:\r\n    // attach_ids:\r\n    // articlesubmit: true\r\n    postStruct.articlesubmit = true;\r\n    postStruct.formhash = `caa4c6cb`\r\n    postStruct.conver = `a:3:{s:3:\"pic\";s:0:\"\";s:5:\"thumb\";i:0;s:6:\"remote\";i:0;}`;\r\n    // var res = await $.ajax({\r\n    //   url: this.pubUrl,\r\n    //   type: 'POST',\r\n    //   dataType: 'JSON',\r\n    //   data: postStruct,\r\n    // })\r\n    // if (!res.data) {\r\n    //   throw new Error(res.message)\r\n    // }\r\n    setCache('discuz_cache', JSON.stringify(postStruct))\r\n\r\n    return {\r\n      status: 'success',\r\n      post_id: 0,\r\n      draftLink: `${this.config.url}/forum.php?mod=guide&view=my&loaddraft`,\r\n    }\r\n  }\r\n\r\n  async uploadFile(file) {\r\n    var id = Date.now() + Math.floor(Math.random()* 1000);\r\n    return [\r\n      {\r\n        id: id,\r\n        object_key: id,\r\n        url: file.src,\r\n      },\r\n    ]\r\n    var src = file.src\r\n    // var file = new File([file.bits], 'temp', {\r\n    //   type: file.type,\r\n    // })\r\n    var blob = new Blob([file.bits], {\r\n      type: file.type,\r\n    })\r\n    var formdata = new FormData()\r\n\r\n    formdata.append('uid', _cacheMeta.uid)\r\n    formdata.append('hash', _cacheMeta.uploadToken)\r\n    formdata.append('filetype', '.jpg')\r\n    formdata.append('type', 'image')\r\n    formdata.append('aid', '0')\r\n    // formdata.append('catid', '19')\r\n    // formdata.append('Filedata', blob)\r\n    formdata.append('Filedata', blob, new Date().getTime() + '.jpg')\r\n    formdata.append('size', blob.size)\r\n    formdata.append('id', 'WU_FILE_1')\r\n    var res = await axios({\r\n      url: this.upUrl,\r\n      method: 'post',\r\n      data: formdata,\r\n      headers: { 'Content-Type': 'multipart/form-data' },\r\n    })\r\n\r\n    var imageHtmlRes = await axios.get(`${this.config.url}/forum.php?mod=ajax&action=imagelist&type=single&pid=0&aids=` + res.data)\r\n    var parser = new DOMParser()\r\n    var htmlDoc = parser.parseFromString(imageHtmlRes.data, 'text/html')\r\n    var imgSrc = `${this.config.url}/` + htmlDoc.querySelector(\"img\").getAttribute('src')\r\n    console.log('upload.res', imageHtmlRes)\r\n    var imageId = Date.now() +Math.floor( Math.random() * 10);\r\n    // if (res.data.aid === false) {\r\n    //   throw new Error('图片上传失败 ' + src)\r\n    // }\r\n    // http only\r\n    console.log('uploadFile', res)\r\n    return [\r\n       {\r\n        id: imageId,\r\n        object_key: imageId,\r\n        url: imgSrc\r\n      },\r\n      // {\r\n      //   id: res.data.aid,\r\n      //   object_key: res.data.aid,\r\n      //   url: res.data.bigimg,\r\n      //   // size: res.data.data.size,\r\n      //   // images: [res.data],\r\n      // },\r\n    ]\r\n  }\r\n\r\n  async preEditPost(post) {\r\n    var div = $('<div>')\r\n    $('body').append(div)\r\n\r\n    div.html(post.content)\r\n    // var org = $(post.content);\r\n    // var doc = $('<div>').append(org.clone());\r\n    var doc = div\r\n    var pres = doc.find('a')\r\n    for (let mindex = 0; mindex < pres.length; mindex++) {\r\n      const pre = pres.eq(mindex)\r\n      try {\r\n        pre.after(pre.html()).remove()\r\n      } catch (e) {}\r\n    }\r\n\r\n    var pres = doc.find('iframe')\r\n    for (let mindex = 0; mindex < pres.length; mindex++) {\r\n      const pre = pres.eq(mindex)\r\n      try {\r\n        pre.remove()\r\n      } catch (e) {}\r\n    }\r\n\r\n    try {\r\n      const images = doc.find('img')\r\n      for (let index = 0; index < images.length; index++) {\r\n        const image = images.eq(index)\r\n        const imgSrc = image.attr('src')\r\n        if (imgSrc && imgSrc.indexOf('.svg') > -1) {\r\n          console.log('remove svg Image')\r\n          image.remove()\r\n        }\r\n      }\r\n      const qqm = doc.find('qqmusic')\r\n      qqm.next().remove()\r\n      qqm.remove()\r\n    } catch (e) {}\r\n\r\n    post.content = $('<div>')\r\n      .append(doc.clone())\r\n      .html()\r\n    console.log('post', post)\r\n  }\r\n\r\n  editImg(img, source) {\r\n    img.removeAttr('crossorigin')\r\n    img.attr('referrerpolicy', \"no-referrer\")\r\n  }\r\n}\r\n\n\n/***/ }),\n\n/***/ 513:\n/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {\n\n\"use strict\";\n__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   \"default\": () => (/* binding */ JuejinAdapter)\n/* harmony export */ });\nclass JuejinAdapter {\r\n  constructor(ac) {\r\n    this.version = '0.0.2'\r\n    this.name = 'juejin'\r\n\r\n    // modify origin headers\r\n    modifyRequestHeaders('api.juejin.cn', {\r\n      Origin: 'https://juejin.cn',\r\n      Referer: 'https://juejin.cn/'\r\n    }, [\r\n      '*://api.juejin.cn/*',\r\n    ], function (details) {\r\n      if (details.initiator && details.initiator.indexOf('juejin.cn') > -1) {\r\n        details.requestHeaders = details.requestHeaders.map(_ => {\r\n          if (_.name === 'Origin') {\r\n            _.value = details.initiator\r\n          }\r\n\r\n          if (_.name === 'Referer') {\r\n            _.value = details.initiator + '/'\r\n          }\r\n\r\n          return _\r\n        })\r\n      }\r\n    })\r\n\r\n  }\r\n\r\n  async getMetaData() {\r\n    var data = await $.get('https://api.juejin.cn/user_api/v1/user/get')\r\n    console.log(data)\r\n    return {\r\n      uid: data.data.user_id,\r\n      title: data.data.user_name,\r\n      avatar: data.data.avatar_large,\r\n      type: 'juejin',\r\n      displayName: '掘金',\r\n      raw: data.data,\r\n      supportTypes: ['markdown', 'html'],\r\n      home: 'https://juejin.cn/editor/drafts',\r\n      icon: 'https://juejin.cn/favicon.ico',\r\n    }\r\n  }\r\n\r\n  async addPost(post, _instance) {\r\n    return {\r\n      status: 'success',\r\n      post_id: 0,\r\n    }\r\n  }\r\n\r\n  async editPost(post_id, post) {\r\n    console.log('TurndownService', turndown)\r\n    var turndownService = new turndown()\r\n    turndownService.use(tools.turndownExt)\r\n    var markdown = turndownService.turndown(post.post_content)\r\n    const { data } = await axios.post('https://api.juejin.cn/content_api/v1/article_draft/create', {\r\n      brief_content: '',\r\n      category_id: '0',\r\n      cover_image: '',\r\n      edit_type: 10,\r\n      html_content: \"deprecated\",\r\n      link_url: \"\",\r\n      mark_content: markdown,\r\n      tag_ids: [],\r\n      title: post.post_title\r\n    })\r\n    var post_id = data.data.id\r\n    console.log(data)\r\n    return {\r\n      status: 'success',\r\n      post_id: post_id,\r\n      draftLink: 'https://juejin.cn/editor/drafts/' + post_id,\r\n    }\r\n  }\r\n\r\n  async uploadFile(file) {\r\n    var src = file.src\r\n    var imageId = Date.now() + Math.floor(Math.random() * 1000)\r\n    const { data } = await axios.post('https://juejin.cn/image/urlSave', {\r\n      url: src\r\n    })\r\n    return [\r\n      {\r\n        id: imageId,\r\n        object_key: imageId,\r\n        url: data.data,\r\n      },\r\n    ]\r\n  }\r\n\r\n  async preEditPost(post) {\r\n    var div = $('<div>')\r\n    $('body').append(div)\r\n    try {\r\n      console.log('zihu.Juejin')\r\n      div.html(post.content)\r\n      var doc = div\r\n      tools.processDocCode(div)\r\n      tools.makeImgVisible(div)\r\n\r\n      var tempDoc = $('<div>').append(doc.clone())\r\n      post.content =\r\n        tempDoc.children('div').length == 1\r\n          ? tempDoc.children('div').html()\r\n          : tempDoc.html()\r\n\r\n      console.log('after.predEdit', post.content)\r\n    } catch (e) {\r\n      console.log('preEdit.error', e)\r\n    }\r\n  }\r\n\r\n  addPromotion(post) {\r\n    var sharcode = `<blockquote><p>本文使用 <a href=\"https://juejin.cn/post/6940875049587097631\" class=\"internal\">文章同步助手</a> 同步</p></blockquote>`\r\n    post.content = post.content.trim() + `${sharcode}`\r\n  }\r\n}\r\n\n\n/***/ }),\n\n/***/ 991:\n/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {\n\n\"use strict\";\n__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   \"default\": () => (/* binding */ SegmentfaultAdapter)\n/* harmony export */ });\nclass SegmentfaultAdapter {\r\n  constructor() {\r\n    this.name = 'segmentfault'\r\n    modifyRequestHeaders('gateway.segmentfault.com/', {\r\n    \tOrigin: 'https://segmentfault.com',\r\n      Referer: 'https://segmentfault.com/'\r\n    }, [\r\n    \t'*://gateway.segmentfault.com/*',\r\n    ])\r\n  }\r\n\r\n  async getMetaData() {\r\n    var res = await $.get('https://segmentfault.com/user/settings')\r\n    var parser = new DOMParser()\r\n    var htmlDoc = parser.parseFromString(res, 'text/html')\r\n    var link = htmlDoc.getElementsByClassName('user-avatar')[0]\r\n    if (!link) {\r\n      throw Error('not found')\r\n    }\r\n\r\n    var uid = link.href.split('/').pop()\r\n    var avatar = link.style['background-image']\r\n      .replace('url(\"', '')\r\n      .replace('\")', '')\r\n    console.log(\r\n      link.href,\r\n      link.style['background-image'].replace('url(\"', '').replace('\")', '')\r\n    )\r\n\r\n    return {\r\n      uid: uid,\r\n      title: uid,\r\n      avatar: avatar,\r\n      type: 'segmentfault',\r\n      displayName: 'Segmentfault',\r\n      supportTypes: ['markdown', 'html'],\r\n      home: 'https://segmentfault.com/user/draft',\r\n      icon:\r\n        'https://imgcache.iyiou.com/Company/2016-05-11/cf-segmentfault.jpg',\r\n    }\r\n  }\r\n\r\n  async addPost(post) {\r\n    return {\r\n      status: 'success',\r\n      post_id: 0\r\n    }\r\n  }\r\n\r\n  async editPost(post_id, post) {\r\n    if(!post.markdown) {\r\n      var turndownService = new turndown()\r\n      turndownService.use(tools.turndownExt)\r\n      var markdown = turndownService.turndown(post.post_content)\r\n      post.markdown = markdown\r\n      console.log(markdown)\r\n    }\r\n\r\n    const pageHtml = await $.get('https://segmentfault.com/write')\r\n    const markStr = 'window.g_initialProps = '\r\n    const authIndex = pageHtml.indexOf(markStr)\r\n    if(authIndex == -1) {\r\n    \tthrow new Error('登录失效 authIndex=' + authIndex)\r\n    }\r\n\r\n    const authTokenStr = pageHtml.substring(authIndex + markStr.length, pageHtml.indexOf(`;\r\n\t</script>`, authIndex))\r\n\r\n    const pageConfig = new Function(\r\n      'var config = ' +\r\n        authTokenStr +\r\n        '; return config;'\r\n    )();\r\n\r\n    const token = pageConfig.global.sessionInfo.key\r\n\r\n    var postStruct = {\r\n      \"title\":post.post_title,\r\n      \"tags\":[],\r\n      \"text\": post.markdown,\r\n      \"object_id\":\"\",\r\n      \"type\":\"article\"\r\n    }\r\n\r\n    var res = await axios.post('https://gateway.segmentfault.com/draft', postStruct, {\r\n    \theaders: {\r\n      \ttoken: token,\r\n        accept: '*/*',\r\n    \t\t'content-type': 'application/json',\r\n      }\r\n    })\r\n    post_id = res.data.id\r\n    return {\r\n      status: 'success',\r\n      post_id: post_id,\r\n      draftLink: 'https://segmentfault.com/write?draftId=' + post_id,\r\n    }\r\n  }\r\n\r\n  async uploadFile(file) {\r\n    var formdata = new FormData()\r\n    var blob = new Blob([file.bits])\r\n    formdata.append('image', blob)\r\n    var res = await axios({\r\n      url: 'https://segmentfault.com/img/upload/image',\r\n      method: 'post',\r\n      data: formdata,\r\n      headers: { 'Content-Type': 'multipart/form-data' },\r\n    })\r\n    if(res.data[0] == 1) {\r\n      throw new Error(res.data[1])\r\n    }\r\n    var url = res.data[1]\r\n    return [\r\n      {\r\n        id: res.data[2],\r\n        object_key: res.data[2],\r\n        url: url,\r\n      },\r\n    ]\r\n  }\r\n\r\n  async preEditPost(post) {\r\n    var div = $('<div>')\r\n    $('body').append(div)\r\n\r\n    try {\r\n      // post.content = post.content.replace(/\\>\\s+\\</g,'');\r\n      console.log('zihu.Juejin')\r\n      div.html(post.content)\r\n      // var org = $(post.content);\r\n      // var doc = $('<div>').append(org.clone());\r\n      var doc = div\r\n      // var pres = doc.find(\"pre\");\r\n      tools.processDocCode(div)\r\n      tools.makeImgVisible(div)\r\n\r\n      var tempDoc = $('<div>').append(doc.clone())\r\n      post.content =\r\n        tempDoc.children('div').length == 1\r\n          ? tempDoc.children('div').html()\r\n          : tempDoc.html()\r\n\r\n      console.log('after.predEdit', post.content)\r\n    } catch (e) {\r\n      console.log('preEdit.error', e)\r\n    }\r\n  }\r\n\r\n  async uploadFileByForm($file) {\r\n    var formdata = new FormData()\r\n    formdata.append('image', $file)\r\n    var res = await axios({\r\n      url: 'https://segmentfault.com/img/upload/image',\r\n      method: 'post',\r\n      data: formdata,\r\n      headers: { 'Content-Type': 'multipart/form-data' },\r\n    })\r\n    var url = 'https://image-static.segmentfault.com/' + res.data[2]\r\n    return url\r\n  }\r\n}\r\n\n\n/***/ }),\n\n/***/ 762:\n/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {\n\n\"use strict\";\n__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   \"default\": () => (/* binding */ WeiboAdapter)\n/* harmony export */ });\nvar cacheWeiboUser = null\r\n// var Readability = require(\"../reader/Readability\");\r\n\r\n// fetch(\"https://card.weibo.com/article/v3/aj/editor/draft/save?uid=1820387812&id=402\", { \"credentials\": \"include\", \"headers\": { \"accept\": \"application/json, text/plain, */*\", \"accept-language\": \"zh-CN,zh;q=0.9\", \"content-type\": \"application/x-www-form-urlencoded\" }, \"referrer\": \"https://card.weibo.com/article/v3/editor\", \"referrerPolicy\": \"no-referrer-when-downgrade\", \"body\": \"id=402&title=aaaaaaaaaaa&updated=2019-10-10%2016%3A06%3A43&subtitle=&type=&status=0&publish_at=&error_msg=&error_code=0&collection=%5B%5D&free_content=&content=%3Cp%20align%3D%22justify%22%3Eaaaaaaaaaaaaa%3C%2Fp%3E&cover=https%3A%2F%2Fwx3.sinaimg.cn%2Flarge%2F6c80e9e4ly1g7t62jq7uzj202s01kdfz.jpg&summary=aaa&writer=&extra=null&is_word=0&article_recommend=%5B%5D&follow_to_read=1&isreward=1&pay_setting=%7B%22ispay%22%3A0%2C%22isvclub%22%3A0%7D&source=0&action=1&save=1\", \"method\": \"POST\", \"mode\": \"cors\" });\r\n\r\nclass WeiboAdapter {\r\n  constructor() {\r\n    this.name = 'weibo'\r\n  }\r\n\r\n  async getMetaData() {\r\n    var html = await $.get('https://card.weibo.com/article/v3/editor')\r\n    var configIndx = html.indexOf('$CONFIG')\r\n    var lastIndex = html.indexOf('</script>', configIndx)\r\n    var configStr = html.substring(configIndx - 12, lastIndex)\r\n\r\n    if (configStr.indexOf('CONFIG') > -1) {\r\n      var res = new Function(configStr + ' return $CONFIG;')()\r\n      cacheWeiboUser = res\r\n      return {\r\n        uid: res.uid,\r\n        title: res.nick,\r\n        avatar: res.avatar_large,\r\n        supportTypes: ['html'],\r\n        displayName: '微博',\r\n        type: 'weibo',\r\n        home: 'https://card.weibo.com/article/v3/editor',\r\n        icon: 'https://weibo.com/favicon.ico',\r\n      }\r\n    } else {\r\n      throw new Error('not found')\r\n    }\r\n  }\r\n\r\n  async addPost(post) {\r\n    var res = await $.post(\r\n      'https://card.weibo.com/article/v3/aj/editor/draft/create?uid=' +\r\n        cacheWeiboUser.uid\r\n    )\r\n    if (res.code != 100000) {\r\n      throw new Error(res.msg)\r\n      return\r\n    }\r\n\r\n    console.log(res)\r\n    var post_id = res.data.id\r\n\r\n    var res = await $.ajax({\r\n      url:\r\n        'https://card.weibo.com/article/v3/aj/editor/draft/save?uid=' +\r\n        cacheWeiboUser.uid +\r\n        '&id=' +\r\n        post_id,\r\n      type: 'POST',\r\n      dataType: 'JSON',\r\n      headers: {\r\n        accept: 'application/json',\r\n      },\r\n      data: {\r\n        id: post_id,\r\n        title: post.post_title,\r\n        subtitle: '',\r\n        type: '',\r\n        status: '0',\r\n        publish_at: '',\r\n        error_msg: '',\r\n        error_code: '0',\r\n        collection: '[]',\r\n        free_content: '',\r\n        content: post.post_content,\r\n        cover: '',\r\n        summary: '',\r\n        writer: '',\r\n        extra: 'null',\r\n        is_word: '0',\r\n        article_recommend: '[]',\r\n        follow_to_read: '1',\r\n        isreward: '1',\r\n        pay_setting: '{\"ispay\":0,\"isvclub\":0}',\r\n        source: '0',\r\n        action: '1',\r\n        content_type: '0',\r\n        save: '1',\r\n      },\r\n      // data: {\r\n      //   id: post_id,\r\n      //   title: post.post_title,\r\n      //   status: 0,\r\n      //   error_code: 0,\r\n      //   content: post.post_content,\r\n      //   cover: \"\",\r\n      //   // summary: 'aaaab',\r\n      //   writer: \"\",\r\n      //   is_word: 0,\r\n      //   article_recommend: [],\r\n      //   follow_to_read: 1,\r\n      //   isreward: 1,\r\n      //   pay_setting: JSON.stringify({ ispay: 0, isvclub: 0 }),\r\n      //   source: 0,\r\n      //   action: 1,\r\n      //   save: 1\r\n      // }\r\n    })\r\n    console.log(res)\r\n    return {\r\n      status: 'success',\r\n      post_id: post_id,\r\n    }\r\n  }\r\n\r\n  async preEditPost(post) {\r\n    var div = $('<div>')\r\n    $('body').append(div)\r\n    try {\r\n      div.html(post.content)\r\n      var doc = div\r\n      tools.processDocCode(div)\r\n      tools.makeImgVisible(div)\r\n\r\n      var tempDoc = $('<div>').append(doc.clone())\r\n      post.content =\r\n        tempDoc.children('div').length == 1\r\n          ? tempDoc.children('div').html()\r\n          : tempDoc.html()\r\n\r\n      console.log('after.predEdit', post.content)\r\n    } catch (e) {\r\n      console.log('preEdit.error', e)\r\n    }\r\n\r\n    var rexp = new RegExp('>[\\ts ]*<', 'g')\r\n    var result = post.content.replace(rexp, '><')\r\n\r\n    post.content = result\r\n  }\r\n\r\n\r\n  async editPost(post_id, post) {\r\n    var res = await $.ajax({\r\n      url:\r\n        'https://card.weibo.com/article/v3/aj/editor/draft/save?uid=' +\r\n        cacheWeiboUser.uid +\r\n        '&id=' +\r\n        post_id,\r\n      type: 'POST',\r\n      dataType: 'JSON',\r\n      headers: {\r\n        accept: 'application/json',\r\n      },\r\n      data: {\r\n        id: post_id,\r\n        title: post.post_title,\r\n        subtitle: '',\r\n        type: '',\r\n        status: '0',\r\n        publish_at: '',\r\n        error_msg: '',\r\n        error_code: '0',\r\n        collection: '[]',\r\n        free_content: '',\r\n        content: post.post_content,\r\n        cover: post.post_thumbnail_raw ? post.post_thumbnail_raw.url : '',\r\n        summary: '',\r\n        writer: '',\r\n        extra: 'null',\r\n        is_word: '0',\r\n        article_recommend: '[]',\r\n        follow_to_read: '1',\r\n        isreward: '1',\r\n        pay_setting: '{\"ispay\":0,\"isvclub\":0}',\r\n        source: '0',\r\n        action: '1',\r\n        content_type: '0',\r\n        save: '1',\r\n      },\r\n      // data: {\r\n      //   id: post_id,\r\n      //   title: post.post_title,\r\n      //   status: 0,\r\n      //   error_code: 0,\r\n      //   content: post.post_content,\r\n      //   cover: post.post_thumbnail_raw ? post.post_thumbnail_raw.url : \"\",\r\n      //   // summary: 'aaaab',\r\n      //   writer: \"\",\r\n      //   is_word: 0,\r\n      //   article_recommend: [],\r\n      //   follow_to_read: 1,\r\n      //   isreward: 1,\r\n      //   pay_setting: JSON.stringify({ ispay: 0, isvclub: 0 }),\r\n      //   source: 0,\r\n      //   action: 1,\r\n      //   save: 1\r\n      // }\r\n    })\r\n\r\n    if(res.code == '111006') {\r\n      throw new Error(res.msg)\r\n    }\r\n    console.log(res)\r\n    return {\r\n      status: 'success',\r\n      post_id: post_id,\r\n      draftLink: 'https://card.weibo.com/article/v3/editor#/draft/' + post_id,\r\n    }\r\n  }\r\n\r\n  untiImageDone(src) {\r\n    return new Promise((resolve, reject) => {\r\n      ;(async function loop() {\r\n        var res = await $.ajax({\r\n          url:\r\n            'https://card.weibo.com/article/v3/aj/editor/plugins/asyncimginfo?uid=' +\r\n            cacheWeiboUser.uid,\r\n          type: 'POST',\r\n          headers: {\r\n            accept: '*/*',\r\n            'x-requested-with': 'fetch',\r\n          },\r\n          data: {\r\n            'urls[0]': src,\r\n          },\r\n        })\r\n\r\n        var done = res.data[0].task_status_code == 1\r\n        if (done) {\r\n          resolve(res.data[0])\r\n        } else {\r\n          setTimeout(loop, 1000)\r\n        }\r\n      })()\r\n    })\r\n  }\r\n\r\n  async uploadFileByUrl(file) {\r\n    var src = file.src\r\n    var res = await $.ajax({\r\n      url:\r\n        'https://card.weibo.com/article/v3/aj/editor/plugins/asyncuploadimg?uid=' +\r\n        cacheWeiboUser.uid,\r\n      type: 'POST',\r\n      headers: {\r\n        accept: '*/*',\r\n        'x-requested-with': 'fetch',\r\n      },\r\n      data: {\r\n        'urls[0]': src,\r\n      },\r\n    })\r\n\r\n    // https://card.weibo.com/article/v3/aj/editor/plugins/asyncuploadimg?uid=1820387812\r\n    var imgDetail = await this.untiImageDone(src)\r\n    return [\r\n      {\r\n        id: imgDetail.pid,\r\n        object_key: imgDetail.pid,\r\n        url: imgDetail.url,\r\n      },\r\n    ]\r\n  }\r\n\r\n  async uploadFile(file) {\r\n    var blob = new Blob([file.bits])\r\n    console.log('uploadFile', file, blob)\r\n    var uploadurl1 = `https://picupload.weibo.com/interface/pic_upload.php?app=miniblog&s=json&p=1&data=1&url=&markpos=1&logo=0&nick=&file_source=4`\r\n    var uploadurl2 = 'https://picupload.weibo.com/interface/pic_upload.php?app=miniblog&s=json&p=1&data=1&url=&markpos=1&logo=0&nick='\r\n    var fileResp = await $.ajax({\r\n      url:\r\n      uploadurl1,\r\n      type: 'POST',\r\n      processData: false,\r\n      data: new Blob([file.bits]),\r\n    })\r\n    console.log(file, fileResp)\r\n    return [\r\n      {\r\n        id: fileResp.data.pics.pic_1.pid,\r\n        object_key: fileResp.data.pics.pic_1.pid,\r\n        url:\r\n          'https://wx3.sinaimg.cn/large/' +\r\n          fileResp.data.pics.pic_1.pid +\r\n          '.jpg',\r\n      },\r\n    ]\r\n  }\r\n\r\n\r\n  addPromotion(post) {\r\n    var sharcode = `<blockquote>本文使用 <a href=\"https://zhuanlan.zhihu.com/p/358098152\" class=\"internal\">文章同步助手</a> 同步</blockquote>`\r\n    post.content = post.content.trim() + `${sharcode}`\r\n  }\r\n}\r\n\n\n/***/ }),\n\n/***/ 466:\n/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {\n\n\"use strict\";\n__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   \"default\": () => (/* binding */ YiDianAdapter)\n/* harmony export */ });\nclass YiDianAdapter {\r\n  constructor() {\r\n    this.skipReadImage = true\r\n  }\r\n\r\n  async getMetaData() {\r\n    var res = await $.ajax({ url: 'https://mp.yidianzixun.com' })\r\n    var innerDoc = $(res)\r\n    var doc = $('<div>').append(innerDoc.clone())\r\n    var code = doc.find('#__val_').text()\r\n    console.log('YiDian', code)\r\n    // code = code.substring(code.indexOf(\"window.mpuser\"));\r\n    // eval(code);\r\n    var mpuser = new Function(code + '; return window.mpuser;')()\r\n    var commonData = Object.assign({}, mpuser)\r\n    console.log(commonData)\r\n    if (!commonData.id) {\r\n      throw new Error('未登录')\r\n    }\r\n    var metadata = {\r\n      uid: commonData.id,\r\n      title: commonData.media_name,\r\n      commonData: commonData,\r\n      avatar: commonData.media_pic,\r\n      type: 'yidian',\r\n      supportTypes: ['html'],\r\n      home: 'https://mp.yidianzixun.com',\r\n      icon: 'https://www.yidianzixun.com/favicon.ico',\r\n    }\r\n    return metadata\r\n  }\r\n\r\n  async addPost(post) {\r\n    return {\r\n      status: 'success',\r\n      post_id: 0,\r\n    }\r\n  }\r\n\r\n  async editPost(post_id, post) {\r\n    var res = await $.ajax({\r\n      url: 'https://mp.yidianzixun.com/model/Article',\r\n      type: 'POST',\r\n      dataType: 'JSON',\r\n      data: {\r\n        title: post.post_title,\r\n        cate: '',\r\n        cateB: '',\r\n        coverType: 'default',\r\n        covers: [],\r\n        content: post.post_content,\r\n        hasSubTitle: 0,\r\n        subTitle: '',\r\n        original: 0,\r\n        reward: 0,\r\n        videos: [],\r\n        audios: [],\r\n        votes: {\r\n          vote_id: '',\r\n          vote_options: [],\r\n          vote_end_time: '',\r\n          vote_title: '',\r\n          vote_type: 1,\r\n          isAdded: false,\r\n        },\r\n        images: [],\r\n        goods: [],\r\n        is_mobile: 0,\r\n        status: 0,\r\n        import_url: '',\r\n        import_hash: '',\r\n        image_urls: {},\r\n        minTimingHour: 3,\r\n        maxTimingDay: 7,\r\n        tags: [],\r\n        isPubed: false,\r\n        lastSaveTime: '',\r\n        dirty: false,\r\n        editorType: 'articleEditor',\r\n        activity_id: 0,\r\n        join_activity: 0,\r\n        notSaveToStore: true,\r\n      },\r\n    })\r\n\r\n    if (!res.id) {\r\n      throw new Error('同步错误' + JSON.stringify(res))\r\n    }\r\n    return {\r\n      status: 'success',\r\n      post_id: res.id,\r\n      draftLink: 'https://mp.yidianzixun.com/#/Writing/' + res.id,\r\n    }\r\n  }\r\n\r\n  async uploadFile(file) {\r\n    var src = file.src\r\n    var res = await $.get(\r\n      'https://mp.yidianzixun.com/api/getImageFromUrl?src=' +\r\n        encodeURIComponent(src)\r\n    )\r\n    // throw new Error('fuck');\r\n    if (res.status != 'success') {\r\n      throw new Error('图片上传失败 ' + src)\r\n    }\r\n    // http only\r\n    console.log('uploadFile', res)\r\n    return [\r\n      {\r\n        id: '',\r\n        object_key: '',\r\n        url: res.inner_addr,\r\n      },\r\n    ]\r\n  }\r\n\r\n  async preEditPost(post) {\r\n    // var div = $(\"<div>\");\r\n    // $(\"body\").append(div);\r\n    // div.html(post.content);\r\n    // // var org = $(post.content);\r\n    // // var doc = $('<div>').append(org.clone());\r\n    // var doc = div;\r\n    // var pres = doc.find(\"a\");\r\n    // for (let mindex = 0; mindex < pres.length; mindex++) {\r\n    //   const pre = pres.eq(mindex);\r\n    //   try {\r\n    //     pre.after(pre.html()).remove();\r\n    //   } catch (e) {}\r\n    // }\r\n    // var pres = doc.find(\"iframe\");\r\n    // for (let mindex = 0; mindex < pres.length; mindex++) {\r\n    //   const pre = pres.eq(mindex);\r\n    //   try {\r\n    //     pre.remove();\r\n    //   } catch (e) {}\r\n    // }\r\n    // post.content = $(\"<div>\")\r\n    //   .append(doc.clone())\r\n    //   .html();\r\n    // console.log(\"post\", post);\r\n  }\r\n\r\n  //   editImg(img, source) {\r\n  //     img.attr(\"web_uri\", source.images[0].origin_web_uri);\r\n  //   }\r\n  //   <img class=\"\" src=\"http://p2.pstatp.com/large/pgc-image/bc0a9fc8e595453083d85deb947c3d6e\" data-ic=\"false\" data-ic-uri=\"\" data-height=\"1333\" data-width=\"1000\" image_type=\"1\" web_uri=\"pgc-image/bc0a9fc8e595453083d85deb947c3d6e\" img_width=\"1000\" img_height=\"1333\"></img>\r\n}\r\n\n\n/***/ }),\n\n/***/ 826:\n/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {\n\n\"use strict\";\n__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   \"default\": () => (/* binding */ BaiJiaHaoAdapter)\n/* harmony export */ });\n\r\nclass BaiJiaHaoAdapter {\r\n  constructor() {\r\n    this.version = '0.0.1'\r\n    modifyRequestHeaders('baijiahao.baidu.com/', {\r\n    \tOrigin: 'https://baijiahao.baidu.com',\r\n      Referer: 'https://baijiahao.baidu.com/'\r\n    }, [\r\n    \t'*://baijiahao.baidu.com/*',\r\n    ])\r\n  }\r\n\r\n  async getMetaData() {\r\n    const { data } = await axios.get('https://baijiahao.baidu.com/builder/app/appinfo?_=' + Date.now())\r\n    console.log(data)\r\n    if(data.errmsg != 'success') {\r\n    \tthrow new Error('not found')\r\n    }\r\n    const accountInfo = data.data.user\r\n    return {\r\n      uid: accountInfo.userid,\r\n      title: accountInfo.name,\r\n      avatar: accountInfo.avatar,\r\n      type: 'baijiahao',\r\n      displayName: '百家号',\r\n      supportTypes: ['html'],\r\n      home: 'https://baijiahao.baidu.com/',\r\n      icon: 'https://www.baidu.com/favicon.ico?t=20171027',\r\n    }\r\n  }\r\n\r\n  async addPost(post, _instance) {\r\n    return {\r\n      status: 'success',\r\n      post_id: 0,\r\n    }\r\n  }\r\n\r\n  async editPost(post_id, post) {\r\n    // todo\r\n    const pageHtml = await $.get('https://baijiahao.baidu.com/builder/rc/edit')\r\n    const markStr = 'window.__BJH__INIT__AUTH__=\"'\r\n    const authIndex = pageHtml.indexOf(markStr)\r\n    if(authIndex == -1) {\r\n    \tthrow new Error('登录失效')\r\n    }\r\n\r\n    const authToken = pageHtml.substring(authIndex + markStr.length, pageHtml.indexOf('\",window.__BJH__EDIT_', authIndex))\r\n\r\n\r\n\r\n\r\n    const postStruct = {\r\n      title: post.post_title,\r\n      content: post.post_content,\r\n      feed_cat: 1,\r\n      len: post.post_content.length,\r\n      activity_list: [\r\n        {\r\n        \tid: 408,\r\n          is_checked: 0\r\n        }\r\n      ],\r\n      source_reprinted_allow: 0,\r\n      original_status: 0,\r\n      original_handler_status: 1,\r\n      isBeautify: false,\r\n      subtitle: '',\r\n      bjhtopic_id: '',\r\n      bjhtopic_info: '',\r\n      type: 'news',\r\n    }\r\n    const res = await $.ajax({\r\n    \turl: 'https://baijiahao.baidu.com/pcui/article/save?callback=bjhdraft',\r\n      type: 'POST',\r\n      dataType: 'JSON',\r\n      headers: {\r\n        token: authToken\r\n      },\r\n      data: postStruct,\r\n    })\r\n\r\n    console.log(\"request baijiahao article save interface res: \", JSON.stringify(res))\r\n\r\n    if(res.errmsg != 'success') {\r\n    \tthrow new Error(res.errmsg)\r\n    }\r\n    post_id = res.ret.article_id\r\n    return {\r\n      status: 'success',\r\n      post_id: post_id,\r\n      draftLink: 'https://baijiahao.baidu.com/builder/rc/edit?type=news&article_id=' + post_id,\r\n    }\r\n  }\r\n\r\n  async uploadFile(file) {\r\n    var uploadUrl = 'https://baijiahao.baidu.com/pcui/picture/uploadproxy'\r\n    var file = new File([file.bits], 'temp', {\r\n      type: file.type\r\n    });\r\n    var formdata = new FormData()\r\n    formdata.append('media', file)\r\n    formdata.append('type', 'image')\r\n    formdata.append('app_id', '1589639493090963')\r\n    formdata.append('is_waterlog', '1')\r\n    formdata.append('save_material', '1')\r\n    formdata.append('no_compress', '0')\r\n    formdata.append('is_events', '')\r\n    formdata.append('article_type', 'news')\r\n\r\n    var res = await axios({\r\n      url: uploadUrl,\r\n      method: 'post',\r\n      data: formdata,\r\n      headers: { 'Content-Type': 'multipart/form-data' },\r\n    })\r\n\r\n    return [\r\n      {\r\n        url: res.data.ret.https_url,\r\n      },\r\n    ]\r\n  }\r\n\r\n  async preEditPost(post) {\r\n    var div = $('<div>')\r\n    $('body').append(div)\r\n\r\n    try {\r\n      div.html(post.content)\r\n      var doc = div\r\n      // var pres = doc.find(\"pre\");\r\n      tools.processDocCode(div)\r\n      tools.makeImgVisible(div)\r\n\r\n      var tempDoc = $('<div>').append(doc.clone())\r\n      post.content =\r\n        tempDoc.children('div').length == 1\r\n          ? tempDoc.children('div').html()\r\n          : tempDoc.html()\r\n\r\n      console.log('after.predEdit', post.content)\r\n    } catch (e) {\r\n      console.log('preEdit.error', e)\r\n    }\r\n  }\r\n}\r\n\n\n/***/ }),\n\n/***/ 392:\n/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {\n\n\"use strict\";\n__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   \"default\": () => (/* binding */ BilibiliAdapter)\n/* harmony export */ });\nclass BilibiliAdapter {\r\n  constructor(config) {\r\n    // this.skipReadImage = true\r\n    this.config = config\r\n    this.name = 'bilibili'\r\n  }\r\n\r\n  async getMetaData() {\r\n    var res = await $.ajax({\r\n      url: 'https://api.bilibili.com/x/web-interface/nav?build=0&mobi_app=web',\r\n    })\r\n    if(!res.data.isLogin) {\r\n      throw new Error('not login')\r\n    }\r\n    // console.log(res);\r\n    return {\r\n      uid: res.data.mid,\r\n      title: res.data.uname,\r\n      avatar: res.data.face,\r\n      supportTypes: ['html'],\r\n      type: 'bilibili',\r\n      displayName: '哔哩哔哩',\r\n      home: 'https://member.bilibili.com/platform/upload/text',\r\n      icon: 'https://www.bilibili.com/favicon.ico',\r\n    }\r\n  }\r\n\r\n  async addPost(post) {\r\n    return {\r\n      status: 'success',\r\n      post_id: 0,\r\n    }\r\n  }\r\n\r\n  async editPost(post_id, post) {\r\n    // var pgc_feed_covers = []\r\n    // if (post.post_thumbnail_raw && post.post_thumbnail_raw.images) {\r\n    //   pgc_feed_covers.push({\r\n    //     id: 0,\r\n    //     url: post.post_thumbnail_raw.url,\r\n    //     uri: post.post_thumbnail_raw.images[0].origin_web_uri,\r\n    //     origin_uri: post.post_thumbnail_raw.images[0].origin_web_uri,\r\n    //     ic_uri: '',\r\n    //     thumb_width: post.post_thumbnail_raw.images[0].width,\r\n    //     thumb_height: post.post_thumbnail_raw.images[0].height,\r\n    //   })\r\n    // }\r\n\r\n    var csrf = this.config.state.csrf;\r\n    var res = await $.ajax({\r\n      url: 'https://api.bilibili.com/x/article/creative/draft/addupdate',\r\n      type: 'POST',\r\n      dataType: 'JSON',\r\n      data: {\r\n        tid: 4,\r\n        title: post.post_title,\r\n        save: 0,\r\n        pgc_id: 0,\r\n        content: post.post_content,\r\n        csrf: csrf,\r\n        // pgc_feed_covers: JSON.stringify(pgc_feed_covers),\r\n      },\r\n    })\r\n\r\n    if (!res.data) {\r\n      throw new Error(res.message)\r\n    }\r\n\r\n    return {\r\n      status: 'success',\r\n      post_id: res.data.aid,\r\n      draftLink:\r\n        'https://member.bilibili.com/platform/upload/text/edit?aid=' +\r\n        res.data.aid,\r\n    }\r\n  }\r\n\r\n  async uploadFile(file) {\r\n    var src = file.src\r\n    var csrf = this.config.state.csrf\r\n\r\n    var uploadUrl ='https://api.bilibili.com/x/article/creative/article/upcover'\r\n    var file = new File([file.bits], 'temp', {\r\n      type: file.type,\r\n    })\r\n    var formdata = new FormData()\r\n    formdata.append('binary', file)\r\n    formdata.append('csrf', csrf)\r\n    var res = await axios({\r\n      url: uploadUrl,\r\n      method: 'post',\r\n      data: formdata,\r\n      headers: { 'Content-Type': 'multipart/form-data' },\r\n    })\r\n\r\n    if (res.data.code != 0) {\r\n      throw new Error('图片上传失败 ' + src)\r\n    }\r\n    // http only\r\n    console.log('uploadFile', res)\r\n    var id = Math.floor(Math.random() * 100000)\r\n    return [\r\n      {\r\n        id: id,\r\n        object_key: id,\r\n        url: res.data.data.url,\r\n        size: res.data.data.size,\r\n        // images: [res.data],\r\n      },\r\n    ]\r\n  }\r\n\r\n  async preEditPost(post) {\r\n    var div = $('<div>')\r\n    $('body').append(div)\r\n\r\n    div.html(post.content)\r\n    // var org = $(post.content);\r\n    // var doc = $('<div>').append(org.clone());\r\n    var doc = div\r\n    var pres = doc.find('a')\r\n    for (let mindex = 0; mindex < pres.length; mindex++) {\r\n      const pre = pres.eq(mindex)\r\n      try {\r\n        pre.after(pre.html()).remove()\r\n      } catch (e) {}\r\n    }\r\n\r\n    tools.processDocCode(div)\r\n    tools.makeImgVisible(div)\r\n\r\n    var pres = doc.find('iframe')\r\n    for (let mindex = 0; mindex < pres.length; mindex++) {\r\n      const pre = pres.eq(mindex)\r\n      try {\r\n        pre.remove()\r\n      } catch (e) {}\r\n    }\r\n\r\n    try {\r\n      const images = doc.find('img')\r\n      for (let index = 0; index < images.length; index++) {\r\n        const image = images.eq(index)\r\n        const imgSrc = image.attr('src')\r\n        if (imgSrc && imgSrc.indexOf('.svg') > -1) {\r\n          console.log('remove svg Image')\r\n          image.remove()\r\n        }\r\n      }\r\n      const qqm = doc.find('qqmusic')\r\n      qqm.next().remove()\r\n      qqm.remove()\r\n    } catch (e) {}\r\n\r\n    post.content = $('<div>')\r\n      .append(doc.clone())\r\n      .html()\r\n    console.log('post', post)\r\n  }\r\n\r\n  editImg(img, source) {\r\n    img.attr('size', source.size)\r\n  }\r\n\r\n  addPromotion(post) {\r\n    var sharcode = `<blockquote><p>本文使用 <a href=\"https://www.bilibili.com/read/cv10352009\" class=\"internal\">文章同步助手</a> 同步</p></blockquote>`\r\n    post.content = post.content.trim() + `${sharcode}`\r\n  }\r\n  //   <img class=\"\" src=\"http://p2.pstatp.com/large/pgc-image/bc0a9fc8e595453083d85deb947c3d6e\" data-ic=\"false\" data-ic-uri=\"\" data-height=\"1333\" data-width=\"1000\" image_type=\"1\" web_uri=\"pgc-image/bc0a9fc8e595453083d85deb947c3d6e\" img_width=\"1000\" img_height=\"1333\"></img>\r\n}\r\n\n\n/***/ }),\n\n/***/ 777:\n/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {\n\n\"use strict\";\n__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   \"default\": () => (/* binding */ DaYuAdapter)\n/* harmony export */ });\nvar _cacheMeta = null\r\n\r\nclass DaYuAdapter {\r\n  constructor() {\r\n    // this.skipReadImage = true\r\n    this.version = '0.0.1'\r\n    this.name = 'dayu'\r\n    this.images = []\r\n    modifyRequestHeaders(\r\n      'mp.dayu.com/',\r\n      {\r\n        Origin: 'https://mp.dayu.com',\r\n        Referer: 'https://mp.dayu.com/',\r\n      },\r\n      ['*://mp.dayu.com/dashboard/*']\r\n    )\r\n    // https://mp.dayu.com\r\n  }\r\n\r\n  async getMetaData() {\r\n    const res = await axios.get('https://mp.dayu.com/dashboard/index')\r\n    var pageHtml = res.data\r\n    var markStr = 'var globalConfig = '\r\n    var authIndex = pageHtml.indexOf(markStr)\r\n    if (authIndex == -1) {\r\n      throw new Error('登录失效 authIndex=' + authIndex)\r\n    }\r\n\r\n    var authTokenStr = pageHtml.substring(\r\n      authIndex + markStr.length,\r\n      pageHtml.indexOf(`var G = {`, authIndex)\r\n    )\r\n\r\n    var pageConfig = new Function(\r\n      'var config = ' + authTokenStr + '; return config;'\r\n    )()\r\n\r\n    _cacheMeta = {\r\n      utoken: pageConfig.utoken,\r\n      uploadSign: pageConfig.nsImageUploadSign,\r\n      uid: pageConfig.wmid,\r\n      title: pageConfig.weMediaName,\r\n      avatar:\r\n        pageConfig.wmAvator.indexOf('http') > -1\r\n          ? pageConfig.wmAvator\r\n          : pageConfig.wmAvator.replace('//', 'https://'),\r\n      supportTypes: ['html'],\r\n      type: 'dayu',\r\n      displayName: '大鱼号',\r\n      home: 'https://mp.dayu.com/dashboard/account/profile',\r\n      icon: 'https://image.uc.cn/s/uae/g/1v/images/index/favicon.ico',\r\n    }\r\n\r\n    return _cacheMeta\r\n  }\r\n\r\n  async addPost(post) {\r\n    return {\r\n      status: 'success',\r\n      post_id: 0,\r\n    }\r\n  }\r\n\r\n  async editPost(post_id, post) {\r\n    _cacheMeta = _cacheMeta ? _cacheMeta : await this.getMetaData()\r\n    console.log('editPost', post)\r\n    var res = await $.ajax({\r\n      url: 'https://mp.dayu.com/dashboard/save-draft',\r\n      type: 'POST',\r\n      headers: {\r\n        utoken: _cacheMeta.utoken,\r\n      },\r\n      data: {\r\n        title: post.post_title,\r\n        content: post.post_content,\r\n        author: _cacheMeta.title,\r\n        coverImg: this.images[0].org_url,\r\n        article_type: 1,\r\n        utoken: _cacheMeta.utoken,\r\n        cover_from: 'auto',\r\n      },\r\n    })\r\n\r\n    if (res.error) {\r\n      throw new Error(res.error)\r\n    }\r\n\r\n    post_id = res.data._id\r\n    console.log(res)\r\n    return {\r\n      status: 'success',\r\n      post_id: post_id,\r\n      draftLink:\r\n        'https://mp.dayu.com/dashboard/article/write?draft_id=' + post_id,\r\n    }\r\n  }\r\n\r\n  async uploadFile(file) {\r\n    _cacheMeta = _cacheMeta ? _cacheMeta : await this.getMetaData()\r\n    var uploadUrl =\r\n      'https://ns.dayu.com/article/imageUpload?appid=website&fromMaterial=0&wmid=' +\r\n      _cacheMeta.uid +\r\n      '&wmname=' +\r\n      encodeURIComponent(_cacheMeta.title) +\r\n      '&sign=' +\r\n      _cacheMeta.uploadSign\r\n    var file = new File([file.bits], 'temp', {\r\n      type: file.type,\r\n    })\r\n    var formdata = new FormData()\r\n    formdata.append('upfile', file, new Date().getTime() + '.jpg')\r\n    formdata.append('type', file.type)\r\n    formdata.append('id', 'WU_FILE_1')\r\n    formdata.append('fileid', `uploadm-` + Math.floor(Math.random() * 1000000))\r\n    formdata.append('name', new Date().getTime() + '.jpg')\r\n    formdata.append('lastModifiedDate', new Date().toString())\r\n    formdata.append('size', file.size)\r\n    var res = await axios({\r\n      url: uploadUrl,\r\n      method: 'post',\r\n      data: formdata,\r\n      headers: { 'Content-Type': 'multipart/form-data' },\r\n    })\r\n\r\n    var image = {\r\n      org_url: res.data.data.imgInfo.org_url,\r\n      url: res.data.data.imgInfo.url,\r\n    }\r\n\r\n    this.images.push(image)\r\n\r\n    return [image]\r\n  }\r\n\r\n  async preEditPost(post) {\r\n    var div = $('<div>')\r\n    $('body').append(div)\r\n\r\n    // post.content = post.content.replace(/\\>\\s+\\</g,'');\r\n    div.html(post.content)\r\n\r\n    // var org = $(post.content);\r\n    // var doc = $('<div>').append(org.clone());\r\n    var doc = div\r\n    var pres = doc.find('pre')\r\n    console.log('find code blocks', pres.length, post)\r\n    for (let mindex = 0; mindex < pres.length; mindex++) {\r\n      const pre = pres.eq(mindex)\r\n      try {\r\n        var newHtml = CodeBlockToPlainText(pre, 0)\r\n        if (newHtml) {\r\n          console.log(newHtml)\r\n          pre.html(newHtml)\r\n        }\r\n      } catch (e) {}\r\n    }\r\n\r\n    var processEmptyLine = function(idx, el) {\r\n      var $obj = $(this)\r\n      var originalText = $obj.text()\r\n      var img = $obj.find('img')\r\n      var brs = $obj.find('br')\r\n      if (originalText == '') {\r\n        ;(function() {\r\n          if (img.length) return\r\n          if (!brs.length) return\r\n          $obj.remove()\r\n        })()\r\n      }\r\n\r\n      // try to replace as h2;\r\n      var strongTag = $obj.find('strong').eq(0)\r\n      var childStrongText = strongTag.text()\r\n      if (originalText == childStrongText) {\r\n        var strongSize = null\r\n        var tagStart = strongTag\r\n        var align = null\r\n        for (let index = 0; index < 4; index++) {\r\n          var fontSize = tagStart.css('font-size')\r\n          var textAlign = tagStart.css('text-align')\r\n          if (fontSize) {\r\n            strongSize = fontSize\r\n          }\r\n          if (textAlign) {\r\n            align = textAlign\r\n          }\r\n          if (align && strongSize) break\r\n          if (tagStart == $obj) {\r\n            console.log('near top')\r\n            break\r\n          }\r\n          tagStart = tagStart.parent()\r\n        }\r\n        if (strongSize) {\r\n          var theFontSize = parseInt(strongSize)\r\n          if (theFontSize > 17 && align == 'center') {\r\n            var newTag = $('<h2></h2>').append($obj.html())\r\n            $obj.after(newTag).remove()\r\n          }\r\n        }\r\n      }\r\n    }\r\n\r\n    // remove empty break line\r\n    doc.find('p').each(processEmptyLine)\r\n    doc.find('section').each(processEmptyLine)\r\n\r\n    // for break line\r\n    doc.find('section').replaceWith(function() {\r\n      return $('<p />').append($(this).contents())\r\n    })\r\n\r\n    var processBr = function(idx, el) {\r\n      var $obj = $(this)\r\n      if (!$obj.next().length) {\r\n        $obj.remove()\r\n      }\r\n    }\r\n    doc.find('br').each(processBr)\r\n    // table {\r\n    //     margin-bottom: 10px;\r\n    //     border-collapse: collapse;\r\n    //     display: table;\r\n    //     width: 100%!important;\r\n    // }\r\n    // td, th {\r\n    //     word-wrap: break-word;\r\n    //     word-break: break-all;\r\n    //     padding: 5px 10px;\r\n    //     border: 1px solid #DDD;\r\n    // }\r\n\r\n    // console.log('found table', doc.find('table'))\r\n    var tempDoc = $('<div>').append(doc.clone())\r\n    post.content =\r\n      tempDoc.children('div').length == 1\r\n        ? tempDoc.children('div').html()\r\n        : tempDoc.html()\r\n    // div.remove();\r\n  }\r\n}\r\n\n\n/***/ }),\n\n/***/ 701:\n/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {\n\n\"use strict\";\n__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   \"default\": () => (/* binding */ DoubanAdapter)\n/* harmony export */ });\nvar metaCache = null\r\n\r\n\r\nconst ImageRegexp = /^!\\[([^\\]]*)]\\s*\\(([^)\"]+)( \"([^)\"]+)\")?\\)/\r\nconst imageBlock = (remarkable) => {\r\n  remarkable.block.ruler.before('paragraph', 'image', (state, startLine, endLine, silent) => {\r\n    const pos = state.bMarks[startLine] + state.tShift[startLine]\r\n    const max = state.eMarks[startLine]\r\n\r\n    if (pos >= max) {\r\n      return false\r\n    }\r\n    if (!state.src) {\r\n      return false\r\n    }\r\n    if (state.src[pos] !== '!') {\r\n      return false\r\n    }\r\n\r\n    var match = ImageRegexp.exec(state.src.slice(pos))\r\n    if (!match) {\r\n      return false\r\n    }\r\n\r\n    // in silent mode it shouldn't output any tokens or modify pending\r\n    if (!silent) {\r\n      state.tokens.push({\r\n        type: 'image_open',\r\n        src: match[2],\r\n        alt: match[1],\r\n        lines: [ startLine, state.line ],\r\n        level: state.level\r\n      })\r\n\r\n      state.tokens.push({\r\n        type: 'image_close',\r\n        level: state.level\r\n      })\r\n    }\r\n\r\n    state.line = startLine + 1\r\n\r\n    return true\r\n  })\r\n}\r\n\r\n\r\n\r\nfunction getFormData(obj) {\r\n    var map = {};\r\n    obj.find('input').each(function() {\r\n        map[$(this).attr(\"name\")] = $(this).val();\r\n    });\r\n    return map\r\n}\r\n\r\n\r\nclass DoubanAdapter {\r\n  constructor(config) {\r\n    this.config = config\r\n    this.meta = metaCache\r\n    this.name = 'douban'\r\n\r\n    modifyRequestHeaders('www.douban.com/', {\r\n    \tOrigin: 'https://www.douban.com',\r\n      Referer: 'https://www.douban.com'\r\n    }, [\r\n    \t'*://www.douban.com/*',\r\n    ])\r\n  }\r\n\r\n  async getMetaData() {\r\n    var res = await $.ajax({ url: 'https://www.douban.com/note/create' })\r\n    var innerDoc = $(res)\r\n    var doc = $('<div>').append(innerDoc.clone())\r\n    var configScript = innerDoc.filter(function(index, el){ return $(el).text().indexOf('_POST_PARAMS') > -1 });\r\n    if(configScript.length == 0) {\r\n        throw new Error('未登录')\r\n    }\r\n    var code = configScript.text()\r\n    var wx = new Function(\r\n        'Do ={}; Do.add = function() {} '+ code +\r\n        '; return {_USER_AVATAR: _USER_AVATAR, _USER_NAME: _USER_NAME, _NOTE_ID: _NOTE_ID, _TAGS: _TAGS, _POST_PARAMS: _POST_PARAMS};'\r\n    )();\r\n    console.log(code, wx)\r\n\r\n    var metadata = {\r\n      uid: wx._USER_NAME,\r\n      title: wx._USER_NAME,\r\n      commonData: wx,\r\n      avatar: wx._USER_AVATAR,\r\n      type: 'douban',\r\n      supportTypes: ['html'],\r\n      home: 'https://www.douban.com/note/create',\r\n      icon: 'https://img3.doubanio.com/favicon.ico',\r\n      form: getFormData(doc.find('#note-editor-form')),\r\n      _POST_PARAMS: wx._POST_PARAMS\r\n    }\r\n    metaCache = metadata\r\n    this.meta = metaCache\r\n    console.log('metaCache', metaCache)\r\n    return metadata\r\n  }\r\n\r\n  async addPost(post) {\r\n    return {\r\n      status: 'success',\r\n      post_id: 0,\r\n    }\r\n  }\r\n\r\n  async editPost(post_id, post) {\r\n    var turndownService = new turndown()\r\n    turndownService.use(tools.turndownExt)\r\n    var markdown = turndownService.turndown(post.post_content)\r\n    console\r\n      .log(markdown)\r\n\r\n    // 保证图片换行\r\n    markdown = markdown.split(\"\\n\").map(_ => {\r\n      const imageBlocks = _.split('![]');\r\n      return imageBlocks.length > 1 ? imageBlocks.join('\\n![]') : _\r\n    }).join(\"\\n\");\r\n\r\n    const draftjsState = JSON.stringify(tools.markdownToDraft(markdown, {\r\n      remarkablePlugins: [imageBlock],\r\n      blockTypes: {\r\n        image_open: function(item, generateUniqueKey) {\r\n          console.log('image_open', 'blockTypes', item)\r\n          var key = generateUniqueKey()\r\n          var blockEntities = {}\r\n          // ?#\r\n          var sourcePair =  item.src.split(\"?#\")\r\n          var rawSrc = sourcePair[0]\r\n          var sourceId = sourcePair[1]\r\n          if(sourcePair.length) {\r\n            item.src = rawSrc\r\n          }\r\n          var imageTemplate = {\r\n            id: sourceId,\r\n            src:  item.src,\r\n            thumb: item.src,\r\n            url: item.src,\r\n          }\r\n\r\n          blockEntities[key] = {\r\n            type: 'IMAGE',\r\n            mutability: 'IMMUTABLE',\r\n            data: imageTemplate,\r\n          }\r\n          return {\r\n            type: 'atomic',\r\n            blockEntities: blockEntities,\r\n            inlineStyleRanges: [],\r\n            // \"data\": {\r\n            //     \"page\": 0\r\n            // },\r\n            entityRanges: [\r\n              {\r\n                offset: 0,\r\n                length: 1,\r\n                key: key,\r\n              },\r\n            ],\r\n            text: ' ',\r\n          }\r\n        }\r\n      },\r\n      blockEntities: {\r\n        image: function (item) {\r\n          var sourcePair =  item.src.split(\"?#\")\r\n          if(sourcePair.length) {\r\n            var rawSrc = sourcePair[0]\r\n            var sourceId = sourcePair[1]\r\n            item.id = sourceId\r\n            item.src = rawSrc\r\n          }\r\n          console.log('image_open', 'blockEntities', item)\r\n          return {\r\n            type: 'IMAGE',\r\n            mutability: 'IMMUTABLE',\r\n            data: item\r\n          }\r\n        }\r\n      }\r\n    }));\r\n    console.log(draftjsState)\r\n\r\n    var state = this.config.state;\r\n    var requestUrl = 'https://www.douban.com/j/note/autosave';\r\n    var draftLink = 'https://www.douban.com/note/create';\r\n    var requestBody = {\r\n      is_rich: 1,\r\n      note_id: this.meta.form.note_id,\r\n      note_title: post.post_title,\r\n      note_text: draftjsState,\r\n      introduction: '',\r\n      note_privacy: 'P',\r\n      cannot_reply: null,\r\n      author_tags: null,\r\n      accept_donation: null,\r\n      donation_notice: null,\r\n      is_original: null,\r\n      ck: this.meta.form.ck\r\n    }\r\n\r\n    // https://music.douban.com/subject/24856133/new_review\r\n    // music review\r\n    // https://music.douban.com/j/review/create\r\n    // is_rich: 1\r\n    // topic_id:\r\n    // review[subject_id]: 24856133\r\n    // review[title]: aaa\r\n    // review[introduction]:\r\n    // review[text]: {\"entityMap\":{},\"blocks\":[{\"key\":\"9riq1\",\"text\":\"aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa\",\"type\":\"unstyled\",\"depth\":0,\"inlineStyleRanges\":[],\"entityRanges\":[],\"data\":{\"page\":0}}]}\r\n    // review[rating]:\r\n    // review[spoiler]:\r\n    // review[donate]:\r\n    // review[original]:\r\n    // ck: O4jk\r\n    if(state && state.is_review) {\r\n      if(state.subject == 'music') {\r\n        draftLink = state.url;\r\n        requestUrl = 'https://music.douban.com/j/review/create'\r\n        requestBody = {\r\n          is_rich: 1,\r\n          topic_id: '',\r\n          review: {\r\n            subject_id: state.id,\r\n            title:  post.post_title,\r\n            introduction: '',\r\n            text: draftjsState,\r\n            rating: '',\r\n            spoiler: '',\r\n            donate: '',\r\n            original: ''\r\n          },\r\n          ck: this.meta.form.ck\r\n        }\r\n      }\r\n    }\r\n    console.log('state', requestBody)\r\n    var res = await $.ajax({\r\n      url: requestUrl,\r\n      type: 'POST',\r\n      dataType: 'JSON',\r\n      data: requestBody,\r\n    })\r\n\r\n    if(res.url) {\r\n      draftLink = `https://www.douban.com/note/${requestBody.note_id}/`\r\n    }\r\n\r\n    return {\r\n      status: 'success',\r\n      post_id: this.meta.form.note_id,\r\n      draftLink: draftLink,\r\n    }\r\n  }\r\n\r\n  editImg(img, source) {\r\n    img.attr('raw-data', JSON.stringify(source.raw))\r\n  }\r\n\r\n  async preEditPost(post) {\r\n    var div = $('<div>')\r\n    $('body').append(div)\r\n\r\n    try {\r\n      div.html(post.content)\r\n      var doc = div\r\n      // var pres = doc.find(\"pre\");\r\n      tools.processDocCode(div)\r\n      tools.makeImgVisible(div)\r\n\r\n      var tempDoc = $('<div>').append(doc.clone())\r\n      post.content =\r\n        tempDoc.children('div').length == 1\r\n          ? tempDoc.children('div').html()\r\n          : tempDoc.html()\r\n\r\n      console.log('after.predEdit', post.content)\r\n    } catch (e) {\r\n      console.log('preEdit.error', e)\r\n    }\r\n  }\r\n\r\n  addPromotion(post) {\r\n    var sharcode = `<blockquote><p>本文使用 <a href=\"https://zhuanlan.zhihu.com/p/358098152\" class=\"internal\">文章同步助手</a> 同步</p></blockquote>`\r\n    post.content = post.content.trim() + `${sharcode}`\r\n  }\r\n\r\n  async uploadFile(file) {\r\n\r\n    // https://music.douban.com/j/review/upload_image\r\n    var requestUrl = 'https://www.douban.com/j/note/add_photo';\r\n    var state = this.config.state;\r\n    var formdata = new FormData()\r\n    var blob = new Blob([file.bits], {\r\n      type: file.type\r\n    });\r\n\r\n    if(state && state.is_review) {\r\n      if(state.subject == 'music') {\r\n        requestUrl =  'https://music.douban.com/j/review/upload_image';\r\n        formdata.append('review_id', '')\r\n        formdata.append('picfile', blob)\r\n      }\r\n    } else {\r\n      formdata.append('note_id', this.meta.form.note_id)\r\n      formdata.append('image_file', blob)\r\n    }\r\n\r\n    formdata.append('ck', this.meta.form.ck)\r\n    formdata.append('upload_auth_token', this.meta._POST_PARAMS.siteCookie.value)\r\n\r\n    var res = await axios({\r\n      url: requestUrl,\r\n      method: 'post',\r\n      data: formdata,\r\n      headers: { 'Content-Type': 'multipart/form-data' },\r\n    })\r\n\r\n    var url = res.data.photo.url\r\n    if(!res.data.photo) {\r\n        console.log(res.data);\r\n        throw new Error('upload failed')\r\n    }\r\n    //  return url;\r\n    return [\r\n      {\r\n        id: res.data.photo.id,\r\n        object_key: res.data.photo.id,\r\n        url: url + \"?#\" + res.data.photo.id,\r\n        raw: res.data\r\n      },\r\n    ]\r\n  }\r\n}\r\n\n\n/***/ }),\n\n/***/ 254:\n/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {\n\n\"use strict\";\n__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   \"default\": () => (/* binding */ FocusAdapter)\n/* harmony export */ });\n\r\nclass FocusAdapter {\r\n  constructor() {\r\n    this.name = 'weibo'\r\n  }\r\n\r\n  async getMetaData() {\r\n    var res = await $.get('https://mp-fe-pc.focus.cn//user/status?')\r\n    return {\r\n        uid: res.data.uid,\r\n        title: res.data.accountName,\r\n        avatar: null,\r\n        supportTypes: ['html'],\r\n        displayName: '搜狐焦点',\r\n        type: 'sohufocus',\r\n        home: 'https://mp.focus.cn/fe/index.html#/info/draft',\r\n        icon: 'https://mp.focus.cn/favicon.ico',\r\n      }\r\n  }\r\n\r\n  async addPost(post) {\r\n    return {\r\n      status: 'success',\r\n      post_id: 0,\r\n    }\r\n  }\r\n\r\n\r\n  async preEditPost(post) {\r\n    var rexp = new RegExp('>[\\ts ]*<', 'g')\r\n    var result = post.content.replace(rexp, '><')\r\n    post.content = result\r\n  }\r\n\r\n  async editPost(post_id, post) {\r\n    var res = await axios.post('https://mp-fe-pc.focus.cn/news/info/publishNewsInfo', {\r\n        \"projectIds\": [],\r\n        \"newsBasic\": {\r\n          \"id\": \"\",\r\n          \"cityId\": 0,\r\n          \"title\": post.post_title,\r\n          \"category\": 1,\r\n          \"headImg\": \"\",\r\n          \"newsAbstract\": \"\",\r\n          \"isGuide\": 0,\r\n          \"status\": 4\r\n        },\r\n        \"newsContent\": {\r\n          \"content\": post.post_content\r\n        },\r\n        \"videoIds\": []\r\n    })\r\n    // console.log(res)\r\n    var aId = res.data.data.id\r\n    return {\r\n      status: 'success',\r\n      post_id: aId,\r\n      draftLink: 'https://mp.focus.cn/fe/index.html#/info/subinfo/' + aId,\r\n    }\r\n  }\r\n\r\n  async uploadFile(file) {\r\n    var formdata = new FormData()\r\n    var blob = new Blob([file.bits], {\r\n        type: file.type\r\n    });\r\n\r\n    formdata.append('image', blob, new Date().getTime() + '.jpg')\r\n    var res = await axios({\r\n      url: `https://mp-fe-pc.focus.cn/common/image/upload?type=2`,\r\n      method: 'post',\r\n      data: formdata,\r\n      headers: { 'Content-Type': 'multipart/form-data' },\r\n    })\r\n\r\n    if(res.data.code != 200) {\r\n      console.log(res.data);\r\n      throw new Error('upload failed')\r\n    }\r\n    var url = `https://t-img.51f.com/sh740wsh${res.data.data}`\r\n    return [\r\n      {\r\n        id: res.data.data,\r\n        object_key: res.data.data,\r\n        url: url,\r\n      },\r\n    ]\r\n  }\r\n\r\n}\r\n\n\n/***/ }),\n\n/***/ 275:\n/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {\n\n\"use strict\";\n__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   \"default\": () => (/* binding */ ImoocAdapter)\n/* harmony export */ });\nclass ImoocAdapter {\r\n  constructor() {\r\n    this.name = 'imooc'\r\n    // cors\r\n    modifyRequestHeaders(\r\n      'www.imooc.com/article',\r\n      {\r\n        Origin: 'https://www.imooc.com',\r\n        Referer: 'https://www.imooc.com/',\r\n      },\r\n      ['*://www.imooc.com/article/*']\r\n    )\r\n  }\r\n\r\n  async getMetaData() {\r\n    var res = await $.get('https://www.imooc.com/u/card')\r\n    var dataStr = res.replace('jsonpcallback(', '').replace('})', '}')\r\n    var result = JSON.parse(dataStr)\r\n    console.log(result)\r\n    if (result.result != 0) {\r\n      throw new Error(result.msg)\r\n    }\r\n    return {\r\n      uid: result.data.uid,\r\n      title: result.data.nickname,\r\n      avatar: result.data.img,\r\n      type: 'imooc',\r\n      displayName: '慕课手记',\r\n      supportTypes: ['markdown', 'html'],\r\n      home: 'https://www.imooc.com/article',\r\n      icon: 'https://www.imooc.com/favicon.ico',\r\n    }\r\n  }\r\n\r\n  async addPost(post) {\r\n    return {\r\n      status: 'success',\r\n      post_id: 0,\r\n    }\r\n  }\r\n\r\n  async editPost(post_id, post) {\r\n    if (!post.markdown) {\r\n      var turndownService = new turndown()\r\n      turndownService.use(tools.turndownExt)\r\n      var markdown = turndownService.turndown(post.post_content)\r\n      post.markdown = markdown\r\n      console.log(markdown)\r\n    }\r\n\r\n    var postStruct = {\r\n      editor: 0,\r\n      draft_id: 0,\r\n      title: post.post_title,\r\n      content: post.markdown,\r\n    }\r\n\r\n    var res = await $.ajax({\r\n      url: 'https://www.imooc.com/article/savedraft',\r\n      type: 'POST',\r\n      dataType: 'JSON',\r\n      data: postStruct,\r\n    })\r\n    console.log(res)\r\n    post_id = res.data\r\n    return {\r\n      status: 'success',\r\n      post_id: post_id,\r\n      draftLink: 'https://www.imooc.com/article/draft/id/' + post_id,\r\n    }\r\n  }\r\n\r\n  async uploadFile(file) {\r\n    var uploadUrl = 'https://www.imooc.com/article/ajaxuploadimg'\r\n    var file = new File([file.bits], 'temp', {\r\n      type: file.type,\r\n    })\r\n    var formdata = new FormData()\r\n    formdata.append('photo', file, new Date().getTime() + '.jpg')\r\n    formdata.append('type', file.type)\r\n    formdata.append('id', 'WU_FILE_0')\r\n    formdata.append('name', new Date().getTime() + '.jpg')\r\n    formdata.append('lastModifiedDate', new Date().toString())\r\n    formdata.append('size', file.size)\r\n    var res = await axios({\r\n      url: uploadUrl,\r\n      method: 'post',\r\n      data: formdata,\r\n      headers: { 'Content-Type': 'multipart/form-data' },\r\n    })\r\n\r\n    if (res.data.result != 0) {\r\n      throw new Error(res.data.msg)\r\n    }\r\n\r\n    var url = res.data.data.imgpath\r\n    return [\r\n      {\r\n        url: url,\r\n      },\r\n    ]\r\n  }\r\n\r\n  async preEditPost(post) {\r\n    var div = $('<div>')\r\n    $('body').append(div)\r\n\r\n    try {\r\n      div.html(post.content)\r\n      var doc = div\r\n      // var pres = doc.find(\"pre\");\r\n      tools.processDocCode(div)\r\n      tools.makeImgVisible(div)\r\n\r\n      var tempDoc = $('<div>').append(doc.clone())\r\n      post.content =\r\n        tempDoc.children('div').length == 1\r\n          ? tempDoc.children('div').html()\r\n          : tempDoc.html()\r\n\r\n      console.log('after.predEdit', post.content)\r\n    } catch (e) {\r\n      console.log('preEdit.error', e)\r\n    }\r\n  }\r\n}\r\n\n\n/***/ }),\n\n/***/ 142:\n/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {\n\n\"use strict\";\n__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   \"default\": () => (__WEBPACK_DEFAULT_EXPORT__)\n/* harmony export */ });\nconst template = `<!DOCTYPE html>\r\n<html>\r\n<head>\r\n    <meta name=\"wechat-enable-text-zoom-em\" content=\"true\">\r\n    <meta http-equiv=\"Content-Type\" content=\"text/html; charset=utf-8\">\r\n    <meta http-equiv=\"X-UA-Compatible\" content=\"IE=edge\">\r\n    <meta name=\"color-scheme\" content=\"light dark\">\r\n    <meta name=\"viewport\"\r\n        content=\"width=device-width,initial-scale=1.0,maximum-scale=1.0,user-scalable=0,viewport-fit=cover\">\r\n    <link rel=\"shortcut icon\" type=\"image/x-icon\" href=\"//res.wx.qq.com/a/wx_fed/assets/res/NTI4MWU5.ico\"\r\n        reportloaderror>\r\n    <link rel=\"mask-icon\" href=\"//res.wx.qq.com/a/wx_fed/assets/res/MjliNWVm.svg\" color=\"#4C4C4C\" reportloaderror>\r\n    <link rel=\"apple-touch-icon-precomposed\" href=\"//res.wx.qq.com/a/wx_fed/assets/res/OTE0YTAw.png\" reportloaderror>\r\n    <meta name=\"apple-mobile-web-app-capable\" content=\"yes\">\r\n    <meta name=\"apple-mobile-web-app-status-bar-style\" content=\"black\">\r\n    <meta name=\"format-detection\" content=\"telephone=no\">\r\n    <meta property=\"og:title\" content=\"TITLE\" />\r\n    <meta property=\"og:type\" content=\"article\" />\r\n    <title>TITLE</title>\r\n    <link rel=\"stylesheet\"\r\n        href=\"https://res.wx.qq.com/mmbizwap/zh_CN/htmledition/js/../mmbizappmsg/assets/appmsg.c9d06de2.css\"\r\n        reportloaderror>\r\n    <link rel=\"stylesheet\"\r\n        href=\"https://res.wx.qq.com/mmbizwap/zh_CN/htmledition/js/../mmbizappmsg/assets/sprite.dcee1002.css\"\r\n        reportloaderror>\r\n    <link rel=\"stylesheet\"\r\n        href=\"https://res.wx.qq.com/mmbizwap/zh_CN/htmledition/js/../mmbizappmsg/assets/report.5e0fdfbf.css\"\r\n        reportloaderror>\r\n    <link rel=\"stylesheet\"\r\n        href=\"https://res.wx.qq.com/mmbizwap/zh_CN/htmledition/js/../mmbizappmsg/assets/wxwork_hidden.96d6e8be.css\"\r\n        reportloaderror>\r\n    <link rel=\"stylesheet\"\r\n        href=\"https://res.wx.qq.com/mmbizwap/zh_CN/htmledition/js/../mmbizappmsg/assets/controller.5417a6ee.css\"\r\n        reportloaderror>\r\n</head>\r\n<body id=\"activity-detail\" class=\"zh_CN wx_wap_page\r\n\tmm_appmsg\r\n\tcomment_feature\r\n\tdiscuss_tab appmsg_skin_default appmsg_style_default\">\r\n    <div id=\"js_article\" class=\"rich_media\">\r\n        <div id=\"js_top_ad_area\" class=\"top_banner\">\r\n        </div>\r\n        <div class=\"rich_media_inner\">\r\n            <div id=\"page-content\" class=\"rich_media_area_primary\">\r\n                <div class=\"rich_media_area_primary_inner\">\r\n                    <div id=\"img-content\" class=\"rich_media_wrp\">\r\n                        <h1 class=\"rich_media_title \" id=\"activity-name\">\r\n                           TITLE\r\n                        </h1>\r\n                        <div id=\"meta_content\" class=\"rich_media_meta_list\">\r\n                            <span class=\"rich_media_meta rich_media_meta_nickname\" id=\"profileBt\">\r\n                                <a href=\"javascript:void(0);\" class=\"wx_tap_link js_wx_tap_highlight weui-wa-hotarea\"\r\n                                    id=\"js_name\">\r\n                                    AUTHOR\r\n                                </a>\r\n                            </span>\r\n                            <em id=\"publish_time\" class=\"rich_media_meta rich_media_meta_text\">\r\n                                PUBLISH_TIME\r\n                            </em>\r\n                        </div>\r\n                        <div class=\"rich_media_content\" id=\"js_content\">\r\n                            CONTENT\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n            </div>\r\n        </div>\r\n    </div>\r\n    // saved from:ORIGINAL_LINK\r\n</body>\r\n</html>`\r\n\r\nclass IPFSAdapter {\r\n  constructor() {\r\n    this.version = '0.0.1'\r\n    this.name = 'ipfs'\r\n    this.endpoint = 'https://ipfs.infura.io:5001'\r\n    this.gatewayList = [\r\n      'infura-ipfs.io',\r\n    ]\r\n  }\r\n\r\n  async getMetaData() {\r\n    return {\r\n      uid: 'ipfs',\r\n      title: '备份到IPFS',\r\n      avatar: 'https://ipfs.io/favicon.ico',\r\n      supportTypes: ['html'],\r\n      type: 'ipfs',\r\n      displayName: '备份到IPFS',\r\n      home: 'https://ipfs.io/',\r\n      icon: 'https://ipfs.io/favicon.ico',\r\n    }\r\n  }\r\n\r\n  async addPost(post) {\r\n    return {\r\n      status: 'success',\r\n      post_id: 0,\r\n    }\r\n  }\r\n\r\n  async editPost(post_id, post) {\r\n    const pubTime = moment.unix(post.publish_time).format('YYYY-MM-DD HH:mm')\r\n    const content = template\r\n      .replace('TITLE', post.post_title)\r\n      .replace('TITLE', post.post_title)\r\n      .replace('AUTHOR', post.nickname)\r\n      .replace('PUBLISH_TIME', pubTime)\r\n      .replace('ORIGINAL_LINK', post.link)\r\n      .replace('CONTENT', post.post_content)\r\n    console.log(content)\r\n    const res = await this.uploadFile({\r\n      bits: content,\r\n      type: 'text/html',\r\n    })\r\n    return {\r\n      status: 'success',\r\n      post_id: res[0].id,\r\n      draftLink: res[0].url,\r\n    }\r\n  }\r\n\r\n  async uploadFile(file) {\r\n    const { src, post_id } = file\r\n    var uploadUrl = `${this.endpoint}/api/v0/add?stream-channels=true&progress=false`\r\n    var file = new File([file.bits], 'temp.jpg', {\r\n      type: file.type,\r\n    })\r\n    var formdata = new FormData()\r\n    formdata.append('file', file)\r\n    var res\r\n    try {\r\n      res = await axios({\r\n        url: uploadUrl,\r\n        method: 'post',\r\n        data: formdata,\r\n        headers: { 'Content-Type': 'multipart/form-data' },\r\n      })\r\n    } catch (e) {\r\n      // wait\r\n      await wait(5000)\r\n    }\r\n\r\n    await wait(3000)\r\n    if (!res.data.Hash) {\r\n      throw new Error('图片上传失败 ' + src)\r\n    }\r\n    // http only\r\n    const endpoint =\r\n      this.gatewayList.length > 1\r\n        ? this.gatewayList[Math.round(Math.random() % this.gatewayList.length)]\r\n        : this.gatewayList[0]\r\n    const url = `https://${endpoint}/ipfs/${res.data.Hash}`\r\n    return [\r\n      {\r\n        id: res.data.Hash,\r\n        object_key: res.data.Hash,\r\n        url: url,\r\n        images: [res.data],\r\n      },\r\n    ]\r\n  }\r\n}\r\n\r\n/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (IPFSAdapter);\r\n\n\n/***/ }),\n\n/***/ 678:\n/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {\n\n\"use strict\";\n__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   \"default\": () => (/* binding */ JianShuAdapter)\n/* harmony export */ });\nvar NoteVersionCaches = {}\r\nvar defaultNoteBookId\r\n\r\nclass JianShuAdapter {\r\n  constructor() {\r\n    this.name = 'jianshu'\r\n    // chrome.cookies.getAll({ domain: \"zhihu.com\"},  function(cookies){\r\n    //     console.log(cookies)\r\n    // })\r\n  }\r\n\r\n  async getMetaData() {\r\n    var res = await $.ajax({\r\n      url: 'https://www.jianshu.com/settings/basic.json',\r\n    })\r\n    var notebooks = await $.get('https://www.jianshu.com/author/notebooks')\r\n    // console.log(res);\r\n    // https://upload.jianshu.io/users/upload_avatars/12192974/d02c5033-7f82-458f-9b3e-f4c4dbaa1221?imageMogr2/auto-orient/strip|imageView2/1/w/96/h/96\r\n    return {\r\n      uid: res.data.avatar.split('/')[5],\r\n      title: res.data.nickname,\r\n      avatar: res.data.avatar,\r\n      type: 'jianshu',\r\n      displayName: '简书',\r\n      supportTypes: ['html'],\r\n      home: 'https://www.jianshu.com/settings/basic',\r\n      icon: 'https://www.jianshu.com/favicon.ico',\r\n      notebooks: notebooks,\r\n    }\r\n  }\r\n\r\n  async addPost(post) {\r\n    var notebooks = await $.get('https://www.jianshu.com/author/notebooks')\r\n    var firstNoteBook = notebooks[0]\r\n    defaultNoteBookId = firstNoteBook.id\r\n    var res = await $.ajax({\r\n      url: 'https://www.jianshu.com/author/notes',\r\n      type: 'POST',\r\n      dataType: 'JSON',\r\n      headers: {\r\n        accept: 'application/json',\r\n      },\r\n      contentType: 'application/json',\r\n      data: JSON.stringify({\r\n        at_bottom: false,\r\n        notebook_id: firstNoteBook.id,\r\n        title: post.post_title,\r\n      }),\r\n    })\r\n    console.log(res)\r\n    return {\r\n      status: 'success',\r\n      post_id: res.id,\r\n      notebook_id: firstNoteBook.id,\r\n    }\r\n  }\r\n\r\n  async editPost(post_id, post) {\r\n    var cacheVerions = NoteVersionCaches[post_id]\r\n    var notebook_id = post.notebook_id ? post.notebook_id : defaultNoteBookId\r\n\r\n    if (!cacheVerions) {\r\n      var bookNotes = await $.get(\r\n        'https://www.jianshu.com/author/notebooks/' + notebook_id + '/notes'\r\n      )\r\n      var currentNote = bookNotes.filter((t) => {\r\n        return t.id == post_id\r\n      })[0]\r\n\r\n      console.log(post_id, bookNotes)\r\n      NoteVersionCaches[post_id] = currentNote.autosave_control\r\n      NoteVersionCaches[post_id]++\r\n      cacheVerions = NoteVersionCaches[post_id]\r\n    } else {\r\n      NoteVersionCaches[post_id]++\r\n      cacheVerions = NoteVersionCaches[post_id]\r\n    }\r\n\r\n    console.log('currentNote', cacheVerions)\r\n    var requestData = {\r\n      autosave_control: cacheVerions,\r\n    }\r\n\r\n    if (post.post_content) {\r\n      requestData.content = post.post_content\r\n    }\r\n\r\n    if (post_id) {\r\n      requestData.id = post_id\r\n    }\r\n\r\n    if (post.post_title) {\r\n      requestData.title = post.post_title\r\n    }\r\n\r\n    // https://www.jianshu.com/author/notebooks/108908/notes\r\n    var res = await $.ajax({\r\n      url: 'https://www.jianshu.com/author/notes/' + post_id,\r\n      type: 'PUT',\r\n      dataType: 'JSON',\r\n      contentType: 'application/json',\r\n      headers: {\r\n        accept: 'application/json',\r\n      },\r\n      data: JSON.stringify(requestData),\r\n    })\r\n\r\n    return {\r\n      status: 'success',\r\n      notebook_id: notebook_id,\r\n      post_id: post_id,\r\n      draftLink:\r\n        'https://www.jianshu.com/writer#/notebooks/' +\r\n        notebook_id +\r\n        '/notes/' +\r\n        post_id,\r\n    }\r\n  }\r\n\r\n  async uploadFile(file) {\r\n    const tokenReq = await axios.get('https://www.jianshu.com/upload_images/token.json?filename='+ new Date().getTime() +'.png')\r\n    if(tokenReq.data.token) {\r\n      var blob = new Blob([file.bits], {\r\n        type: file.type\r\n      });\r\n      var formdata = new FormData()\r\n      formdata.append('token', tokenReq.data.token)\r\n      formdata.append('key', tokenReq.data.key)\r\n      formdata.append('x:protocol', 'https')\r\n      formdata.append('file', blob, new Date().getTime() + '.jpg')\r\n      var res = await axios({\r\n        url: 'https://upload.qiniup.com/',\r\n        method: 'post',\r\n        data: formdata,\r\n        headers: { 'Content-Type': 'multipart/form-data' },\r\n      })\r\n\r\n      if(!res.data.url) {\r\n        console.log(res.data);\r\n        throw new Error('upload failed')\r\n      }\r\n      var url = res.data.url\r\n      return [\r\n        {\r\n          id: tokenReq.data.key,\r\n          object_key: tokenReq.data.key,\r\n          url: url\r\n        }\r\n      ]\r\n    }\r\n    throw new Error('upload failed')\r\n  }\r\n\r\n  async uploadFileBySrc(file) {\r\n    var src = file.src\r\n    try {\r\n      // jianshu not support webp\r\n      if (src.indexOf('xitu.io') > -1) {\r\n        src = src.replace('webp', 'png')\r\n      }\r\n\r\n      var res = await $.ajax({\r\n        url: 'https://www.jianshu.com/upload_images/fetch',\r\n        type: 'POST',\r\n        contentType: 'application/json',\r\n        xhrFields: {\r\n          withCredentials: true,\r\n        },\r\n        headers: {\r\n          accept: 'application/json',\r\n        },\r\n        data: JSON.stringify({\r\n          url: src,\r\n        }),\r\n      })\r\n\r\n      // http only\r\n      console.log('uploadFile', res)\r\n      return [res]\r\n    } catch (e) {\r\n      console.log('JianShuDriver.uploadFile', e)\r\n      var error = e.responseJSON.error[0].message\r\n      throw new Error(error)\r\n    }\r\n  }\r\n\r\n  async preEditPost(post) {\r\n    var div = $('<div>')\r\n    $('body').append(div)\r\n    div.html(post.content)\r\n    var doc = div\r\n    var processEmptyLine = function (idx, el) {\r\n      var $obj = $(this)\r\n      var originalText = $obj.text()\r\n      var img = $obj.find('img')\r\n      var brs = $obj.find('br')\r\n      if (originalText == '') {\r\n        ;(function () {\r\n          if (img.length) return\r\n          if (!brs.length) return\r\n          $obj.remove()\r\n        })()\r\n      }\r\n\r\n      // try to replace as h2;\r\n      var strongTag = $obj.find('strong').eq(0)\r\n      var childStrongText = strongTag.text()\r\n      if (originalText == childStrongText) {\r\n        var strongSize = null\r\n        var tagStart = strongTag\r\n        var align = null\r\n        for (let index = 0; index < 4; index++) {\r\n          var fontSize = tagStart.css('font-size')\r\n          var textAlign = tagStart.css('text-align')\r\n          if (fontSize) {\r\n            strongSize = fontSize\r\n          }\r\n          if (textAlign) {\r\n            align = textAlign\r\n          }\r\n          if (align && strongSize) break\r\n          if (tagStart == $obj) {\r\n            console.log('near top')\r\n            break\r\n          }\r\n          tagStart = tagStart.parent()\r\n        }\r\n        if (strongSize) {\r\n          var theFontSize = parseInt(strongSize)\r\n          if (theFontSize > 17 && align == 'center') {\r\n            var newTag = $('<h2></h2>').append($obj.html())\r\n            $obj.after(newTag).remove()\r\n          }\r\n        }\r\n      }\r\n    }\r\n\r\n    // remove empty break line\r\n    doc.find('p').each(processEmptyLine)\r\n    doc.find('section').each(processEmptyLine)\r\n\r\n    var processBr = function (idx, el) {\r\n      var $obj = $(this)\r\n      if (!$obj.next().length) {\r\n        $obj.remove()\r\n      }\r\n    }\r\n    doc.find('br').each(processBr)\r\n    // table {\r\n    //     margin-bottom: 10px;\r\n    //     border-collapse: collapse;\r\n    //     display: table;\r\n    //     width: 100%!important;\r\n    // }\r\n    // td, th {\r\n    //     word-wrap: break-word;\r\n    //     word-break: break-all;\r\n    //     padding: 5px 10px;\r\n    //     border: 1px solid #DDD;\r\n    // }\r\n\r\n    // console.log('found table', doc.find('table'))\r\n    var tempDoc = $('<div>').append(doc.clone())\r\n    post.content =\r\n      tempDoc.children('div').length == 1\r\n        ? tempDoc.children('div').html()\r\n        : tempDoc.html()\r\n    // div.remove();\r\n  }\r\n\r\n  addPromotion(post) {\r\n    var sharcode = `<blockquote><p>本文使用 <a href=\"https://www.jianshu.com/p/5709df6fb58d\" class=\"internal\">文章同步助手</a> 同步</p></blockquote>`\r\n    post.content = post.content.trim() + `${sharcode}`\r\n  }\r\n}\r\n\n\n/***/ }),\n\n/***/ 372:\n/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {\n\n\"use strict\";\n__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   \"default\": () => (/* binding */ OsChinaAdapter)\n/* harmony export */ });\n\r\nfunction getDocumentByHTML(html, type = 'text/html') {\r\n\tconst parser = new DOMParser()\r\n\tconst htmlDoc = parser.parseFromString(html, type)\r\n  return htmlDoc\r\n}\r\n\r\nlet _cacheMeta = null\r\n\r\nclass OsChinaAdapter {\r\n  constructor() {\r\n    this.name = 'oschina'\r\n    modifyRequestHeaders('my.oschina.net/u', {\r\n    \tOrigin: 'https://my.oschina.net',\r\n      Referer: 'https://my.oschina.net/'\r\n    }, [\r\n    \t'*://my.oschina.net/u/*',\r\n    ])\r\n  }\r\n\r\n  async getMetaData() {\r\n    var res = await axios.get('https://www.oschina.net/blog')\r\n    var parser = new DOMParser()\r\n    var htmlDoc = parser.parseFromString(res.data, 'text/html')\r\n    var link = htmlDoc.querySelector('.user-info .current-user-avatar')\r\n    if (!link) {\r\n      throw Error('not found')\r\n    }\r\n\r\n    var uid = link.getAttribute('data-user-id')\r\n    var avatar = link.querySelector('img').src\r\n    var nickname = link.getAttribute('title')\r\n\r\n    const meta = {\r\n      uid: uid,\r\n      title: nickname,\r\n      avatar: avatar,\r\n      type: 'oschina',\r\n      displayName: '开源中国',\r\n      supportTypes: ['markdown', 'html'],\r\n      home: 'https://my.oschina.net/u/4227050/admin/drafts',\r\n      icon:\r\n        'https://www.oschina.net/favicon.ico',\r\n    }\r\n\r\n    _cacheMeta = meta\r\n    return meta\r\n  }\r\n\r\n  async addPost(post) {\r\n    return {\r\n      status: 'success',\r\n      post_id: 0\r\n    }\r\n  }\r\n\r\n  async editPost(post_id, post) {\r\n    if(!post.markdown) {\r\n      var turndownService = new turndown()\r\n      turndownService.use(tools.turndownExt)\r\n      var markdown = turndownService.turndown(post.post_content)\r\n      post.markdown = markdown\r\n      console.log(markdown)\r\n    }\r\n\r\n    const meta = _cacheMeta ? _cacheMeta : await this.getMetaData()\r\n    const writePageRes = await axios.get(`https://my.oschina.net/u/${meta.uid}/blog/write`)\r\n    const docPage = getDocumentByHTML(writePageRes.data)\r\n    const userTokenEl = docPage.querySelector('[data-name=g_user_code]')\r\n\r\n    if(!userTokenEl) {\r\n    \tthrow new Error('可能未登录？')\r\n    }\r\n\r\n    const userToken = userTokenEl.getAttribute('data-value')\r\n    const postStruct = {\r\n    \tdraft: 0,\r\n      id: null,\r\n      user_code: userToken,\r\n      title: post.post_title,\r\n      content: post.markdown,\r\n      content_type: 3, // 4=html\r\n      catalog: 6680617,\r\n      groups: 28,\r\n      type: 1,\r\n      origin_url: null,\r\n      privacy: 0,\r\n      deny_comment: 0,\r\n      as_top: 0,\r\n      downloadImg: 1,\r\n      isRecommend: 0,\r\n  \t}\r\n\r\n    const res = await $.ajax({\r\n    \turl: `https://my.oschina.net/u/${meta.uid}/blog/save_draft`,\r\n      type: 'POST',\r\n      dataType: 'JSON',\r\n      data: postStruct,\r\n    })\r\n\r\n    if(res.code != 1) {\r\n    \tthrow new Error(res.message)\r\n    }\r\n\r\n    post_id = res.result.draft\r\n    return {\r\n      status: 'success',\r\n      post_id: post_id,\r\n      draftLink: `https://my.oschina.net/u/${meta.uid}/blog/write/draft/${post_id}`,\r\n    }\r\n  }\r\n\r\n  async uploadFile(file) {\r\n    const meta = _cacheMeta ? _cacheMeta : await this.getMetaData()\r\n    var formdata = new FormData()\r\n    var blob = new Blob([file.bits])\r\n    formdata.append(\"editormd-image-file\", blob)\r\n    var res = await axios({\r\n      url: `https://my.oschina.net/u/${meta.uid}/space/markdown_img_upload`,\r\n      method: 'post',\r\n      data: formdata,\r\n      headers: { 'Content-Type': 'multipart/form-data' },\r\n    })\r\n    var url = res.data.url\r\n    return [\r\n      {\r\n\r\n        url: url,\r\n      },\r\n    ]\r\n  }\r\n\r\n  async preEditPost(post) {\r\n    var div = $('<div>')\r\n    $('body').append(div)\r\n\r\n    try {\r\n      // post.content = post.content.replace(/\\>\\s+\\</g,'');\r\n      console.log('zihu.Juejin')\r\n      div.html(post.content)\r\n      // var org = $(post.content);\r\n      // var doc = $('<div>').append(org.clone());\r\n      var doc = div\r\n      // var pres = doc.find(\"pre\");\r\n      tools.processDocCode(div)\r\n      tools.makeImgVisible(div)\r\n\r\n      var tempDoc = $('<div>').append(doc.clone())\r\n      post.content =\r\n        tempDoc.children('div').length == 1\r\n          ? tempDoc.children('div').html()\r\n          : tempDoc.html()\r\n\r\n      console.log('after.predEdit', post.content)\r\n    } catch (e) {\r\n      console.log('preEdit.error', e)\r\n    }\r\n  }\r\n}\r\n\n\n/***/ }),\n\n/***/ 305:\n/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {\n\n\"use strict\";\n__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   \"default\": () => (/* binding */ SoHuAdapter)\n/* harmony export */ });\nvar _souhuCacheMeta = null\r\n\r\nclass SoHuAdapter {\r\n  constructor() {\r\n    this.version = '0.0.1'\r\n    this.name = 'sohu'\r\n\r\n    // modify origin headers\r\n    modifyRequestHeaders('mp.sohu.com/mpbp', {\r\n        Origin: 'https://mp.sohu.com',\r\n        Referer: 'https://mp.sohu.com/'\r\n    }, [\r\n    \t'*://mp.sohu.com/mpbp/*',\r\n    ])\r\n  }\r\n\r\n  async getMetaData() {\r\n    const { data } = await axios.get('https://mp.sohu.com/mpbp/bp/account/register-info?_=' + Date.now())\r\n    console.log(data)\r\n    if(data.code != 2000000) {\r\n    \tthrow new Error('not found')\r\n    }\r\n    const accountInfo = data.data.account\r\n    _souhuCacheMeta = accountInfo\r\n    return {\r\n      uid: accountInfo.id,\r\n      title: accountInfo.nickName,\r\n      avatar: accountInfo.avatar,\r\n      type: 'sohu',\r\n      displayName: '搜狐号',\r\n      supportTypes: ['html'],\r\n      home: 'https://mp.sohu.com/mpfe/v3/main/first/page?newsType=1',\r\n      icon: 'https://mp.sohu.com/favicon.ico',\r\n    }\r\n  }\r\n\r\n  async addPost(post, _instance) {\r\n    return {\r\n      status: 'success',\r\n      post_id: 0,\r\n    }\r\n  }\r\n\r\n  async editPost(post_id, post) {\r\n\r\n    var postStruct = {\r\n        title: post.post_title,\r\n        brief: '',\r\n        content: post.post_content,\r\n        channelId: 39,\r\n        categoryId: -1,\r\n        id: 0,\r\n        userColumnId: 0,\r\n        businessCode: 0,\r\n        isOriginal: false,\r\n        cover: '',\r\n        attrIds: '',\r\n        topicIds: '',\r\n        isAd: 0,\r\n        reprint: false,\r\n        accountId: _souhuCacheMeta.id\r\n    }\r\n\r\n    var res = await $.ajax({\r\n      url: 'https://mp.sohu.com/mpbp/bp/news/v4/news/draft?accountId='+ _souhuCacheMeta.id,\r\n      type: 'POST',\r\n      dataType: 'JSON',\r\n      data: postStruct,\r\n    })\r\n\r\n    if(!res.success) throw new Error(res.msg)\r\n    var post_id = res.data\r\n    console.log(res)\r\n    return {\r\n      status: 'success',\r\n      post_id: post_id,\r\n      draftLink: 'https://mp.sohu.com/mpfe/v3/main/news/addarticle?spm=smmp.articlelist.0.0&contentStatus=2&id=' + post_id,\r\n    }\r\n  }\r\n\r\n  async uploadFile(file) {\r\n    var uploadUrl = 'https://mp.sohu.com/commons/front/outerUpload/image/file'\r\n    var file = new File([file.bits], 'temp', {\r\n      type: file.type\r\n    });\r\n    var formdata = new FormData()\r\n    formdata.append('file', file)\r\n    if (_souhuCacheMeta) {\r\n      formdata.append('accountId', _souhuCacheMeta.id)\r\n    }\r\n    var res = await axios({\r\n      url: uploadUrl,\r\n      method: 'post',\r\n      data: formdata,\r\n      headers: { 'Content-Type': 'multipart/form-data' },\r\n    })\r\n\r\n    return [\r\n      {\r\n        url: res.data.url,\r\n      },\r\n    ]\r\n  }\r\n\r\n  async preEditPost(post) {\r\n    var div = $('<div>')\r\n    $('body').append(div)\r\n    try {\r\n      console.log('zihu.Juejin')\r\n      div.html(post.content)\r\n      var doc = div\r\n      processDocCode(div)\r\n      makeImgVisible(div)\r\n\r\n      var tempDoc = $('<div>').append(doc.clone())\r\n      post.content =\r\n        tempDoc.children('div').length == 1\r\n          ? tempDoc.children('div').html()\r\n          : tempDoc.html()\r\n\r\n      console.log('after.predEdit', post.content)\r\n    } catch (e) {\r\n      console.log('preEdit.error', e)\r\n    }\r\n  }\r\n}\r\n\n\n/***/ }),\n\n/***/ 829:\n/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {\n\n\"use strict\";\n__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   \"default\": () => (/* binding */ ToutiaoAdapter)\n/* harmony export */ });\n\r\nclass ToutiaoAdapter {\r\n  constructor() {\r\n    // this.skipReadImage = true\r\n    this.name = 'toutiao'\r\n  }\r\n\r\n  async getMetaData() {\r\n    var res = await $.ajax({\r\n      url: 'https://mp.toutiao.com/mp/agw/media/get_media_info',\r\n    })\r\n    res = JSON.parse(res)\r\n    return {\r\n      uid: res.data.user.id,\r\n      title: res.data.user.screen_name,\r\n      avatar: res.data.user.https_avatar_url,\r\n      supportTypes: ['html'],\r\n      type: 'toutiao',\r\n      displayName: '头条',\r\n      home: 'https://mp.toutiao.com/profile_v3/graphic/publish',\r\n      icon: 'https://sf1-ttcdn-tos.pstatp.com/obj/ttfe/pgcfe/sz/mp_logo.png',\r\n    }\r\n  }\r\n\r\n  async addPost(post) {\r\n    return {\r\n      status: 'success',\r\n      post_id: 0,\r\n    }\r\n  }\r\n\r\n  async editPost(post_id, post) {\r\n    var pgc_feed_covers = []\r\n    if (post.post_thumbnail_raw && post.post_thumbnail_raw.images) {\r\n      pgc_feed_covers.push({\r\n        id: 0,\r\n        url: post.post_thumbnail_raw.url,\r\n        uri: post.post_thumbnail_raw.images[0].origin_web_uri,\r\n        origin_uri: post.post_thumbnail_raw.images[0].origin_web_uri,\r\n        ic_uri: '',\r\n        thumb_width: post.post_thumbnail_raw.images[0].width,\r\n        thumb_height: post.post_thumbnail_raw.images[0].height,\r\n      })\r\n    }\r\n\r\n    await $.get('https://mp.toutiao.com/profile_v3/graphic/publish')\r\n    var res = await $.ajax({\r\n      // url:'https://mp.toutiao.com/core/article/edit_article_post/?source=mp&type=article',\r\n      url: 'https://mp.toutiao.com/mp/agw/article/publish?source=mp&type=article',\r\n      type: 'POST',\r\n      dataType: 'JSON',\r\n      data: {\r\n        title: post.post_title,\r\n        article_ad_type: 2,\r\n        article_type: 0,\r\n        from_diagnosis: 0,\r\n        origin_debut_check_pgc_normal: 0,\r\n        tree_plan_article: 0,\r\n        save: 0,\r\n        pgc_id: 0,\r\n        content: post.post_content,\r\n        pgc_feed_covers: JSON.stringify(pgc_feed_covers),\r\n      },\r\n    })\r\n\r\n    if (!res.data) {\r\n      throw new Error(res.message)\r\n    }\r\n\r\n    return {\r\n      status: 'success',\r\n      post_id: res.data.pgc_id,\r\n      draftLink:\r\n        'https://mp.toutiao.com/profile_v3/graphic/publish?pgc_id=' +\r\n        res.data.pgc_id,\r\n    }\r\n  }\r\n\r\n  async uploadFileBySrc(file) {\r\n    var src = file.src\r\n    var res = await $.ajax({\r\n      url: 'https://mp.toutiao.com/tools/catch_picture/',\r\n      type: 'POST',\r\n      headers: {\r\n        accept: '*/*',\r\n      },\r\n      data: {\r\n        upfile: src,\r\n        version: 2,\r\n      },\r\n    })\r\n\r\n    // throw new Error('fuck');\r\n    if (res.images && !res.images.length) {\r\n      throw new Error('图片上传失败 ' + src)\r\n    }\r\n\r\n    // http only\r\n    console.log('uploadFile', res)\r\n    return [res]\r\n  }\r\n\r\n  async uploadFile(file) {\r\n    var src = file.src\r\n    var uploadUrl = 'https://mp.toutiao.com/mp/agw/article_material/photo/upload_picture?type=ueditor&pgc_watermark=1&action=uploadimage&encode=utf-8'\r\n    // var blob = new Blob([file.bits], {\r\n    //   type: file.type\r\n    // });\r\n    var file = new File([file.bits], 'temp', {\r\n      type: file.type\r\n    });\r\n    var formdata = new FormData()\r\n    formdata.append('upfile', file)\r\n    var res = await axios({\r\n      url: uploadUrl,\r\n      method: 'post',\r\n      data: formdata,\r\n      headers: { 'Content-Type': 'multipart/form-data' },\r\n    })\r\n\r\n    if (res.data.state != 'SUCCESS') {\r\n      throw new Error('图片上传失败 ' + src)\r\n    }\r\n    // http only\r\n    console.log('uploadFile', res)\r\n    return [{\r\n      id: res.data.original,\r\n      object_key: res.data.original,\r\n      url: res.data.url,\r\n      images: [\r\n        res.data\r\n      ]\r\n    }]\r\n  }\r\n\r\n  async preEditPost(post) {\r\n    var div = $('<div>')\r\n    $('body').append(div)\r\n\r\n    div.html(post.content)\r\n\r\n    // var org = $(post.content);\r\n    // var doc = $('<div>').append(org.clone());\r\n\r\n    var doc = div\r\n    var pres = doc.find('a')\r\n    for (let mindex = 0; mindex < pres.length; mindex++) {\r\n      const pre = pres.eq(mindex)\r\n      try {\r\n        pre.after(pre.html()).remove()\r\n      } catch (e) { }\r\n    }\r\n\r\n    var pres = doc.find('iframe')\r\n    for (let mindex = 0; mindex < pres.length; mindex++) {\r\n      const pre = pres.eq(mindex)\r\n      try {\r\n        pre.remove()\r\n      } catch (e) { }\r\n    }\r\n\r\n    try {\r\n      const images = doc.find('img')\r\n      for (let index = 0; index < images.length; index++) {\r\n        const image = images.eq(index)\r\n        const imgSrc = image.attr('src')\r\n        if (imgSrc && imgSrc.indexOf('.svg') > -1) {\r\n          console.log('remove svg Image')\r\n          image.remove()\r\n        }\r\n      }\r\n      const qqm = doc.find('qqmusic')\r\n      qqm.next().remove()\r\n      qqm.remove()\r\n    } catch (e) { }\r\n\r\n    post.content = $('<div>').append(doc.clone()).html()\r\n    console.log('post', post)\r\n  }\r\n\r\n  editImg(img, source) {\r\n    img.attr('web_uri', source.images[0].origin_web_uri)\r\n  }\r\n  //   <img class=\"\" src=\"http://p2.pstatp.com/large/pgc-image/bc0a9fc8e595453083d85deb947c3d6e\" data-ic=\"false\" data-ic-uri=\"\" data-height=\"1333\" data-width=\"1000\" image_type=\"1\" web_uri=\"pgc-image/bc0a9fc8e595453083d85deb947c3d6e\" img_width=\"1000\" img_height=\"1333\"></img>\r\n}\r\n\n\n/***/ }),\n\n/***/ 286:\n/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {\n\n\"use strict\";\n__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   \"default\": () => (/* binding */ WeixinAdapter)\n/* harmony export */ });\nvar weixinMetaCache = null\r\n\r\nclass WeixinAdapter {\r\n  constructor() {\r\n    this.meta = weixinMetaCache\r\n    this.name = 'weixin'\r\n  }\r\n\r\n  async getMetaData() {\r\n    var res = await $.ajax({ url: 'https://mp.weixin.qq.com/' })\r\n    var innerDoc = $(res)\r\n    var doc = $('<div>').append(innerDoc.clone())\r\n    // console.log('WeixinDriver', res);\r\n    var code = doc.find('script').eq(0).text()\r\n    code = code.substring(code.indexOf('window.wx.commonData'))\r\n    var wx = new Function(\r\n      'window.wx = {}; window.handlerNickname = function(){};' +\r\n        code +\r\n        '; return window.wx;'\r\n    )()\r\n    console.log(code, wx)\r\n    var commonData = Object.assign({}, wx.commonData)\r\n    delete window.wx\r\n    if (!commonData.data.t) {\r\n      throw new Error('未登录')\r\n    }\r\n    var metadata = {\r\n      uid: commonData.data.user_name,\r\n      title: commonData.data.nick_name,\r\n      token: commonData.data.t,\r\n      commonData: commonData,\r\n      avatar: doc.find('.weui-desktop-account__thumb').eq(0).attr('src'),\r\n      type: 'weixin',\r\n      supportTypes: ['html'],\r\n      home: 'https://mp.weixin.qq.com',\r\n      icon: 'https://mp.weixin.qq.com/favicon.ico',\r\n    }\r\n    weixinMetaCache = metadata\r\n    console.log('weixinMetaCache', weixinMetaCache)\r\n    return metadata\r\n  }\r\n\r\n  async addPost(post) {\r\n    return {\r\n      status: 'success',\r\n      post_id: 0,\r\n    }\r\n  }\r\n  \r\n  async searchAccount({ keyword, begin=0, count=5 }) {\r\n    var token = weixinMetaCache.token || '442135330'\r\n    const apiURL = `https://mp.weixin.qq.com/cgi-bin/searchbiz?action=search_biz&begin=${begin}&count=${count}&query=${encodeURIComponent(keyword)}&token=${token}&lang=zh_CN&f=json&ajax=1`\r\n    const response = await $.get(apiURL)\r\n    return response\r\n  }\r\n  \r\n  async listArticle({ fakeid = '', begin=0, count=5}) {\r\n  \tvar token = weixinMetaCache.token || '442135330'\r\n    const apiURL = `https://mp.weixin.qq.com/cgi-bin/appmsg?action=list_ex&begin=${begin}&count=${count}&fakeid=${fakeid}&type=9&query=&token=${token}&lang=zh_CN&f=json&ajax=1`\r\n    const response = await $.get(apiURL)\r\n    return response\r\n  }\r\n\r\n  async getArticle(data) {\r\n    var token = weixinMetaCache.token || '442135330'\r\n    const tempRespone = await $.get(\r\n      `https://mp.weixin.qq.com/cgi-bin/appmsg?action=get_temp_url&appmsgid=${data.msgId}&itemidx=1&token=${token}&lang=zh_CN&f=json&ajax=1`\r\n    )\r\n    const { temp_url } = tempRespone\r\n    const htmlData = await $.get(temp_url)\r\n    const doc = $(htmlData)\r\n    console.log('htmlData', htmlData)\r\n    var post = {}\r\n\r\n    const allMetas = doc\r\n      .filter(function(index, el) {\r\n        return $(el).attr('property') && $(el).attr('content')\r\n      })\r\n      .map(function() {\r\n        return {\r\n          name: $(this).attr('property'),\r\n          content: $(this).attr('content'),\r\n        }\r\n      })\r\n      .toArray()\r\n\r\n    const metaObj = {}\r\n    allMetas.forEach(obj => {\r\n      metaObj[obj.name] = obj.content\r\n    })\r\n\r\n    post.title = metaObj['og:title']\r\n    post.content = doc.find('#js_content').html()\r\n    post.thumb = metaObj['og:image']\r\n    post.desc = metaObj['og:description']\r\n    post.link = metaObj['og:url'];\r\n    console.log('post', post, doc)\r\n    return post\r\n  }\r\n\r\n  async editPost(post_id, post) {\r\n    console.log('editPost', post.post_thumbnail)\r\n    var res = await $.ajax({\r\n      url:\r\n        'https://mp.weixin.qq.com/cgi-bin/operate_appmsg?t=ajax-response&sub=create&type=77&token=' +\r\n        weixinMetaCache.token +\r\n        '&lang=zh_CN',\r\n      type: 'POST',\r\n      dataType: 'JSON',\r\n      data: {\r\n        token: weixinMetaCache.token,\r\n        lang: 'zh_CN',\r\n        f: 'json',\r\n        ajax: '1',\r\n        random: Math.random(),\r\n        AppMsgId: '',\r\n        count: '1',\r\n        data_seq: '0',\r\n        operate_from: 'Chrome',\r\n        isnew: '0',\r\n        ad_video_transition0: '',\r\n        can_reward0: '0',\r\n        related_video0: '',\r\n        is_video_recommend0: '-1',\r\n        title0: post.post_title,\r\n        author0: '',\r\n        writerid0: '0',\r\n        fileid0: '',\r\n        digest0: post.post_title,\r\n        auto_gen_digest0: '1',\r\n        content0: post.post_content,\r\n        sourceurl0: '',\r\n        need_open_comment0: '1',\r\n        only_fans_can_comment0: '0',\r\n        cdn_url0: '',\r\n        cdn_235_1_url0: '',\r\n        cdn_1_1_url0: '',\r\n        cdn_url_back0: '',\r\n        crop_list0: '',\r\n        music_id0: '',\r\n        video_id0: '',\r\n        voteid0: '',\r\n        voteismlt0: '',\r\n        supervoteid0: '',\r\n        cardid0: '',\r\n        cardquantity0: '',\r\n        cardlimit0: '',\r\n        vid_type0: '',\r\n        show_cover_pic0: '0',\r\n        shortvideofileid0: '',\r\n        copyright_type0: '0',\r\n        releasefirst0: '',\r\n        platform0: '',\r\n        reprint_permit_type0: '',\r\n        allow_reprint0: '',\r\n        allow_reprint_modify0: '',\r\n        original_article_type0: '',\r\n        ori_white_list0: '',\r\n        free_content0: '',\r\n        fee0: '0',\r\n        ad_id0: '',\r\n        guide_words0: '',\r\n        is_share_copyright0: '0',\r\n        share_copyright_url0: '',\r\n        source_article_type0: '',\r\n        reprint_recommend_title0: '',\r\n        reprint_recommend_content0: '',\r\n        share_page_type0: '0',\r\n        share_imageinfo0: '{\"list\":[]}',\r\n        share_video_id0: '',\r\n        dot0: '{}',\r\n        share_voice_id0: '',\r\n        insert_ad_mode0: '',\r\n        categories_list0: '[]',\r\n        sections0:\r\n          '[{\"section_index\":1000000,\"text_content\":\"​kkk\",\"section_type\":9,\"ad_available\":false}]',\r\n        compose_info0:\r\n          '{\"list\":[{\"blockIdx\":1,\"content\":\"<p>​kkk<br></p>\",\"width\":574,\"height\":27,\"topMargin\":0,\"blockType\":9,\"background\":\"rgba(0, 0, 0, 0)\",\"text\":\"kkk\",\"textColor\":\"rgb(51, 51, 51)\",\"textFontSize\":\"17px\",\"textBackGround\":\"rgba(0, 0, 0, 0)\"}]}',\r\n      },\r\n    })\r\n\r\n    if (!res.appMsgId) {\r\n      var err = formatError(res)\r\n      console.log('error', err)\r\n      throw new Error(\r\n        '同步失败 错误内容：' + (err && err.errmsg ? err.errmsg : res.ret)\r\n      )\r\n    }\r\n    return {\r\n      status: 'success',\r\n      post_id: res.appMsgId,\r\n      draftLink:\r\n        'https://mp.weixin.qq.com/cgi-bin/appmsg?t=media/appmsg_edit&action=edit&type=77&appmsgid=' +\r\n        res.appMsgId +\r\n        '&token=' +\r\n        weixinMetaCache.token +\r\n        '&lang=zh_CN',\r\n    }\r\n    // https://zhuanlan.zhihu.com/api/articles/68769713/draft\r\n  }\r\n\r\n  async uploadFile(file) {\r\n    var formdata = new FormData()\r\n    var blob = new Blob([file.bits], {\r\n        type: file.type\r\n    });\r\n\r\n    formdata.append('type', blob.type)\r\n    formdata.append('id', new Date().getTime())\r\n    formdata.append('name', new Date().getTime() + '.jpg')\r\n    formdata.append('lastModifiedDate', new Date().toString())\r\n    formdata.append('size', blob.size)\r\n    formdata.append('file', blob, new Date().getTime() + '.jpg')\r\n\r\n    var ticket_id = this.meta.commonData.data.user_name,\r\n      ticket = this.meta.commonData.data.ticket,\r\n      svr_time =  this.meta.commonData.data.time,\r\n      token = this.meta.commonData.data.t,\r\n      seq = new Date().getTime();\r\n\r\n    var res = await axios({\r\n      url: `https://mp.weixin.qq.com/cgi-bin/filetransfer?action=upload_material&f=json&scene=8&writetype=doublewrite&groupid=1&ticket_id=${ticket_id}&ticket=${ticket}&svr_time=${svr_time}&token=${token}&lang=zh_CN&seq=${seq}&t=` + Math.random(),\r\n      method: 'post',\r\n      data: formdata,\r\n      headers: { 'Content-Type': 'multipart/form-data' },\r\n    })\r\n    var url = res.data.cdn_url\r\n    if(res.data.base_resp.err_msg != 'ok') {\r\n      console.log(res.data);\r\n      throw new Error('upload failed')\r\n    }\r\n    //  return url;\r\n    return [\r\n      {\r\n        id: res.data.content,\r\n        object_key: res.data.content,\r\n        url: url,\r\n      },\r\n    ]\r\n  }\r\n\r\n  async uploadFileBySource(file) {\r\n    var src = file.src\r\n    var res = await $.ajax({\r\n      url:\r\n        'https://mp.weixin.qq.com/cgi-bin/uploadimg2cdn?lang=zh_CN&token=' +\r\n        weixinMetaCache.token +\r\n        '&t=' +\r\n        Math.random(),\r\n      type: 'POST',\r\n      dataType: 'JSON',\r\n      data: {\r\n        imgurl: src,\r\n        t: 'ajax-editor-upload-img',\r\n        token: weixinMetaCache.token,\r\n        lang: 'zh_CN',\r\n        f: 'json',\r\n        ajax: '1',\r\n      },\r\n    })\r\n\r\n    if (res.errcode != 0) {\r\n      throw new Error('图片上传失败' + src)\r\n    }\r\n    console.log(res)\r\n    return [\r\n      {\r\n        id: 'aaa',\r\n        object_key: 'aaa',\r\n        url: res.url,\r\n      },\r\n    ]\r\n  }\r\n\r\n  async preEditPost(post) {\r\n    var div = $('<div>')\r\n    $('body').append(div)\r\n\r\n    if (post.inline_content) {\r\n      post.content = post.inline_content\r\n    }\r\n\r\n    div.html(post.content)\r\n\r\n    var doc = div\r\n    var tags = doc.find('p')\r\n    for (let mindex = 0; mindex < tags.length; mindex++) {\r\n      const tag = tags.eq(mindex)\r\n      try {\r\n        var nextHasImage = tag.next().children('img').length\r\n        var span = $('<span></span>')\r\n        span.html(tag.html())\r\n        tag.html('')\r\n        tag.append(span)\r\n        // if (!tag.children(\"br\").length) tag.css(\"margin-bottom\", \"20px\");\r\n        // tag.after(\"<p><br></p>\");\r\n        // span.css(\"color\", \"rgb(68, 68, 68)\");\r\n        // span.css(\"font-size\", \"16px\");\r\n      } catch (e) {}\r\n    }\r\n\r\n    var tags = doc.find('img')\r\n    for (let mindex = 0; mindex < tags.length; mindex++) {\r\n      const tag = tags.eq(mindex)\r\n      const wraperTag = tag.parent()\r\n      try {\r\n        tag.removeAttr('_src')\r\n        tag.attr('style', '')\r\n        wraperTag.replaceWith('<p>' + wraperTag.html() + '</p>')\r\n      } catch (e) {}\r\n    }\r\n\r\n    var pres = doc.find('a')\r\n    for (let mindex = 0; mindex < pres.length; mindex++) {\r\n      const pre = pres.eq(mindex)\r\n      try {\r\n        pre.after(pre.html()).remove()\r\n      } catch (e) {}\r\n    }\r\n\r\n    var processEmptyLine = function (idx, el) {\r\n      var $obj = $(this)\r\n      var originalText = $obj.text()\r\n      var img = $obj.find('img')\r\n      var brs = $obj.find('br')\r\n      if (originalText == '') {\r\n        ;(function () {\r\n          if (img.length) return\r\n          if (!brs.length) return\r\n          $obj.remove()\r\n        })()\r\n      }\r\n    }\r\n\r\n    var processListItem = function (idx, el) {\r\n      var $obj = $(this)\r\n      $obj.html($('<p></p>').append($obj.html()))\r\n    }\r\n\r\n    doc.find('li').each(processListItem)\r\n    // remove empty break line\r\n    doc.find('p').each(processEmptyLine)\r\n\r\n    var processBr = function (idx, el) {\r\n      var $obj = $(this)\r\n      if (!$obj.next().length) {\r\n        $obj.remove()\r\n      }\r\n    }\r\n\r\n    doc.find('br').each(processBr)\r\n    post.content = $('<div>')\r\n      .append(\r\n        \"<section style='margin-left: 6px;margin-right: 6px;line-height: 1.75em;'>\" +\r\n          doc.clone().html() +\r\n          '</section>'\r\n      )\r\n      .html()\r\n\r\n    console.log('post.content', post.content)\r\n    var inlineCssHTML = juice.inlineContent(\r\n      post.content,\r\n      `\r\n    /**\r\n    * common style\r\n    */\r\n\r\n   html, address,\r\n   blockquote,\r\n   body, dd, div,\r\n   dl, dt, fieldset, form,\r\n   frame, frameset,\r\n   h1, h2, h3, h4,\r\n   h5, h6, noframes,\r\n   ol, p, ul, center,\r\n   dir, hr, menu, pre   { display: block; unicode-bidi: embed }\r\n   li              { display: list-item }\r\n   head            { display: none }\r\n   table           { display: table }\r\n   tr              { display: table-row }\r\n   thead           { display: table-header-group }\r\n   tbody           { display: table-row-group }\r\n   tfoot           { display: table-footer-group }\r\n   col             { display: table-column }\r\n   colgroup        { display: table-column-group }\r\n   td, th          { display: table-cell }\r\n   caption         { display: table-caption }\r\n   th              { font-weight: bolder; text-align: center }\r\n   caption         { text-align: center }\r\n   body            { margin: 8px }\r\n   h1              { font-size: 2em; margin: .67em 0 }\r\n   h2              { font-size: 1.5em; margin: .75em 0 }\r\n   h3              { font-size: 1.17em; margin: .83em 0 }\r\n   h4, p,\r\n   blockquote, ul,\r\n   fieldset, form,\r\n   ol, dl, dir,\r\n   menu            { margin: 1.12em 0 }\r\n   h5              { font-size: .83em; margin: 1.5em 0 }\r\n   h6              { font-size: .75em; margin: 1.67em 0 }\r\n   h1, h2, h3, h4,\r\n   h5, h6, b,\r\n   strong          { font-weight: bolder }\r\n   blockquote      { margin-left: 40px; margin-right: 40px }\r\n   i, cite, em,\r\n   var, address    { font-style: italic }\r\n   pre, tt, code,\r\n   kbd, samp       { font-family: monospace }\r\n   pre             { white-space: pre }\r\n   button, textarea,\r\n   input, select   { display: inline-block }\r\n   big             { font-size: 1.17em }\r\n   small, sub, sup { font-size: .83em }\r\n   sub             { vertical-align: sub }\r\n   sup             { vertical-align: super }\r\n   table           { border-spacing: 2px; }\r\n   thead, tbody,\r\n   tfoot           { vertical-align: middle }\r\n   td, th, tr      { vertical-align: inherit }\r\n   s, strike, del  { text-decoration: line-through }\r\n   hr              { border: 1px inset }\r\n   ol, ul, dir,\r\n   menu, dd        { margin-left: 40px }\r\n   ol              { list-style-type: decimal }\r\n   ol ul, ul ol,\r\n   ul ul, ol ol    { margin-top: 0; margin-bottom: 0 }\r\n   u, ins          { text-decoration: underline }\r\n   br:before       { content: \"\\A\"; white-space: pre-line }\r\n   center          { text-align: center }\r\n   :link, :visited { text-decoration: underline }\r\n   :focus          { outline: thin dotted invert }\r\n\r\n   /* Begin bidirectionality settings (do not change) */\r\n   BDO[DIR=\"ltr\"]  { direction: ltr; unicode-bidi: bidi-override }\r\n   BDO[DIR=\"rtl\"]  { direction: rtl; unicode-bidi: bidi-override }\r\n\r\n   *[DIR=\"ltr\"]    { direction: ltr; unicode-bidi: embed }\r\n   *[DIR=\"rtl\"]    { direction: rtl; unicode-bidi: embed }\r\n\r\n   @media print {\r\n     h1            { page-break-before: always }\r\n     h1, h2, h3,\r\n     h4, h5, h6    { page-break-after: avoid }\r\n     ul, ol, dl    { page-break-before: avoid }\r\n   }\r\n   h1,\r\n   h2,\r\n   h3,\r\n   h4,\r\n   h5,\r\n   h6 {\r\n     font-weight: bold;\r\n   }\r\n\r\n   h1 {\r\n     font-size: 1.25em;\r\n     line-height: 1.4em;\r\n   }\r\n\r\n   h2 {\r\n     font-size: 1.125em;\r\n   }\r\n\r\n   h3 {\r\n     font-size: 1.05em;\r\n   }\r\n\r\n   h4,\r\n   h5,\r\n   h6 {\r\n     font-size: 1em;\r\n     margin: 1em 0;\r\n   }\r\n\r\n    p {\r\n      color: rgb(51, 51, 51);\r\n      font-size: 15px;\r\n    }\r\n\r\n    li p {\r\n      margin: 0;\r\n    }\r\n   `\r\n    )\r\n    console.log('inlineCssHTML new', inlineCssHTML)\r\n    post.content = inlineCssHTML\r\n  }\r\n}\r\n\r\nfunction formatError(e) {\r\n  var r,\r\n    a = {\r\n      errmsg: '',\r\n      index: !1,\r\n    }\r\n  switch (\r\n    ('undefined' != typeof e.ret\r\n      ? (r = 1 * e.ret)\r\n      : e.base_resp &&\r\n        'undefined' != typeof e.base_resp.ret &&\r\n        (r = 1 * e.base_resp.ret),\r\n    1 * r)\r\n  ) {\r\n    case -8:\r\n    case -6:\r\n      ;(e.ret = '-6'), (a.errmsg = '请输入验证码')\r\n      break\r\n\r\n    case 62752:\r\n      a.errmsg = '可能含有具备安全风险的链接，请检查'\r\n      break\r\n\r\n    case 64505:\r\n      a.errmsg = '发送预览失败，请稍后再试'\r\n      break\r\n\r\n    case 64504:\r\n      a.errmsg = '保存图文消息发送错误，请稍后再试'\r\n      break\r\n\r\n    case 64518:\r\n      a.errmsg = '正文只能包含一个投票'\r\n      break\r\n\r\n    case 10704:\r\n    case 10705:\r\n      a.errmsg = '该素材已被删除'\r\n      break\r\n\r\n    case 10701:\r\n      a.errmsg = '用户已被加入黑名单，无法向其发送消息'\r\n      break\r\n\r\n    case 10703:\r\n      a.errmsg = '对方关闭了接收消息'\r\n      break\r\n\r\n    case 10700:\r\n    case 64503:\r\n      a.errmsg =\r\n        '1.接收预览消息的微信尚未关注公众号，请先扫码关注<br /> 2.如果已经关注公众号，请查看微信的隐私设置（在手机微信的“我->设置->隐私->添加我的方式”中），并开启“可通过以下方式找到我”的“手机号”、“微信号”、“QQ号”，否则可能接收不到预览消息'\r\n      break\r\n\r\n    case 64502:\r\n      a.errmsg = '你输入的微信号不存在，请重新输入'\r\n      break\r\n\r\n    case 64501:\r\n      a.errmsg = '你输入的帐号不存在，请重新输入'\r\n      break\r\n\r\n    case 412:\r\n      a.errmsg = '图文中含非法外链'\r\n      break\r\n\r\n    case 64515:\r\n      a.errmsg = '当前素材非最新内容，请重新打开并编辑'\r\n      break\r\n\r\n    case 320001:\r\n      a.errmsg = '该素材已被删除，无法保存'\r\n      break\r\n\r\n    case 64702:\r\n      a.errmsg = '标题超出64字长度限制'\r\n      break\r\n\r\n    case 64703:\r\n      a.errmsg = '摘要超出120字长度限制'\r\n      break\r\n\r\n    case 64704:\r\n      a.errmsg = '推荐语超出300字长度限制'\r\n      break\r\n\r\n    case 64708:\r\n      a.errmsg = '推荐语超出140字长度限制'\r\n      break\r\n\r\n    case 64515:\r\n      a.errmsg = '当前素材非最新内容'\r\n      break\r\n\r\n    case 200041:\r\n      a.errmsg = '此素材有文章存在违规，无法编辑'\r\n      break\r\n\r\n    case 64506:\r\n      a.errmsg = '保存失败,链接不合法'\r\n      break\r\n\r\n    case 64507:\r\n      a.errmsg =\r\n        '内容不能包含外部链接，请输入http://或https://开头的公众号相关链接'\r\n      break\r\n\r\n    case 64510:\r\n      a.errmsg = '内容不能包含音频，请调整'\r\n      break\r\n\r\n    case 64511:\r\n      a.errmsg = '内容不能包多个音频，请调整'\r\n      break\r\n\r\n    case 64512:\r\n      a.errmsg = '文章中音频错误,请使用音频添加按钮重新添加。'\r\n      break\r\n\r\n    case 64508:\r\n      a.errmsg = '查看原文链接可能具备安全风险，请检查'\r\n      break\r\n\r\n    case 64550:\r\n      a.errmsg = '请勿插入不合法的图文消息链接'\r\n      break\r\n\r\n    case 64558:\r\n      a.errmsg = '请勿插入图文消息临时链接，链接会在短期失效'\r\n      break\r\n\r\n    case 64559:\r\n      a.errmsg = '请勿插入未群发的图文消息链接'\r\n      break\r\n\r\n    case -99:\r\n      a.errmsg = '内容超出字数，请调整'\r\n      break\r\n\r\n    case 64705:\r\n      a.errmsg = '内容超出字数，请调整'\r\n      break\r\n\r\n    case -1:\r\n      a.errmsg = '系统错误，请注意备份内容后重试'\r\n      break\r\n\r\n    case -2:\r\n    case 200002:\r\n      a.errmsg = '参数错误，请注意备份内容后重试'\r\n      break\r\n\r\n    case 64509:\r\n      a.errmsg = '正文中不能包含超过3个视频，请重新编辑正文后再保存。'\r\n      break\r\n\r\n    case -5:\r\n      a.errmsg = '服务错误，请注意备份内容后重试。'\r\n      break\r\n\r\n    case 64513:\r\n      a.errmsg = '请从正文中选择封面，再尝试保存。'\r\n      break\r\n\r\n    case -206:\r\n      a.errmsg = '目前，服务负荷过大，请稍后重试。'\r\n      break\r\n\r\n    case 10801:\r\n      ;(a.errmsg =\r\n        '标题不能有违反公众平台协议、相关法律法规和政策的内容，请重新编辑。'),\r\n        (a.index = 1 * e.msg)\r\n      break\r\n\r\n    case 10802:\r\n      ;(a.errmsg =\r\n        '作者不能有违反公众平台协议、相关法律法规和政策的内容，请重新编辑。'),\r\n        (a.index = 1 * e.msg)\r\n      break\r\n\r\n    case 10803:\r\n      ;(a.errmsg = '敏感链接，请重新添加。'), (a.index = 1 * e.msg)\r\n      break\r\n\r\n    case 10804:\r\n      ;(a.errmsg =\r\n        '摘要不能有违反公众平台协议、相关法律法规和政策的内容，请重新编辑。'),\r\n        (a.index = 1 * e.msg)\r\n      break\r\n\r\n    case 10806:\r\n      ;(a.errmsg =\r\n        '正文不能有违反公众平台协议、相关法律法规和政策的内容，请重新编辑。'),\r\n        (a.index = 1 * e.msg)\r\n      break\r\n\r\n    case 10808:\r\n      ;(a.errmsg =\r\n        '推荐语不能有违反公众平台协议、相关法律法规和政策的内容，请重新编辑。'),\r\n        (a.index = 1 * e.msg)\r\n      break\r\n\r\n    case 10807:\r\n      a.errmsg = '内容不能违反公众平台协议、相关法律法规和政策，请重新编辑。'\r\n      break\r\n\r\n    case 200003:\r\n      a.errmsg = '登录态超时，请重新登录。'\r\n      break\r\n\r\n    case 64513:\r\n      a.errmsg = '封面必须存在正文中，请检查封面'\r\n      break\r\n\r\n    case 64551:\r\n      a.errmsg = '请检查图文消息中的微视链接后重试。'\r\n      break\r\n\r\n    case 64552:\r\n      a.errmsg = '请检查阅读原文中的链接后重试。'\r\n      break\r\n\r\n    case 64553:\r\n      a.errmsg = '请不要在图文消息中插入超过5张卡券。请删减卡券后重试。'\r\n      break\r\n\r\n    case 64554:\r\n      a.errmsg = '在当前情况下不允许在图文消息中插入卡券，请删除卡券后重试。'\r\n      break\r\n\r\n    case 64555:\r\n      a.errmsg = '请检查图文消息卡片跳转的链接后重试。'\r\n      break\r\n\r\n    case 64556:\r\n      a.errmsg = '卡券不属于该公众号，请删除后重试'\r\n      break\r\n\r\n    case 64557:\r\n      a.errmsg = '卡券无效，请删除后重试。'\r\n      break\r\n\r\n    case 13002:\r\n      ;(a.errmsg = '该广告卡片已过期，删除后才可保存成功'),\r\n        (a.index = 1 * e.msg)\r\n      break\r\n\r\n    case 13003:\r\n      ;(a.errmsg = '已有文章插入过该广告卡片，一个广告卡片仅可插入一篇文章'),\r\n        (a.index = 1 * e.msg)\r\n      break\r\n\r\n    case 13004:\r\n      ;(a.errmsg = '该广告卡片与图文消息位置不一致'), (a.index = 1 * e.msg)\r\n      break\r\n\r\n    case 15801:\r\n    case 15802:\r\n    case 15803:\r\n    case 15804:\r\n    case 15805:\r\n    case 15806:\r\n      a.errmsg =\r\n        e.remind_wording ||\r\n        '你所编辑的内容可能含有违反微信公众平台平台协议、相关法律法规和政策的内容'\r\n      break\r\n\r\n    case 1530503:\r\n      a.errmsg = '请勿添加其他公众号的主页链接'\r\n      break\r\n\r\n    case 1530504:\r\n      a.errmsg = '请勿添加其他公众号的主页链接'\r\n      break\r\n\r\n    case 1530510:\r\n      a.errmsg = '链接已失效，请在手机端重新复制链接'\r\n      break\r\n\r\n    case 153007:\r\n    case 153008:\r\n    case 153009:\r\n    case 153010:\r\n      a.errmsg =\r\n        '很抱歉，原创声明不成功|你的文章内容未达到声明原创的要求，满足以下任一条件可发起声明：<br />1、文章文字字数大于300字，且自己创作的内容大于引用内容<br />2、文章文字字数小于300字，无视频，且图片（包括封面图）均为你已成功声明原创的图片<br />说明：上述要求中，文章文字字数不包含标点符号和空格，请知悉。'\r\n      break\r\n\r\n    case 153200:\r\n      a.errmsg = '无权限声明原创，取消声明后重试'\r\n      break\r\n\r\n    case 1530511:\r\n      a.errmsg = '链接已失效，请在手机端重新复制链接'\r\n      break\r\n\r\n    case 220001:\r\n      a.errmsg = '\"素材管理\"中的存储数量已达到上限，请删除后再操作。'\r\n      break\r\n\r\n    case 220002:\r\n      a.errmsg = '你的图片库已达到存储上限，请进行清理。'\r\n      break\r\n\r\n    case 153012:\r\n      a.errmsg = '请设置转载类型'\r\n      break\r\n\r\n    case 200042:\r\n      a.errmsg = '图文中包含的小程序素材不能多于50个、小程序帐号不能多于10个'\r\n      break\r\n\r\n    case 200043:\r\n      a.errmsg = '图文中包含没有关联的小程序，请删除后再保存'\r\n      break\r\n\r\n    case 64601:\r\n      a.errmsg = '一篇文章只能插入一个广告卡片'\r\n      break\r\n\r\n    case 64602:\r\n      a.errmsg = '尚未开通文中广告位，但文章中有广告'\r\n      break\r\n\r\n    case 64603:\r\n      a.errmsg = '文中广告前不足300字'\r\n      break\r\n\r\n    case 64604:\r\n      a.errmsg = '文中广告后不足300字'\r\n      break\r\n\r\n    case 64605:\r\n      a.errmsg = '文中不能同时插入文中广告和互选广告'\r\n      break\r\n\r\n    case 65101:\r\n      a.errmsg = '图文模版数量已达到上限，请删除后再操作'\r\n      break\r\n\r\n    case 64560:\r\n      a.errmsg = '请勿插入历史图文消息页链接'\r\n      break\r\n\r\n    case 64561:\r\n      a.errmsg = '请勿插入mp.weixin.qq.com域名下的非图文消息链接'\r\n      break\r\n\r\n    case 64562:\r\n      a.errmsg = '请勿插入非mp.weixin.qq.com域名的链接'\r\n      break\r\n\r\n    case 153013:\r\n      a.errmsg = '文章内含有投票，不能设置为开放转载'\r\n      break\r\n\r\n    case 153014:\r\n      a.errmsg = '文章内含有卡券，不能设置为开放转载'\r\n      break\r\n\r\n    case 153015:\r\n      a.errmsg = '文章内含有小程序链接，不能设置为开放转载'\r\n      break\r\n\r\n    case 153016:\r\n      a.errmsg = '文章内含有小程序链接，不能设置为开放转载'\r\n      break\r\n\r\n    case 153017:\r\n      a.errmsg = '文章内含有小程序卡片，不能设置为开放转载'\r\n      break\r\n\r\n    case 153018:\r\n      a.errmsg = '文章内含有商品，不能设置为开放转载'\r\n      break\r\n\r\n    case 153019:\r\n      a.errmsg = '文章内含有广告卡片，不能设置为开放转载'\r\n      break\r\n\r\n    case 153020:\r\n      a.errmsg = '文章内含有广告卡片，不能设置为开放转载'\r\n      break\r\n\r\n    case 153021:\r\n      a.errmsg = '文章内含有广告卡片，不能设置为开放转载'\r\n      break\r\n\r\n    case 153101:\r\n      a.errmsg = '含有原文已删除的转载文章，请删除后重试'\r\n      break\r\n\r\n    case 64707:\r\n      a.errmsg = '赞赏账户授权失效或者状态异常'\r\n      break\r\n\r\n    case 420001:\r\n      a.errmsg = '封面图不支持GIF，请更换'\r\n      break\r\n\r\n    case 353004:\r\n      a.errmsg = '不支持添加商品，请删除后重试'\r\n      break\r\n\r\n    case 442001:\r\n      a.errmsg = '帐号新建/编辑素材能力已被封禁，暂不可使用。'\r\n      break\r\n\r\n    default:\r\n      a.errmsg = '系统繁忙，请稍后重试'\r\n  }\r\n  return a\r\n}\r\n\r\n// exports.driver = WeixinAdapter\r\n\n\n/***/ }),\n\n/***/ 361:\n/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {\n\n\"use strict\";\n__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   \"default\": () => (/* binding */ WordpressAdapter)\n/* harmony export */ });\nfunction xmlrpcWrapper(conf) {\r\n  return new Promise((resolve, reject) => {\r\n    $.xmlrpc(conf).then(\r\n      function(response, status, xhr) {\r\n        resolve({\r\n          response,\r\n          status,\r\n          xhr,\r\n        })\r\n      },\r\n      function(jqXHR, status, error) {\r\n        reject({\r\n          jqXHR,\r\n          status,\r\n          error,\r\n        })\r\n      }\r\n    )\r\n  })\r\n}\r\n\r\nclass WordpressAdapter {\r\n  constructor(url, user, pwd, isTypecho) {\r\n    this.url = url\r\n    this.user = user\r\n    this.pwd = pwd\r\n    this.isTypecho = isTypecho\r\n  }\r\n\r\n  getRPC() {\r\n    var endPoint = this.url + '/xmlrpc.php'\r\n    if (this.isTypecho) {\r\n      endPoint = this.url + '/action/xmlrpc'\r\n    }\r\n    return endPoint\r\n  }\r\n\r\n  async getMetaData() {\r\n    var params = [this.user, this.pwd]\r\n    var res = await xmlrpcWrapper({\r\n      url: this.getRPC(),\r\n      methodName: 'wp.getUsersBlogs',\r\n      params: params,\r\n    })\r\n    console.log('end')\r\n    res.icon = chrome.extension.getURL('images/wordpress.ico')\r\n    return res\r\n  }\r\n\r\n  addPost(post) {\r\n    if (this.isTypecho) {\r\n      return {\r\n        status: 'success',\r\n        post_id: '1',\r\n      }\r\n    }\r\n\r\n    var params = [0, this.user, this.pwd, post]\r\n    var end = this.url\r\n    return xmlrpcWrapper({\r\n      url: this.getRPC(),\r\n      methodName: 'wp.newPost',\r\n      params: params,\r\n    })\r\n  }\r\n\r\n  editPost(post_id, post) {\r\n    var params = [0, this.user, this.pwd, post]\r\n    var endpoint = this.getRPC()\r\n    var isTypecho = this.isTypecho\r\n    if (isTypecho) {\r\n      params.push(false)\r\n      params[3] = {\r\n        title: post['post_title'],\r\n        // text: \"!!!\\n\" + post['post_content'].trim() + \"\\n!!!\",\r\n        description: post['post_content'].trim(),\r\n        // markdown: 1\r\n      }\r\n      console.log('params', params)\r\n    } else {\r\n      params[3] = post_id\r\n      params.push(post)\r\n    }\r\n    return new Promise((resolve, reject) => {\r\n      ;(async () => {\r\n        try {\r\n          var res = await xmlrpcWrapper({\r\n            url: endpoint,\r\n            methodName: isTypecho ? 'metaWeblog.newPost' : 'wp.editPost',\r\n            params: params,\r\n          })\r\n\r\n          res.draftLink = this.url + '?p=' + post_id\r\n          console.log('Wordpress', res)\r\n          resolve(res)\r\n        } catch (e) {\r\n          reject(e)\r\n        }\r\n      })()\r\n    })\r\n  }\r\n\r\n  //  'metaWeblog.getPost' => array($this, 'mwGetPost'),\r\n\r\n  editImg(img, source) {\r\n    // img.attr('web_uri', source.images[0].origin_web_uri)\r\n    img.removeAttr('data-src')\r\n  }\r\n\r\n  uploadFile(file) {\r\n    if (this.isTypecho) {\r\n      file['bytes'] = file['bits']\r\n      delete file['bits']\r\n    }\r\n    var params = [0, this.user, this.pwd, file]\r\n\r\n    var end = this.url\r\n    return $.xmlrpc({\r\n      url: this.getRPC(),\r\n      methodName: 'wp.uploadFile',\r\n      params: params,\r\n    })\r\n  }\r\n}\r\n\n\n/***/ }),\n\n/***/ 759:\n/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {\n\n\"use strict\";\n__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   \"default\": () => (/* binding */ XueQiuAdapter)\n/* harmony export */ });\n\r\nclass XueQiuAdapter {\r\n  constructor() {\r\n    this.name = 'xueqiu'\r\n    modifyRequestHeaders('mp.xueqiu.com/xq/statuses', {\r\n      Origin: 'https://mp.xueqiu.com',\r\n      Referer: 'https://mp.xueqiu.com'\r\n    }, [\r\n      '*://mp.xueqiu.com/xq/*',\r\n    ], function (details) {\r\n    })\r\n  }\r\n\r\n  async getMetaData() {\r\n    const res = await axios.get('https://mp.xueqiu.com/write/')\r\n    const parser = new DOMParser()\r\n    const htmlDoc = parser.parseFromString(res.data, 'text/html')\r\n    const link = htmlDoc.querySelector('#currentUser')\r\n    if (!link) {\r\n      throw Error('not found')\r\n    }\r\n    const state = new Function(\"return \" + link.innerHTML.replace('window.UOM_CURRENTUSER = ', ''))()\r\n    const { currentUser } = state\r\n    if (currentUser.id == \"\")  throw Error('not found')\r\n    return {\r\n      uid: currentUser.id,\r\n      title: currentUser.screen_name,\r\n      avatar:\r\n        `https:${currentUser.photo_domain}` +\r\n        currentUser.profile_image_url.split(',')[0],\r\n      supportTypes: ['html'],\r\n      type: 'xueqiu',\r\n      displayName: '雪球',\r\n      home: 'https://mp.xueqiu.com/write',\r\n      icon: 'https://xqdoc.imedao.com/17aebcfb84a145d33fc18679.ico',\r\n    }\r\n  }\r\n\r\n  async addPost(post) {\r\n    return {\r\n      status: 'success',\r\n      post_id: 0,\r\n    }\r\n  }\r\n\r\n  async editPost(post_id, post) {\r\n    const content = `${post.post_content}`\r\n    try {\r\n      var res = await $.ajax({\r\n        url: 'https://mp.xueqiu.com/xq/statuses/draft/save.json',\r\n        type: 'POST',\r\n        dataType: 'JSON',\r\n        data: {\r\n          text: post.post_content,\r\n          title: post.post_title,\r\n          cover_pic: null,\r\n          flags: false,\r\n          original_event: null,\r\n          status_id: null,\r\n          legal_user_visible: false,\r\n          is_private: false,\r\n        },\r\n      })\r\n\r\n      const post_id = res.id\r\n      return {\r\n        status: 'success',\r\n        post_id: post_id,\r\n        draftLink: `https://mp.xueqiu.com/write/draft/${post_id}`\r\n      }\r\n    } catch (e) {\r\n      throw new Error(e.toString())\r\n    }\r\n  }\r\n\r\n  async uploadFile(file) {\r\n    const { src, post_id } = file\r\n    var uploadUrl = \"https://mp.xueqiu.com/xq/photo/upload.json\"\r\n    var file = new File([file.bits], 'temp.jpg', {\r\n      type: file.type\r\n    });\r\n    var formdata = new FormData()\r\n    formdata.append('file', file)\r\n    var res = await axios({\r\n      url: uploadUrl,\r\n      method: 'post',\r\n      data: formdata,\r\n      headers: { 'Content-Type': 'multipart/form-data' },\r\n    })\r\n\r\n    if (!res.data.url) {\r\n      throw new Error('图片上传失败 ' + src)\r\n    }\r\n    // http only\r\n    console.log('uploadFile', res)\r\n    const url = `https:${res.data.url}/${res.data.filename}`;\r\n    return [{\r\n      id: res.data.filename,\r\n      object_key: res.data.filename,\r\n      url: url,\r\n      images: [\r\n        res.data\r\n      ]\r\n    }]\r\n  }\r\n\r\n  async preEditPost(post) {\r\n    var div = $('<div>')\r\n    $('body').append(div)\r\n    div.html(post.content)\r\n    var doc = div\r\n\r\n    tools.doPreFilter(div)\r\n    tools.processDocCode(div)\r\n\r\n    var pres = doc.find('a')\r\n    for (let mindex = 0; mindex < pres.length; mindex++) {\r\n      const pre = pres.eq(mindex)\r\n      try {\r\n        pre.after(pre.html()).remove()\r\n      } catch (e) { }\r\n    }\r\n\r\n    var pres = doc.find('iframe')\r\n    for (let mindex = 0; mindex < pres.length; mindex++) {\r\n      const pre = pres.eq(mindex)\r\n      try {\r\n        pre.remove()\r\n      } catch (e) { }\r\n    }\r\n\r\n    try {\r\n      const images = doc.find('img')\r\n      for (let index = 0; index < images.length; index++) {\r\n        const image = images.eq(index)\r\n        const imgSrc = image.attr('src')\r\n        if (imgSrc && imgSrc.indexOf('.svg') > -1) {\r\n          console.log('remove svg Image')\r\n          image.remove()\r\n        }\r\n      }\r\n      const qqm = doc.find('qqmusic')\r\n      qqm.next().remove()\r\n      qqm.remove()\r\n    } catch (e) { }\r\n\r\n    post.content = $('<div>').append(doc.clone()).html()\r\n    console.log('post', post)\r\n  }\r\n}\r\n\n\n/***/ }),\n\n/***/ 865:\n/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {\n\n\"use strict\";\n__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   \"default\": () => (/* binding */ YuQueAdapter)\n/* harmony export */ });\nlet _cachedBook = null;\r\n\r\nclass YuQueAdapter {\r\n  constructor() {\r\n    // this.skipReadImage = true\r\n    this.name = 'yuque'\r\n    modifyRequestHeaders('www.yuque.com/api/', {\r\n    \tOrigin: 'https://www.yuque.com',\r\n      Referer: 'https://www.yuque.com/dashboard'\r\n    }, [\r\n    \t'*://www.yuque.com/api/*',\r\n    ], function(details) {\r\n\t\t\t// parse token from cookie inject to headers\r\n      if (details.url.indexOf('www.yuque.com/api/') > -1) {\r\n        helpers.parseTokenAndToHeaders(details, 'yuque_ctoken', 'x-csrf-token')\r\n      }\r\n    })\r\n  }\r\n\r\n  async getMetaData() {\r\n    var res = await $.ajax({\r\n      url: 'https://www.yuque.com/api/mine/common_used?',\r\n    })\r\n    \r\n    const firstBook = res.data.user_books[0];\r\n    const user = firstBook.user;\r\n    _cachedBook = firstBook.target_id;\r\n    return {\r\n      bookId: firstBook.target_id,\r\n    \tuid: user.id,\r\n      title: user.name,\r\n      avatar: user.avatar_url,\r\n      supportTypes: ['html'],\r\n      type: 'yuque',\r\n      displayName: '语雀',\r\n      home: 'https://www.yuque.com/dashboard',\r\n      icon: 'https://gw.alipayobjects.com/zos/rmsportal/UTjFYEzMSYVwzxIGVhMu.png',\r\n    }\r\n  }\r\n\r\n  async addPost(post) {\r\n    const postBody = {\r\n        \"title\": post.post_title,\r\n        \"type\": \"Doc\",\r\n        \"format\": \"lake\",\r\n        \"book_id\": _cachedBook ? _cachedBook : 689837,\r\n        \"status\": 0\r\n    }\r\n    var res = await axios.post('https://www.yuque.com/api/docs', postBody)\r\n    if (!res.data.data) {\r\n      throw new Error(res.data.message)\r\n    }\r\n    const result = res.data.data\r\n    return {\r\n      status: 'success',\r\n      post_id: result.id,\r\n    }\r\n  }\r\n\r\n  async editPost(post_id, post) {\r\n    const content = `${post.post_content}`\r\n    try {\r\n      const aslContent = `${content}`;\r\n      if(!post.markdown) {\r\n        var turndownService = new turndown()\r\n        turndownService.use(tools.turndownExt)\r\n        var markdown = turndownService.turndown(post.post_content)\r\n        console.log(markdown);\r\n        post.markdown = markdown\r\n      }\r\n      \r\n      const convertRes = await axios.post(`https://www.yuque.com/api/docs/convert`, {\r\n        from: 'markdown',\r\n        to: 'lake',\r\n\t\t\t\tcontent: post.markdown\r\n      });\r\n      \r\n      const bodyContent = convertRes.data.data.content;\r\n\t\t\tconst saveRes = await axios.put(`https://www.yuque.com/api/docs/${post_id}/content`, {\r\n          \"format\": \"lake\",\r\n          \"body_asl\": bodyContent,\r\n          \"body\": `<div class=\"lake-content\" typography=\"traditional\">${bodyContent}</div>`,\r\n          \"body_html\": `<div class=\"lake-content\" typography=\"traditional\">${bodyContent}</div><!8384d2492e7a3edff34dd91c1ee5e056bb6ac85f2aad21b0eaa9188dc6a190a7>`,\r\n          \"draft_version\": 0,\r\n          \"sync_dynamic_data\": false,\r\n          \"save_type\": \"auto\",\r\n          \"edit_type\": \"Lake\"\r\n      });\r\n      return {\r\n        status: 'success',\r\n        post_id: post_id,\r\n        draftLink: `https://www.yuque.com/go/doc/${post_id}/edit`\r\n      }\r\n    } catch (e) {\r\n    \tthrow new Error(e.toString())\r\n    }\r\n  }\r\n\r\n  async uploadFile(file) {\r\n    const { src, post_id } = file\r\n    var uploadUrl = \"https://www.yuque.com/api/upload/attach?attachable_type=Doc&attachable_id=\"+post_id+\"&type=image\"\r\n    var file = new File([file.bits], 'temp.jpg', {\r\n      type: file.type\r\n    });\r\n    var formdata = new FormData()\r\n    formdata.append('file', file)\r\n    var res = await axios({\r\n      url: uploadUrl,\r\n      method: 'post',\r\n      data: formdata,\r\n      headers: { 'Content-Type': 'multipart/form-data' },\r\n    })\r\n\r\n    if (!res.data.data.attachment_id) {\r\n      throw new Error('图片上传失败 ' + src)\r\n    }\r\n    // http only\r\n    console.log('uploadFile', res)\r\n    return [{\r\n      id: res.data.data.attachment_id,\r\n      object_key: res.data.data.attachment_id,\r\n      url: res.data.data.url,\r\n      images: [\r\n        res.data.data\r\n      ]\r\n    }]\r\n  }\r\n\r\n  async preEditPost(post) {\r\n    var div = $('<div>')\r\n    $('body').append(div)\r\n    div.html(post.content)\r\n    \r\n    var doc = div\r\n\r\n    tools.doPreFilter(div)\r\n    tools.processDocCode(div)\r\n    \r\n    var pres = doc.find('a')\r\n    for (let mindex = 0; mindex < pres.length; mindex++) {\r\n      const pre = pres.eq(mindex)\r\n      try {\r\n        pre.after(pre.html()).remove()\r\n      } catch (e) {}\r\n    }\r\n\r\n    var pres = doc.find('iframe')\r\n    for (let mindex = 0; mindex < pres.length; mindex++) {\r\n      const pre = pres.eq(mindex)\r\n      try {\r\n        pre.remove()\r\n      } catch (e) {}\r\n    }\r\n\r\n    try {\r\n      const images = doc.find('img')\r\n      for (let index = 0; index < images.length; index++) {\r\n        const image = images.eq(index)\r\n        const imgSrc = image.attr('src')\r\n        if (imgSrc && imgSrc.indexOf('.svg') > -1) {\r\n          console.log('remove svg Image')\r\n          image.remove()\r\n        }\r\n      }\r\n      const qqm = doc.find('qqmusic')\r\n      qqm.next().remove()\r\n      qqm.remove()\r\n    } catch (e) {}\r\n\r\n    post.content = $('<div>').append(doc.clone()).html()\r\n    console.log('post', post)\r\n  }\r\n  \r\n  editImg(img, source) {\r\n    img.attr('class', 'ne-image')\r\n    img.attr('id', 'u483fad24')\r\n  }\r\n}\r\n\n\n/***/ }),\n\n/***/ 20:\n/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {\n\n\"use strict\";\n__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   \"default\": () => (/* binding */ ZhiHuAdapter)\n/* harmony export */ });\n// function escapeHtml(text) {\r\n//   return text\r\n//     .replace(/&/g, '&amp;')\r\n//     .replace(/</g, '&lt;')\r\n//     .replace(/>/g, '&gt;')\r\n//     .replace(/\"/g, '&quot;')\r\n//     .replace(/'/g, '&#039;')\r\n// }\r\n\r\n// function getChildren(obj, count) {\r\n//   count++\r\n//   if (count > 4) return null\r\n//   if (obj.children().length > 1) return obj\r\n//   return getChildren(obj.children().eq(0), count)\r\n// }\r\n\r\n// function CodeBlockToPlainTextOther(pre) {\r\n//   var text = []\r\n//   var minSub = getChildren(pre, 0)\r\n//   var lines = minSub.children()\r\n//   for (let index = 0; index < lines.length; index++) {\r\n//     const element = lines.eq(index)\r\n//     const codeStr = element.text()\r\n//     text.push('<code>' + escapeHtml(codeStr) + '</code>')\r\n//   }\r\n//   return text.join('\\n')\r\n// }\r\n\r\n// function CodeBlockToPlainText(pre) {\r\n//   var text = []\r\n//   var minSub = getChildren(pre, 0)\r\n//   var lines = pre.find('code')\r\n//   if (lines.length > 1) {\r\n//     return CodeBlockToPlainTextOther(pre)\r\n//   }\r\n\r\n//   for (let index = 0; index < lines.length; index++) {\r\n//     const element = lines.eq(index)\r\n//     const codeStr = element[0].innerText\r\n//     console.log('codeStr', codeStr)\r\n//     var codeLines = codeStr.split('\\n')\r\n//     codeLines.forEach((codeLine) => {\r\n//       text.push('<code>' + escapeHtml(codeLine) + '</code>')\r\n//     })\r\n//   }\r\n//   return text.join('\\n')\r\n// }\r\n\r\nclass ZhiHuAdapter {\r\n  constructor() {\r\n    // this.skipReadImage = true\r\n    this.version = '0.0.1'\r\n    this.name = 'zhihu'\r\n  }\r\n\r\n  async getMetaData() {\r\n    var res = await $.ajax({\r\n      url:\r\n        'https://www.zhihu.com/api/v4/me?include=account_status%2Cis_bind_phone%2Cis_force_renamed%2Cemail%2Crenamed_fullname',\r\n    })\r\n    // console.log(res);\r\n    return {\r\n      uid: res.uid,\r\n      title: res.name,\r\n      avatar: res.avatar_url,\r\n      supportTypes: ['html'],\r\n      type: 'zhihu',\r\n      displayName: '知乎',\r\n      home: 'https://www.zhihu.com/settings/account',\r\n      icon: 'https://static.zhihu.com/static/favicon.ico',\r\n    }\r\n  }\r\n\r\n  async addPost(post) {\r\n    var res = await $.ajax({\r\n      url: 'https://zhuanlan.zhihu.com/api/articles/drafts',\r\n      type: 'POST',\r\n      dataType: 'JSON',\r\n      contentType: 'application/json',\r\n      data: JSON.stringify({\r\n        title: post.post_title,\r\n        // content: post.post_content\r\n      }),\r\n    })\r\n    console.log(res)\r\n    return {\r\n      status: 'success',\r\n      post_id: res.id,\r\n    }\r\n    //\r\n  }\r\n\r\n  async editPost(post_id, post) {\r\n    console.log('editPost', post.post_thumbnail)\r\n    var res = await $.ajax({\r\n      url: 'https://zhuanlan.zhihu.com/api/articles/' + post_id + '/draft',\r\n      type: 'PATCH',\r\n      contentType: 'application/json',\r\n      data: JSON.stringify({\r\n        title: post.post_title,\r\n        content: post.post_content,\r\n        isTitleImageFullScreen: false,\r\n        titleImage: 'https://pic1.zhimg.com/' + post.post_thumbnail + '.png',\r\n      }),\r\n    })\r\n\r\n    return {\r\n      status: 'success',\r\n      post_id: post_id,\r\n      draftLink: 'https://zhuanlan.zhihu.com/p/' + post_id + '/edit',\r\n    }\r\n    // https://zhuanlan.zhihu.com/api/articles/68769713/draft\r\n  }\r\n\r\n  untiImageDone(image_id) {\r\n    return new Promise(function(resolve, reject) {\r\n      function waitToNext() {\r\n        console.log('untiImageDone', image_id);\r\n        (async () => {\r\n          var imgDetail = await $.ajax({\r\n            url: 'https://api.zhihu.com/images/' + image_id,\r\n            type: 'GET',\r\n          })\r\n          console.log('imgDetail', imgDetail)\r\n          if (imgDetail.status != 'processing') {\r\n            console.log('all done')\r\n            resolve(imgDetail)\r\n          } else {\r\n            // console.log('go next', waitToNext)\r\n            setTimeout(waitToNext, 300)\r\n          }\r\n        })()\r\n      }\r\n      waitToNext()\r\n    })\r\n  }\r\n\r\n  async _uploadFile(file) {\r\n    var src = file.src\r\n    var res = await $.ajax({\r\n      url: 'https://zhuanlan.zhihu.com/api/uploaded_images',\r\n      type: 'POST',\r\n      headers: {\r\n        accept: '*/*',\r\n        'x-requested-with': 'fetch',\r\n      },\r\n      data: {\r\n        url: src,\r\n        source: 'article',\r\n      },\r\n    })\r\n\r\n    return [\r\n      {\r\n        id: res.hash,\r\n        object_key: res.hash,\r\n        url: res.src,\r\n      },\r\n    ]\r\n  }\r\n\r\n  async uploadFile(file) {\r\n    console.log('ZhiHuDriver.uploadFile', file, md5)\r\n    var updateData = JSON.stringify({\r\n      image_hash: md5(file.bits),\r\n      source: 'article',\r\n    })\r\n    console.log('upload', updateData)\r\n    var fileResp = await $.ajax({\r\n      url: 'https://api.zhihu.com/images',\r\n      type: 'POST',\r\n      dataType: 'JSON',\r\n      contentType: 'application/json',\r\n      data: updateData,\r\n    })\r\n\r\n    console.log('upload', fileResp)\r\n\r\n    var upload_file = fileResp.upload_file\r\n    if (fileResp.upload_file.state == 1) {\r\n      var imgDetail = await this.untiImageDone(upload_file.image_id)\r\n      console.log('imgDetail', imgDetail)\r\n      upload_file.object_key = imgDetail.original_hash\r\n    } else {\r\n      var token = fileResp.upload_token\r\n      let client = new OSS({\r\n        endpoint: 'https://zhihu-pics-upload.zhimg.com',\r\n        accessKeyId: token.access_id,\r\n        accessKeySecret: token.access_key,\r\n        stsToken: token.access_token,\r\n        cname: true,\r\n        bucket: 'zhihu-pics',\r\n      })\r\n      var finalUrl = await client.put(\r\n        upload_file.object_key,\r\n        new Blob([file.bits])\r\n      )\r\n      console.log(client, finalUrl)\r\n    }\r\n    console.log(file, fileResp)\r\n\r\n    if (file.type === 'image/gif') {\r\n      // add extension for gif\r\n      upload_file.object_key = upload_file.object_key + '.gif';\r\n    }\r\n    return [\r\n      {\r\n        id: upload_file.object_key,\r\n        object_key: upload_file.object_key,\r\n        url: 'https://pic4.zhimg.com/' + upload_file.object_key,\r\n        // url: 'https://pic1.zhimg.com/80/' + upload_file.object_key + '_hd.png',\r\n      },\r\n    ]\r\n  }\r\n\r\n  async preEditPost(post) {\r\n    var div = $('<div>')\r\n    $('body').append(div)\r\n\r\n    // post.content = post.content.replace(/\\>\\s+\\</g,'');\r\n    div.html(post.content)\r\n\r\n    // var org = $(post.content);\r\n    // var doc = $('<div>').append(org.clone());\r\n    var doc = div\r\n    // var pres = doc.find('pre')\r\n    // console.log('find code blocks', pres.length, post)\r\n    // for (let mindex = 0; mindex < pres.length; mindex++) {\r\n    //   const pre = pres.eq(mindex)\r\n    //   try {\r\n    //     var newHtml = CodeBlockToPlainText(pre, 0)\r\n    //     if (newHtml) {\r\n    //       console.log(newHtml)\r\n    //       pre.html(newHtml)\r\n    //     }\r\n    //   } catch (e) {}\r\n    // }\r\n    tools.doPreFilter(div)\r\n    tools.processDocCode(div)\r\n\r\n    var removeIfEmpty = function() {\r\n      var $obj = $(this)\r\n      var originalText = $obj.text()\r\n      if (originalText == '') {\r\n        $obj.remove()\r\n      }\r\n    }\r\n\r\n    var removeIfNoImageEmpty = function() {\r\n      var $obj = $(this)\r\n      var originalText = $obj.text()\r\n      var img = $obj.find('img')\r\n      if (originalText == '' && !img.length) {\r\n        $obj.remove()\r\n      }\r\n    }\r\n\r\n    var processEmptyLine = function (idx, el) {\r\n      var $obj = $(this)\r\n      var originalText = $obj.text()\r\n      var img = $obj.find('img')\r\n      var brs = $obj.find('br')\r\n      if (originalText == '') {\r\n        ;(function () {\r\n          if (img.length){\r\n            console.log('has img skip')\r\n            return\r\n          }\r\n          if (!brs.length) {\r\n            console.log('no br skip')\r\n            return\r\n          }\r\n          $obj.remove()\r\n        })()\r\n      } else {\r\n        if(originalText.trim() == '') {\r\n          console.log('processEmptyLine', $obj)\r\n          $obj.remove()\r\n        }\r\n      }\r\n      // try to replace as h2;\r\n    }\r\n\r\n    var highlightTitle = function() {\r\n      var strongTag = $obj.find('strong').eq(0)\r\n      var childStrongText = strongTag.text()\r\n      var isHead = false\r\n      if (originalText == childStrongText) {\r\n        var strongSize = null\r\n        var tagStart = strongTag\r\n        var align = null\r\n        for (let index = 0; index < 4; index++) {\r\n          var fontSize = tagStart.css('font-size')\r\n          var textAlign = tagStart.css('text-align')\r\n          if (fontSize) {\r\n            strongSize = fontSize\r\n          }\r\n          if (textAlign) {\r\n            align = textAlign\r\n          }\r\n          if (align && strongSize) break\r\n          if (tagStart == $obj) {\r\n            console.log('near top')\r\n            break\r\n          }\r\n          tagStart = tagStart.parent()\r\n        }\r\n        if (strongSize) {\r\n          var theFontSize = parseInt(strongSize)\r\n          if (theFontSize > 15 && align == 'center') {\r\n            // var newTag = $('<h2></h2>').append($obj.html())\r\n            // $obj.after(newTag).remove()\r\n            isHead = true;\r\n          }\r\n        }\r\n      }\r\n      if (isHead) {\r\n        var NewElement = $(\"<h2 />\");\r\n        // $.each(this.attributes, function(i, attrib){\r\n        //   $(NewElement).attr(attrib.name, attrib.value);\r\n        // });\r\n        $(this).replaceWith(function () {\r\n          return $(NewElement).append($obj.text());\r\n        });\r\n      }\r\n    }\r\n    // doc.find('[data-role=\"outer\"]').children()\r\n    // doc.find('section').each(removeIfNoImageEmpty)\r\n\r\n    // remove empty break line\r\n    doc.find('section').each(function() {\r\n      var NewElement = $(\"<div />\");\r\n      $.each(this.attributes, function(i, attrib){\r\n        $(NewElement).attr(attrib.name, attrib.value);\r\n      });\r\n      // Replace the current element with the new one and carry over the contents\r\n      $(this).replaceWith(function () {\r\n        return $(NewElement).append($(this).contents());\r\n      });\r\n    });\r\n\r\n    doc.find('p').each(processEmptyLine)\r\n    // doc.find('section').each(processEmptyLine)\r\n    doc.find('div').each(processEmptyLine)\r\n    doc.find('div').each(removeIfNoImageEmpty)\r\n    // doc.find('[powered-by]').each(removeIfEmpty)\r\n    // doc.find('[data-role=\"paragraph\"]').each(highlightTitle)\r\n\r\n    var processBr = function (idx, el) {\r\n      var $obj = $(this)\r\n      if (!$obj.next().length) {\r\n        $obj.remove()\r\n      }\r\n    }\r\n    doc.find('br').each(processBr)\r\n    // table {\r\n    //     margin-bottom: 10px;\r\n    //     border-collapse: collapse;\r\n    //     display: table;\r\n    //     width: 100%!important;\r\n    // }\r\n    // td, th {\r\n    //     word-wrap: break-word;\r\n    //     word-break: break-all;\r\n    //     padding: 5px 10px;\r\n    //     border: 1px solid #DDD;\r\n    // }\r\n\r\n    // console.log('found table', doc.find('table'))\r\n    var tempDoc = $('<div>').append(doc.clone())\r\n    post.content =\r\n      tempDoc.children('div').length == 1\r\n        ? tempDoc.children('div').html()\r\n        : tempDoc.html()\r\n    // div.remove();\r\n    // this.addNotify(post)\r\n  }\r\n\r\n  addPromotion(post) {\r\n    var sharcode = `<blockquote><p>本文使用 <a href=\"https://zhuanlan.zhihu.com/p/358098152\" class=\"internal\">文章同步助手</a> 同步</p></blockquote>`\r\n    post.content = post.content.trim() + `${sharcode}`\r\n  }\r\n}\r\n\n\n/***/ }),\n\n/***/ 637:\n/***/ ((module, __unused_webpack_exports, __webpack_require__) => {\n\nvar map = {\n\t\"./163.js\": 610,\n\t\"./51cto.js\": 640,\n\t\"./BaseAdapter.js\": 230,\n\t\"./CSDN.js\": 848,\n\t\"./Cnblog.js\": 333,\n\t\"./Discuz.js\": 862,\n\t\"./Juejin.js\": 513,\n\t\"./Segmentfault.js\": 991,\n\t\"./Weibo.js\": 762,\n\t\"./YiDian.js\": 466,\n\t\"./baijiahao.js\": 826,\n\t\"./bilibili.js\": 392,\n\t\"./dayu.js\": 777,\n\t\"./douban.js\": 701,\n\t\"./focus.js\": 254,\n\t\"./imooc.js\": 275,\n\t\"./ipfs.js\": 142,\n\t\"./jianshu.js\": 678,\n\t\"./oschina.js\": 372,\n\t\"./sohu.js\": 305,\n\t\"./toutiao.js\": 829,\n\t\"./weixin.js\": 286,\n\t\"./wordpress.js\": 361,\n\t\"./xueqiu.js\": 759,\n\t\"./yuque.js\": 865,\n\t\"./zhihu.js\": 20\n};\n\n\nfunction webpackContext(req) {\n\tvar id = webpackContextResolve(req);\n\treturn __webpack_require__(id);\n}\nfunction webpackContextResolve(req) {\n\tif(!__webpack_require__.o(map, req)) {\n\t\tvar e = new Error(\"Cannot find module '\" + req + \"'\");\n\t\te.code = 'MODULE_NOT_FOUND';\n\t\tthrow e;\n\t}\n\treturn map[req];\n}\nwebpackContext.keys = function webpackContextKeys() {\n\treturn Object.keys(map);\n};\nwebpackContext.resolve = webpackContextResolve;\nmodule.exports = webpackContext;\nwebpackContext.id = 637;\n\n/***/ })\n\n/******/ \t});\n/************************************************************************/\n/******/ \t// The module cache\n/******/ \tvar __webpack_module_cache__ = {};\n/******/ \t\n/******/ \t// The require function\n/******/ \tfunction __webpack_require__(moduleId) {\n/******/ \t\t// Check if module is in cache\n/******/ \t\tvar cachedModule = __webpack_module_cache__[moduleId];\n/******/ \t\tif (cachedModule !== undefined) {\n/******/ \t\t\treturn cachedModule.exports;\n/******/ \t\t}\n/******/ \t\t// Create a new module (and put it into the cache)\n/******/ \t\tvar module = __webpack_module_cache__[moduleId] = {\n/******/ \t\t\t// no module.id needed\n/******/ \t\t\t// no module.loaded needed\n/******/ \t\t\texports: {}\n/******/ \t\t};\n/******/ \t\n/******/ \t\t// Execute the module function\n/******/ \t\t__webpack_modules__[moduleId](module, module.exports, __webpack_require__);\n/******/ \t\n/******/ \t\t// Return the exports of the module\n/******/ \t\treturn module.exports;\n/******/ \t}\n/******/ \t\n/************************************************************************/\n/******/ \t/* webpack/runtime/define property getters */\n/******/ \t(() => {\n/******/ \t\t// define getter functions for harmony exports\n/******/ \t\t__webpack_require__.d = (exports, definition) => {\n/******/ \t\t\tfor(var key in definition) {\n/******/ \t\t\t\tif(__webpack_require__.o(definition, key) && !__webpack_require__.o(exports, key)) {\n/******/ \t\t\t\t\tObject.defineProperty(exports, key, { enumerable: true, get: definition[key] });\n/******/ \t\t\t\t}\n/******/ \t\t\t}\n/******/ \t\t};\n/******/ \t})();\n/******/ \t\n/******/ \t/* webpack/runtime/hasOwnProperty shorthand */\n/******/ \t(() => {\n/******/ \t\t__webpack_require__.o = (obj, prop) => (Object.prototype.hasOwnProperty.call(obj, prop))\n/******/ \t})();\n/******/ \t\n/******/ \t/* webpack/runtime/make namespace object */\n/******/ \t(() => {\n/******/ \t\t// define __esModule on exports\n/******/ \t\t__webpack_require__.r = (exports) => {\n/******/ \t\t\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n/******/ \t\t\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n/******/ \t\t\t}\n/******/ \t\t\tObject.defineProperty(exports, '__esModule', { value: true });\n/******/ \t\t};\n/******/ \t})();\n/******/ \t\n/************************************************************************/\nvar __webpack_exports__ = {};\n// This entry need to be wrapped in an IIFE because it need to be in strict mode.\n(() => {\n\"use strict\";\n// ESM COMPAT FLAG\n__webpack_require__.r(__webpack_exports__);\n\n// EXPORTS\n__webpack_require__.d(__webpack_exports__, {\n  addCustomDriver: () => (/* binding */ addCustomDriver),\n  getDriver: () => (/* binding */ getDriver),\n  getMeta: () => (/* binding */ getMeta),\n  getPublicAccounts: () => (/* binding */ getPublicAccounts)\n});\n\n;// CONCATENATED MODULE: ../@wechatsync/drivers/index.js\nfunction importAll(r) {\r\n  const modules = {}\r\n  r.keys().forEach(key => {\r\n    const module = r(key)\r\n    const moduleName = module.default ? module.default.name : null\r\n    if (moduleName && moduleName !== 'BaseAdapter') {\r\n      modules[moduleName] = module.default\r\n    }\r\n    // console.log('moduleName', moduleName)\r\n  })\r\n  return modules\r\n}\r\n\r\n/* harmony default export */ const drivers = (importAll(__webpack_require__(637)));\r\n\n;// CONCATENATED MODULE: ./src/drivers/driver.js\n\r\n\r\nconst {\r\n  JianShuAdapter,\r\n  ZhiHuAdapter,\r\n  WordpressAdapter,\r\n  ToutiaoAdapter,\r\n  WeiboAdapter,\r\n  SegmentfaultAdapter,\r\n  JuejinAdapter,\r\n  CSDNAdapter,\r\n  CnblogAdapter,\r\n  WeixinAdapter,\r\n  YiDianAdapter,\r\n  DoubanAdapter,\r\n  BilibiliAdapter,\r\n  _51CtoAdapter,\r\n  FocusAdapter,\r\n  DiscuzAdapter,\r\n  SoHuAdapter,\r\n  BaiJiaHaoAdapter,\r\n  OsChinaAdapter,\r\n  DaYuAdapter,\r\n  ImoocAdapter,\r\n  YuQueAdapter,\r\n  XueQiuAdapter,\r\n  IPFSAdapter,\r\n} = drivers\r\n\r\nvar _cacheState = {}\r\nconst _customDrivers = {};\r\n\r\nfunction addCustomDriver(name, driverClass) {\r\n  _customDrivers[name] = {\r\n    name: name,\r\n    handler: driverClass\r\n  }\r\n  console.log('addCustomDriver', _customDrivers)\r\n}\r\n\r\n\r\nfunction getDriver(account) {\r\n\r\n  // 保证在内置的前面\r\n  if(_customDrivers[account.type]) {\r\n    const driverInCustom = _customDrivers[account.type]\r\n    return new driverInCustom['handler'](account)\r\n  }\r\n\r\n  if (account.type == 'wordpress') {\r\n    return new WordpressAdapter(\r\n      account.params.wpUrl,\r\n      account.params.wpUser,\r\n      account.params.wpPwd\r\n    )\r\n  }\r\n\r\n  if (account.type == 'zhihu') {\r\n    return new ZhiHuAdapter()\r\n  }\r\n\r\n  if (account.type == 'dayu') {\r\n    return new DaYuAdapter(account)\r\n  }\r\n\r\n  if (account.type == 'jianshu') {\r\n    return new JianShuAdapter()\r\n  }\r\n\r\n  if (account.type == 'typecho') {\r\n    return new WordpressAdapter(\r\n      account.params.wpUrl,\r\n      account.params.wpUser,\r\n      account.params.wpPwd,\r\n      true\r\n    )\r\n  }\r\n\r\n  if (account.type == 'toutiao') {\r\n    return new ToutiaoAdapter()\r\n  }\r\n\r\n  if (account.type == 'bilibili') {\r\n    return new BilibiliAdapter({\r\n      globalState: _cacheState,\r\n      state: _cacheState[account.type],\r\n    })\r\n  }\r\n\r\n  if (account.type == 'weibo') {\r\n    return new WeiboAdapter()\r\n  }\r\n\r\n  if (account.type == 'sohufocus') {\r\n    return new FocusAdapter()\r\n  }\r\n\r\n  if (account.type == '51cto') {\r\n    return new _51CtoAdapter()\r\n  }\r\n\r\n  if (account.type == 'segmentfault') {\r\n    return new SegmentfaultAdapter(account)\r\n  }\r\n\r\n  if (account.type == 'juejin') {\r\n    return new JuejinAdapter(account)\r\n  }\r\n\r\n  if (account.type == 'csdn' || account.type == 'CSDN') {\r\n    return new CSDNAdapter(account)\r\n  }\r\n\r\n  if (account.type == 'cnblog') {\r\n    return new CnblogAdapter(account)\r\n  }\r\n\r\n  if (account.type == 'weixin') {\r\n    return new WeixinAdapter(account)\r\n  }\r\n\r\n  if (account.type == 'yidian') {\r\n    return new YiDianAdapter(account)\r\n  }\r\n\r\n  if (account.type == 'baijiahao') {\r\n    return new BaiJiaHaoAdapter(account)\r\n  }\r\n\r\n  if(account.type == 'douban') {\r\n    console.log(account.type)\r\n    return new DoubanAdapter({\r\n      globalState: _cacheState,\r\n      state: _cacheState[account.type],\r\n    })\r\n  }\r\n\r\n  if(account.type == 'discuz') {\r\n    console.log('discuz', account)\r\n    return new DiscuzAdapter(account.config)\r\n  }\r\n\r\n  if (account.type == 'sohu') {\r\n    return new SoHuAdapter(account)\r\n  }\r\n\r\n  if (account.type == 'oschina') {\r\n    return new OsChinaAdapter(account)\r\n  }\r\n\r\n  if (account.type == 'imooc') {\r\n    return new ImoocAdapter(account)\r\n  }\r\n\r\n  if (account.type == 'ipfs') {\r\n    return new IPFSAdapter(account)\r\n  }\r\n\r\n  if (account.type == 'xueqiu') {\r\n    return new XueQiuAdapter(account)\r\n  }\r\n\r\n  if (account.type == 'yuque') {\r\n    return new YuQueAdapter(account)\r\n  }\r\n\r\n  throw Error('not support account type')\r\n}\r\n\r\nconst chunk = (arr, size) => Array.from({ length: Math.ceil(arr.length / size) }, (v, i) =>\r\n  arr.slice(i * size, i * size + size)\r\n);\r\n\r\nlet _cacheUsers = null\r\nlet _lastFetch = null\r\n\r\nasync function getPublicAccounts() {\r\n\r\n  // 限制20s 保证不会太频繁请求平台\r\n  if(_lastFetch != null) {\r\n    const isTooQuickly = (Date.now() - _lastFetch) < 20 * 1000\r\n    if (isTooQuickly) {\r\n      console.log('too quickly return by cache')\r\n      return _cacheUsers\r\n    }\r\n  }\r\n\r\n  console.log('getPublicAccounts')\r\n  var drivers = [\r\n    new SegmentfaultAdapter(),\r\n    new CSDNAdapter(),\r\n    new JuejinAdapter(),\r\n    new CnblogAdapter(),\r\n    new WeiboAdapter(),\r\n    new ZhiHuAdapter(),\r\n    new JianShuAdapter(),\r\n    new ToutiaoAdapter(),\r\n    new WeixinAdapter(),\r\n    new YiDianAdapter(),\r\n    new DoubanAdapter(),\r\n    new BilibiliAdapter(),\r\n    new _51CtoAdapter(),\r\n    new FocusAdapter(),\r\n    new BaiJiaHaoAdapter(),\r\n    new SoHuAdapter(),\r\n    new OsChinaAdapter(),\r\n    new DaYuAdapter(),\r\n    new ImoocAdapter(),\r\n    new YuQueAdapter(),\r\n    new XueQiuAdapter(),\r\n    new IPFSAdapter(),\r\n  ]\r\n\r\n  var customDiscuzEndpoints = ['https://www.51hanghai.com'];\r\n  customDiscuzEndpoints.forEach(_ => {\r\n    drivers.push(new DiscuzAdapter({\r\n      url: _,\r\n   }));\r\n  })\r\n\r\n  Object.keys(_customDrivers).forEach(type => {\r\n    const _customDriver = _customDrivers[type];\r\n    try {\r\n      drivers.push(new _customDriver['handler']());\r\n    } catch (e) {\r\n      console.log('initlaze custom driver error', e)\r\n    }\r\n  });\r\n\r\n  var users = []\r\n\r\n  const stepItems = chunk(drivers, 20);\r\n  const startTime = Date.now()\r\n  for (let index = 0; index < stepItems.length; index++) {\r\n    try {\r\n      const stepItem = stepItems[index];\r\n      const results = await Promise.all(\r\n        stepItem.map((driver) => {\r\n          return new Promise((resolve, reject) => {\r\n            driver.getMetaData().then(resolve, function() {\r\n              resolve(null)\r\n            })\r\n          })\r\n        })\r\n      );\r\n      const successAccounts = results.filter(_ => _)\r\n      users = users.concat(successAccounts)\r\n    } catch (e) {\r\n      console.log(\"chunkPromise\", e);\r\n    }\r\n  }\r\n  // for (let index = 0; index < drivers.length; index++) {\r\n  //   const driver = drivers[index]\r\n  //   try {\r\n  //     var user = await driver.getMetaData()\r\n  //     users.push(user)\r\n  //   } catch (e) {\r\n  //     console.log(e)\r\n  //   }\r\n  // }\r\n  const spend = Date.now() - startTime\r\n  console.log('getPublicAccounts spend', spend, 'driverCount', drivers.length)\r\n  _lastFetch = Date.now()\r\n  _cacheUsers = users\r\n  return users\r\n}\r\n\r\nfunction getCookie(name, cookieStr) {\r\n  let arr,\r\n    reg = new RegExp('(^| )' + name + '=([^;]*)(;|$)')\r\n  if ((arr = cookieStr.match(reg))) {\r\n    return unescape(arr[2])\r\n  } else {\r\n    return ''\r\n  }\r\n}\r\n\r\nfunction urlHandler(details) {\r\n  if (\r\n    details.url.indexOf('api.bilibili.com') >\r\n    -1\r\n  ) {\r\n    var cookieHeader = details.requestHeaders.filter(h => {\r\n      return h.name.toLowerCase() == 'cookie'\r\n    })\r\n\r\n    if (cookieHeader.length) {\r\n      var cookieStr = cookieHeader[0].value\r\n      var bili_jct = getCookie('bili_jct', cookieStr)\r\n      if (bili_jct) {\r\n        _cacheState['bilibili'] = _cacheState['bilibili'] || {};\r\n        Object.assign(_cacheState['bilibili'], {\r\n          csrf: bili_jct,\r\n        })\r\n        console.log('bili_jct', bili_jct, details)\r\n      }\r\n    }\r\n    // console.log('details.requestHeaders', details)\r\n  }\r\n  // https://music.douban.com/subject/24856133/new_review\r\n  if (\r\n    details.url.indexOf('music.douban.com') >\r\n    -1\r\n    &&\r\n    details.url.indexOf('/new_review') >\r\n    -1\r\n  ) {\r\n    _cacheState['douban'] = _cacheState['douban'] || {};\r\n    Object.assign(_cacheState['douban'], {\r\n      is_review: true,\r\n      subject: 'music',\r\n      url: details.url,\r\n      id: details.url.replace('https://music.douban.com/subject/', '')\r\n      .replace('/new_review', '')\r\n    })\r\n  }\r\n}\r\n\r\nfunction getMeta() {\r\n  return {\r\n    version: '0.0.15',\r\n    versionNumber: 15,\r\n    log: '',\r\n    urlHandler: urlHandler,\r\n    inspectUrls: ['*://api.bilibili.com/*', '*://music.douban.com/*'],\r\n  }\r\n}\r\n\r\n// DEVTOOL_PLACEHOLDER_INSERT\r\n\n})();\n\nmodules = __webpack_exports__;\n/******/ })()\n;for (var k in modules) exports[k] = modules[k];"